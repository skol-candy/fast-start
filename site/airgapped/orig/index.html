<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Public viewable bootcamp materials for Fast-Start"><meta name="author" content="John Abbott"><link href="https://github.com/skol-candy/fast-start/airgapped/orig/" rel="canonical"><link rel="icon" href="https://www.ibm.com/favicon.ico"><meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20"><title>Air-gapped OpenShift Installation - Automation Fast-Starts</title><link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css"><link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel="stylesheet" href="../../assets/stylesheets/custom.00c04c01.min.css"><link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a href="#1-solution-architecture" class="md-skip"> Skip to content </a> </div> <div data-md-component="announce"> <aside class="md-banner"> <div class="md-banner__inner md-grid md-typeset"> Welcome to Automation Fast-Starts </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav class="md-header__inner md-grid" aria-label="Header"> <a href="../.." title="Automation Fast-Starts" class="md-header__button md-logo" aria-label="Automation Fast-Starts" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.906.664a1.75 1.75 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> Automation Fast-Starts </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Air-gapped OpenShift Installation </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_0"> <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"></path></svg> </label> <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_1"> <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg> </label> <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo" aria-label="Switch to system preference" type="radio" name="__palette" id="__palette_2"> <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required> <label class="md-search__icon md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class="md-search__options" aria-label="Search"> <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text data-md-component="search-share" tabindex="-1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a href="https://github.com/skol-candy/fast-start" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> skol-candy/fast-start </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a href="../.." title="Automation Fast-Starts" class="md-nav__button md-logo" aria-label="Automation Fast-Starts" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.906.664a1.75 1.75 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z"></path></svg> </a> Automation Fast-Starts </label> <div class="md-nav__source"> <a href="https://github.com/skol-candy/fast-start" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> skol-candy/fast-start </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1"> <div class="md-nav__link md-nav__container"> <a href="../.." class="md-nav__link "> <span class="md-ellipsis"> Welcome </span> </a> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_1"> <span class="md-nav__icon md-icon"></span> Welcome </label> <ul class="md-nav__list" data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2"> <div class="md-nav__link md-nav__container"> <a href="../../ama-app-mod/" class="md-nav__link "> <span class="md-ellipsis"> App-Mod with AMA </span> </a> <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> App-Mod with AMA </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../ama-app-mod/ama-install/" class="md-nav__link"> <span class="md-ellipsis"> AMA Installation </span> </a> </li> <li class="md-nav__item"> <a href="../../ama-app-mod/ama-run-scan/" class="md-nav__link"> <span class="md-ellipsis"> Scanning </span> </a> </li> <li class="md-nav__item"> <a href="../../ama-app-mod/ama-scan-results/" class="md-nav__link"> <span class="md-ellipsis"> Scan Results </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <a href="https://github.com/skol-candy/fast-start/edit/master/docs/airgapped/orig.md" title="Edit this page" class="md-content__button md-icon" rel="edit"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg> </a> <a href="https://github.com/skol-candy/fast-start/raw/master/docs/airgapped/orig.md" title="View source of this page" class="md-content__button md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg> </a> <h1>Air-gapped OpenShift Installation</h1> <div class="admonition tip"> <p class="admonition-title">Shout-out <img alt="📢" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f4e2.svg" title=":loudspeaker:"></p> <p>Big shout-out to the <a href="https://pages.github.ibm.com/CSM-SPGI/training/openshift/airgap-4-16/">SPGI CSM Team</a> for creating the majority of this workshop. A huge thank you to them.</p> </div> <div class="admonition danger"> <p class="admonition-title">Disclaimer</p> <p>This material has been created for training and learning purposes. It is not, by any means, official documentation supported by either IBM or Red Hat.</p> </div> <h2 id="1-solution-architecture">1. Solution Architecture<a class="headerlink" href="#1-solution-architecture" title="Permanent link">¶</a></h2> <p>The following diagram illustrates the architecture of the OpenShift cluster air-gapped installation we are conducting in this training course. The servers within the cluster operate in an air-gapped environment, completely isolated from the Internet, with no inbound or outbound access. To facilitate the installation, a specialized machine external to the cluster and connected to the Internet is employed. This machine, designated as the <strong>online bastion</strong>, downloads all necessary packages and binaries required for the installation, mirroring real-world client scenarios.</p> <p>Packages and binaries are then transferred from the online bastion to a machine situated within the internal network of the cluster, which has no Internet connectivity whatsoever. This internal machine is referred to as the <strong>offline bastion</strong>. The OpenShift installation will be initiated from this offline bastion, as it holds exclusive access to the internal network where the cluster resides.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/arch.png" data-desc-position="bottom"><img alt="Arch" src="../images/arch.png" style="max-height:700px"></a></p> <p>During the air-gapped OpenShift installation conducted in this training course, we will create and configure 3 control plane nodes (aka master nodes), 3 infrastructure nodes (aka infra nodes), 3 storage nodes and 3 compute nodes (aka worker nodes), along with both 'offline' and 'online' bastion nodes. Should the need arise, additional compute nodes can be added at a later stage.</p> <p>The version of the OpenShift Container Platform (OCP) to be installed is 4.16. Correspondingly, an OpenShift (oc) client of this same version, 4.16, will be downloaded and installed on the bastion machines for subsequent operations against the OpenShift cluster.</p> <p>Servers specifications:</p> <table> <thead> <tr> <th><strong>Type</strong></th> <th><strong>Number of servers</strong></th> <th><strong>vCPU</strong></th> <th><strong>RAM Memory</strong></th> <th><strong>Storage (system)</strong></th> <th><strong>Storage (data)</strong></th> </tr> </thead> <tbody> <tr> <td>Bastion</td> <td>2</td> <td>4 vCPU</td> <td>16 GB</td> <td>700 GB</td> <td>0 GB</td> </tr> <tr> <td>Control Plane</td> <td>3</td> <td>4 vCPU</td> <td>16 GB</td> <td>120 GB</td> <td>0 GB</td> </tr> <tr> <td>Compute</td> <td>3</td> <td>8 vCPU</td> <td>32 GB</td> <td>300 GB</td> <td>0 GB</td> </tr> <tr> <td>Infra</td> <td>3</td> <td>8 vCPU</td> <td>32 GB</td> <td>120 GB</td> <td>0 GB</td> </tr> <tr> <td>Storage</td> <td>3</td> <td>16 vCPU</td> <td>64 GB</td> <td>120 GB</td> <td>512 GB</td> </tr> <tr> <td>Bootstrap</td> <td>1</td> <td>4 vCPU</td> <td>16 GB</td> <td>120 GB</td> <td>0 GB</td> </tr> </tbody> </table> <div class="admonition example"> <p class="admonition-title">Lab environment</p> <p>Use this <a href="https://techzone.ibm.com/my/reservations/create/65ec3d59d539d900110128a1"><strong>link</strong></a> to the IBM Technology Zone to request an environment to carry out this tutorial. Make sure you select at least 3TB for the DataStore and VPN is enabled:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/lab.png" data-desc-position="bottom"><img alt="image" src="../images/lab.png" style="max-height:200px"></a></p> <div class="admonition important"> <p class="admonition-title">Important</p> </div> <p>While utilizing a VMware vSphere IBM Technology Zone environment, we will not leverage any of the VMware features integrated within the OpenShift Installer for deployment purposes. Instead, we are considering this setup as an elevated "bare-metal" environment, where virtual machines emulate bare-metal servers closely.</p> </div> <h2 id="2-infrastructure-services">2. Infrastructure Services<a class="headerlink" href="#2-infrastructure-services" title="Permanent link">¶</a></h2> <p>In the 'offline' bastion node, the HTTP server, load balancer, image registry, DNS, and OCP deployment utilities will all be configured.</p> <p>Given that the network lacks a DHCP server and maintains static IP addresses for all machines, we are required to manually assign each machine's IP, DNS, and hostname details upon creation.</p> <h2 id="3-network-configuration">3. Network Configuration<a class="headerlink" href="#3-network-configuration" title="Permanent link">¶</a></h2> <p>The following table contains the network configuration where the cluster will be installed:</p> <table> <thead> <tr> <th><strong>Configuration</strong></th> <th><strong>Option</strong></th> </tr> </thead> <tbody> <tr> <td><strong>Subnet name</strong></td> <td>ocp4.platformengineers.xyz</td> </tr> <tr> <td><strong>IP address space</strong></td> <td><strong>192.168.252.0/24</strong></td> </tr> </tbody> </table> <p>The following table contains the OCP network configuration:</p> <table> <thead> <tr> <th><strong>Option</strong></th> <th></th> </tr> </thead> <tbody> <tr> <td><strong>Network: External</strong></td> <td></td> </tr> <tr> <td>IP address space</td> <td><strong>192.168.252.0/24</strong></td> </tr> <tr> <td>Assigned IP address range</td> <td>192.168.252.1-192.168.252.254</td> </tr> <tr> <td>Number of available IP addresses</td> <td>254</td> </tr> <tr> <td><strong>Network: Cluster</strong></td> <td></td> </tr> <tr> <td>IP address space</td> <td><strong>9.248.0.0/14</strong></td> </tr> <tr> <td>IP address range</td> <td>9.248.0.1-9.248.255.254</td> </tr> <tr> <td>Subnet prefix</td> <td>24</td> </tr> <tr> <td>Number of available IP addresses</td> <td>262.142</td> </tr> <tr> <td>Number of IP addresses per node</td> <td>254</td> </tr> <tr> <td>Maximum number of nodes</td> <td>1024</td> </tr> <tr> <td><strong>Network: Service</strong></td> <td></td> </tr> <tr> <td>IP address space</td> <td><strong>10.248.0.0/16</strong></td> </tr> <tr> <td>IP address range</td> <td>10.248.0.1-10.248.255.254</td> </tr> <tr> <td>Number of available IP addresses</td> <td>65.534</td> </tr> </tbody> </table> <h2 id="4-entries-in-the-dns-server">4. Entries in the DNS server<a class="headerlink" href="#4-entries-in-the-dns-server" title="Permanent link">¶</a></h2> <p>These are the DNS entries for the DNS servers:</p> <table> <thead> <tr> <th><strong>Type</strong></th> <th><strong>FQDN hostname</strong></th> <th><strong>IP Address</strong></th> </tr> </thead> <tbody> <tr> <td><strong>Bastion</strong></td> <td>bastion.ocp4.platformengineers.xyz</td> <td>192.168.252.23</td> </tr> <tr> <td></td> <td>bastiononline.ocp4.platformengineers.xyz</td> <td>192.168.252.22</td> </tr> <tr> <td><strong>Bootstrap</strong></td> <td>bootstrap.ocp4.platformengineers.xyz</td> <td>192.168.252.3</td> </tr> <tr> <td><strong>Control Plane</strong></td> <td>controlplane01.ocp4.platformengineers.xyz</td> <td>192.168.252.4</td> </tr> <tr> <td></td> <td>controlplane02.ocp4.platformengineers.xyz</td> <td>192.168.252.5</td> </tr> <tr> <td></td> <td>controlplane03.ocp4.platformengineers.xyz</td> <td>192.168.252.6</td> </tr> <tr> <td><strong>Infra</strong></td> <td>infra01.ocp4.platformengineers.xyz</td> <td>192.168.252.7</td> </tr> <tr> <td></td> <td>infra02.ocp4.platformengineers.xyz</td> <td>192.168.252.8</td> </tr> <tr> <td></td> <td>infra03.ocp4.platformengineers.xyz</td> <td>192.168.252.9</td> </tr> <tr> <td><strong>Compute</strong></td> <td>compute01.ocp4.platformengineers.xyz</td> <td>192.168.252.10</td> </tr> <tr> <td></td> <td>compute02.ocp4.platformengineers.xyz</td> <td>192.168.252.11</td> </tr> <tr> <td></td> <td>compute03.ocp4.platformengineers.xyz</td> <td>192.168.252.12</td> </tr> <tr> <td><strong>Storage</strong></td> <td>storage01.ocp4.platformengineers.xyz</td> <td>192.168.252.13</td> </tr> <tr> <td></td> <td>storage02.ocp4.platformengineers.xyz</td> <td>192.168.252.14</td> </tr> <tr> <td></td> <td>storage03.ocp4.platformengineers.xyz</td> <td>192.168.252.15</td> </tr> </tbody> </table> <p>And these are the service names:</p> <table> <thead> <tr> <th><strong>Name</strong></th> <th><strong>FQDN hostname</strong></th> <th><strong>Type</strong></th> <th><strong>IP</strong></th> </tr> </thead> <tbody> <tr> <td><strong>VIP API</strong></td> <td>api.ocp4.platformengineers.xyz</td> <td>A/AAA or CNAME</td> <td>192.168.252.24</td> </tr> <tr> <td><strong>VIP API-INT</strong></td> <td>api-int.ocp4.platformengineers.xyz</td> <td>A/AAA or CNAME</td> <td>192.168.252.24</td> </tr> <tr> <td><strong>VIP Ingress</strong></td> <td>*.apps.ocp4.platformengineers.xyz</td> <td>A/AAA or CNAME</td> <td>192.168.252.25</td> </tr> </tbody> </table> <h2 id="5-load-balancer-configuration">5. Load Balancer Configuration<a class="headerlink" href="#5-load-balancer-configuration" title="Permanent link">¶</a></h2> <p>We will configure the HAProxy load balancer within the "offline" Bastion node, as follows:</p> <table> <thead> <tr> <th><strong>Front End</strong></th> <th><strong>Targets</strong></th> <th><strong>Port</strong></th> </tr> </thead> <tbody> <tr> <td><strong>*.apps.ocp4.platformengineers.xyz</strong></td> <td>infra01.ocp4.platformengineers.xyz</td> <td>80</td> </tr> <tr> <td></td> <td>infra02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>infra03.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>compute01.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>compute02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>compute03.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>storage01.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>storage02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>storage03.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td><strong>*.apps.ocp4.platformengineers.xyz</strong></td> <td>infra01.ocp4.platformengineers.xyz</td> <td>443</td> </tr> <tr> <td></td> <td>infra02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>infra03.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>compute01.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>compute02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>compute03.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>storage01.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>storage02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>storage03.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td><strong>api.ocp4.platformengineers.xyz</strong></td> <td>bootstrap.ocp4.platformengineers.xyz</td> <td>6443</td> </tr> <tr> <td></td> <td>controlplane01.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>controlplane02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>controlplane03.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td><strong>api-int.ocp4.platformengineers.xyz</strong></td> <td>bootstrap.ocp4.platformengineers.xyz</td> <td>22623</td> </tr> <tr> <td></td> <td>controlplane01.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>controlplane02.ocp4.platformengineers.xyz</td> <td></td> </tr> <tr> <td></td> <td>controlplane03.ocp4.platformengineers.xyz</td> <td></td> </tr> </tbody> </table> <h2 id="6-vpn-configuration">6. VPN Configuration<a class="headerlink" href="#6-vpn-configuration" title="Permanent link">¶</a></h2> <p>In order to connect via ssh to the machines created during the OpenShift installation, which are placed in the <code>192.168.252.0/24</code> private network, and to the VMware vSphere vCenter we need to complete the following steps:</p> <ol> <li> <p>Download and install the VPN manager <strong>Wireguard</strong> (available in the App Store).</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/wireguard.png" data-desc-position="bottom"><img alt="wireguard" src="../images/wireguard.png" style="max-height:50px"></a></p> </li> <li> <p>Download the VPN config file from the IBM Tech Zone using the following button:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/vpn-config.png" data-desc-position="bottom"><img alt="2" src="../images/vpn-config.png" style="max-height:50px"></a></p> </li> <li> <p>Open Wireguard and import the downloaded file as a new VPN tunel.</p> </li> <li> <p>Active the VPN.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/3.png" data-desc-position="bottom"><img alt="3" src="../images/airgap-4-12/3.png" style="max-height:600px"></a></p> </li> </ol> <h2 id="7-guacamole-vm">7. Guacamole VM<a class="headerlink" href="#7-guacamole-vm" title="Permanent link">¶</a></h2> <p>Once we have configured and activated the VPN, we need to navigate to our VMware vSphere vCenter home page using the URL at the bottom of our IBM Tech Zone reservation. VMware vSphere vCenter login credentials can also be found on the same reservation.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/guacamole-config.png" data-desc-position="bottom"><img alt="4" src="../images/guacamole-config.png" style="max-height:300px"></a></p> <p>Once we have successfully logged into our VMware vSphere vCenter, we should see the following screen:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/vCenter.png" data-desc-position="bottom"><img alt="vcenter" src="../images/vCenter.png" style="max-height:900px"></a></p> <p>In our VMware vSphere vCenter environment, there exists a unique Virtual Machine (VM), referred to as the <strong>Guacamole VM</strong>. This term does not pertain to OpenShift bastion nodes but rather denotes a specific VM managed by the IBM TechZone infrastructure team.</p> <p>The purpose of this Guacamole VM is to facilitate tasks requiring substantial internet bandwidth within the VMware vSphere vCenter network environment. By doing so, it avoids potential lag or slowdowns associated with VPN tunnel connections. Essentially, placing this VM on the vCenter network allows for rapid access to heavy components necessary for OpenShift installations directly from within the internal network.</p> <p>This setup significantly enhances efficiency when downloading large files or elements crucial for the OpenShift installation process at the VMware vSphere vCenter level. It ensures smoother and quicker data transfers compared to relying on VPN tunnel connections, which could otherwise lead to slower speeds and potential connectivity issues.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/guacamole.png" data-desc-position="bottom"><img alt="guacamole" src="../images/guacamole.png" style="max-height:300px"></a></p> <p>In order to create the bastion machines, we first must upload a RHEL 8.7 OS ISO file to the vCenter datastore. As previously explained, for this heavy task (~11GB), we will utilize the Guacamole VM.</p> <div class="admonition warning"> <p class="admonition-title">Important</p> <p>Due to potential issues, accessing the Guacamole VM through these three steps can be problematic. Persistence and multiple attempts are often necessary to successfully gain entry.</p> </div> <ol> <li> <p>Open the Guacamole VM from your IBM TechZone reservation page:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/guacamole-link.png" data-desc-position="bottom"><img alt="70" src="../images/guacamole-link.png" style="max-height:600px"></a></p> </li> <li> <p>This will open the following web app. Expand the All Connections section to see the two options for accessing the Guacamole VM. Use the Remote Desktop option:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/guacamole-allconnections.png" data-desc-position="bottom"><img alt="71" src="../images/guacamole-allconnections.png" style="max-height:600px"></a></p> </li> <li> <p>Once you have gained access to the Guacamole VM, you should see a RHEL regular desktop.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/guacamole-desktop.png" data-desc-position="bottom"><img alt="72" src="../images/guacamole-desktop.png" style="max-height:800px"></a></p> </li> <li> <p>Click on Activities at the top left corner of the desktop and click on Firefox to open the web browser.</p> </li> <li> <p>Download the ISO from Red Hat portal:</p> <ul> <li><a href="https://access.redhat.com/downloads/content/479/ver=/rhel---8/8.7/x86_64/product-software" target="_blank"><strong>Link to RH 8.7 SO ISO file</strong></a></li> </ul> </li> <li> <p>Point the browser to the link in order to download the files.</p> </li> <li> <p>Once we have downloaded the ISO file, open the vCenter using the bookmark located at the bookmarks toolbar. You can find the credentials for the vCenter in your IBM TechZone reservation.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/vcenter-link.png" data-desc-position="bottom"><img alt="4" src="../images/vcenter-link.png" style="max-height:300px"></a></p> </li> <li> <p>Upload the downloaded ISO file to the vCenter datastore to make it available for the bastion VMs we will create in later sections.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/8.png" data-desc-position="bottom"><img alt="8" src="../images/airgap-4-12/8.png" style="max-height:600px"></a></p> <div class="admonition info"> <p class="admonition-title">Info</p> <p>Name the folder created in step 3 as ISOs folder</p> </div> </li> <li> <p>Once the ISO image have been fully uploaded to the DataStore, you will be able to see it listed.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/vcenter-iso-listed.png" data-desc-position="bottom"><img alt="60" src="../images/vcenter-iso-listed.png" style="max-height:400px"></a></p> </li> </ol> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>We can continue to work with vCenter from our laptop's web browser. We should not need to work with the Guacamole VM anymore. </p> </div> <h2 id="8-bastion-nodes">8. Bastion Nodes<a class="headerlink" href="#8-bastion-nodes" title="Permanent link">¶</a></h2> <p>For this OpenShift installation, we'll employ two bastion nodes: an <strong>online bastion</strong> with internet access for downloading necessary components (images, executables, installation programs), and an <strong>offline bastion</strong> within our internal network without direct internet connectivity for transferring these components and executing the installation.</p> <p>First on our agenda is to establish both online and offline bastion nodes.</p> <h3 id="81-create-the-online-bastion-node">8.1. Create the online bastion node<a class="headerlink" href="#81-create-the-online-bastion-node" title="Permanent link">¶</a></h3> <p>Now, we shall proceed to create the virtual machine designated as the online bastion, which will operate using RHEL 8.7 and feature internet connectivity.</p> <table> <thead> <tr> <th><strong>Option</strong></th> <th><strong>Configuration</strong></th> </tr> </thead> <tbody> <tr> <td><strong>FQDN hostname</strong></td> <td>bastiononline.ocp4.platformengineers.xyz</td> </tr> <tr> <td><strong>Static IP Address</strong></td> <td>192.168.252.22</td> </tr> <tr> <td><strong>Operating System</strong></td> <td>Red Hat Enterprise Linux</td> </tr> <tr> <td><strong>OS Version</strong></td> <td>8.7</td> </tr> <tr> <td><strong>OS Language</strong></td> <td>English-US</td> </tr> </tbody> </table> <ol> <li> <p>Click on the VMs tab. Then, right click on the folder assigned to our vCenter user and select "New Virtual Machine".</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/9.png" data-desc-position="bottom"><img alt="9" src="../images/airgap-4-12/9.png" style="max-height:500px"></a></p> </li> <li> <p>Click next on the first page to go to the page where we will assign a name to the bastion online virtual machine. In our case we will use <code>bastiononline.ocp4.platformengineers.xyz</code> for the name of the VM we are creating.</p> </li> <li> <p>Skip step 3.</p> </li> <li> <p>On the step 4, select datastore started with <code>gym-</code> and click next:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/10.png" data-desc-position="bottom"><img alt="10" src="../images/airgap-4-12/10.png" style="max-height:300px"></a></p> </li> <li> <p>Skip the step 5.</p> </li> <li> <p>On the step 6, select the "Guest OS Family" as <code>Linux</code> and "Guest OS Version" as <code>Red Hat Enterprise Linux 8 (64-bit)</code> and click next.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/61.png" data-desc-position="bottom"><img alt="61" src="../images/airgap-4-12/61.png" style="max-height:300px"></a></p> </li> <li> <p>On the step 7, specify the details of the virtual machine according to the table below</p> <table> <thead> <tr> <th><strong>Type</strong></th> <th><strong>vCPU</strong></th> <th><strong>RAM Memory</strong></th> <th><strong>Storage (system)</strong></th> <th><strong>Storage (data)</strong></th> </tr> </thead> <tbody> <tr> <td>Bastion</td> <td>8 vCPU</td> <td>32 GB</td> <td>700 GB</td> <td>0 GB</td> </tr> </tbody> </table> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/11.png" data-desc-position="bottom"><img alt="11" src="../images/airgap-4-12/11.png" style="max-height:600px"></a></p> <p>On "New CD/DVD Drive" select <code>Datastore ISO File</code> and then navigate to the ISO folder where we uploaded the RH 8.7 OS ISO file in the previous section and select such ISO file.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/12.png" data-desc-position="bottom"><img alt="12" src="../images/airgap-4-12/12.png" style="max-height:500px"></a></p> <p>Make sure "New CD/DVD Drive" connect is <strong>checked</strong> and click next.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/13.png" data-desc-position="bottom"><img alt="13" src="../images/airgap-4-12/13.png" style="max-height:70px"></a></p> </li> <li> <p>Finish the creation of the VM.</p> </li> </ol> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>We might need to click on the refresh arrow icon at the top center of the vCenter web application in order to see our newly created VM.</p> </div> <p>Once the VM has been created successfully we must start the machine and proceed with the OS installation.</p> <ol> <li> <p>Select our newly created VM and click on the play button to start the VM.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/62.png" data-desc-position="bottom"><img alt="62" src="../images/airgap-4-12/62.png" style="max-height:300px"></a></p> </li> <li> <p>Click on launch web console to proceed with the OS installation.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/14.png" data-desc-position="bottom"><img alt="14" src="../images/airgap-4-12/14.png" style="max-height:300px"></a></p> </li> <li> <p>Click on the screen that will pop up and select install Red Hat OS.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/63.png" data-desc-position="bottom"><img alt="63" src="../images/airgap-4-12/63.png" style="max-height:500px"></a></p> </li> <li> <p>Click Continue</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/15.png" data-desc-position="bottom"><img alt="15" src="../images/airgap-4-12/15.png" style="max-height:600px"></a></p> </li> <li> <p>Add disk.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/18.png" data-desc-position="bottom"><img alt="18" src="../images/airgap-4-12/18.png" style="max-height:600px"></a></p> </li> <li> <p>Select <code>Custom</code> for the "Storage Configuration" and click done.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/19.png" data-desc-position="bottom"><img alt="19" src="../images/airgap-4-12/19.png" style="max-height:600px"></a></p> </li> <li> <p>Click on the <code>Click here to create them automatically</code> link so that a default mount point and partition are created.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/64.png" data-desc-position="bottom"><img alt="64" src="../images/airgap-4-12/64.png" style="max-height:600px"></a></p> </li> <li> <p>Set the amount of disk for the <code>/home</code> and <code>/</code> mount points as described in the picture below. This will allow us to have the required space for the things to be installed at the root mount point which is where the <code>root</code> user will inherit from.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/20.png" data-desc-position="bottom"><img alt="20" src="../images/airgap-4-12/20.png" style="max-height:600px"></a></p> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>When we set the disk space for a mount point in the text box, we need to click on the <code>Update Settings</code> button that will get enabled to take effect.</p> </div> </li> <li> <p>Click Done and Accept Changes on the message with the changes to be applied that will pop up.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/65.png" data-desc-position="bottom"><img alt="65" src="../images/airgap-4-12/65.png" style="max-height:400px"></a></p> </li> <li> <p>On the main menu, click now on the Software Selection option at the bottom of the center options colunm. Then, select the "Minimal install" and click done.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/21.png" data-desc-position="bottom"><img alt="21" src="../images/airgap-4-12/21.png" style="max-height:600px"></a></p> </li> <li> <p>Create the root credentials, for example <code>passw0rd</code> and click done.</p> </li> <li> <p>Click Begin Installation.</p> </li> <li> <p>When the installation finishes, click on Reboot System.</p> </li> </ol> <p>After the OS is installed and we restarted the server, login with root credentials (<code>root/passw0rd</code>). We will be able to connect using the web console link which will open a new tab in our browser. </p> <ol> <li> <p>Use Network Manager Tool UI (nmtui) for configuring the network properties.</p> <div class="language-bash copy highlight"><span class="filename">[root@localhost ~]#</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>nmtui
</span></code></pre></div> </li> <li> <p>Click on Edit a connection</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/23.png" data-desc-position="bottom"><img alt="23" src="../images/airgap-4-12/23.png" style="max-height:300px"></a></p> </li> <li> <p>Select "ens192".</p> </li> <li>Use the arrows and intro to change the IPv4 CONFIGURATION from <code>&lt;Automatic&gt;</code> to <code>&lt;Manual&gt;</code></li> <li>Then, use the arrows and intro to <code>&lt;Show&gt;</code> details.</li> <li> <p>Fill the properties as shown in the pictures below</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/24.png" data-desc-position="bottom"><img alt="24" src="../images/airgap-4-12/24.png" style="max-height:600px"></a></p> </li> <li> <p>Use the arrows and space bar to select the <code>Automatically connect</code> option at the bottom.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/25.png" data-desc-position="bottom"><img alt="25" src="../images/airgap-4-12/25.png" style="max-height:260px"></a></p> </li> <li> <p>Click <code>&lt;OK&gt;</code></p> </li> <li>Click <code>&lt;Back&gt;</code></li> <li>Click <code>&lt;OK&gt;</code></li> </ol> <h3 id="82-create-the-offline-bastion-node">8.2. Create the offline bastion node<a class="headerlink" href="#82-create-the-offline-bastion-node" title="Permanent link">¶</a></h3> <p>Follow the same steps from the previous section in order to create the offline bastion with the following specs:</p> <table> <thead> <tr> <th><strong>Option</strong></th> <th><strong>Configuration</strong></th> </tr> </thead> <tbody> <tr> <td><strong>FQDN hostname</strong></td> <td>bastion.ocp4.platformengineers.xyz</td> </tr> <tr> <td><strong>Static IP Address</strong></td> <td>192.168.252.23</td> </tr> <tr> <td><strong>Operating System</strong></td> <td>Red Hat Enterprise Linux</td> </tr> <tr> <td><strong>OS Version</strong></td> <td>8.7</td> </tr> <tr> <td><strong>OS Language</strong></td> <td>English-US</td> </tr> </tbody> </table> <p>We also need to edit the network configuration but this time we need to configure it so that the offline bastion does not have internet access but we can still connect to it via ssh. </p> <ol> <li> <p>We will use Network Manager Tool UI (nmtui) for configuring the network properties.</p> <div class="language-bash copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>nmtui
</span></code></pre></div> </li> <li> <p>Click on Edit a connection</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/23.png" data-desc-position="bottom"><img alt="23" src="../images/airgap-4-12/23.png" style="max-height:300px"></a></p> </li> <li> <p>Select "ens192".</p> </li> <li>Use the arrows and intro to change the IPv4 CONFIGURATION from <code>&lt;Automatic&gt;</code> to <code>&lt;Manual&gt;</code></li> <li>Then, use the arrows and intro to <code>&lt;Show&gt;</code> details.</li> <li> <p>Fill the properties as shown in the pictures below</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/66.png" data-desc-position="bottom"><img alt="66" src="../images/airgap-4-12/66.png" style="max-height:600px"></a></p> </li> <li> <p>Configure the routing so that we simulate no internet connection:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/67.png" data-desc-position="bottom"><img alt="67" src="../images/airgap-4-12/67.png" style="max-height:600px"></a></p> </li> <li> <p>Use the arrows and space bar to select the <code>Automatically connect</code> option at the bottom.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/25.png" data-desc-position="bottom"><img alt="25" src="../images/airgap-4-12/25.png" style="max-height:260px"></a></p> </li> <li> <p>Click <code>&lt;OK&gt;</code></p> </li> <li>Click <code>&lt;OK&gt;</code></li> <li>Click <code>&lt;Back&gt;</code></li> <li>Click <code>&lt;OK&gt;</code></li> </ol> <p>After doing this configuration, try the following commands from the offline bastion terminal to check the connection to internet:</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>ping 192.168.252.1
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>PING 192.168.252.1 (192.168.252.1) 56(84) bytes of data.
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>64 bytes from 192.168.252.1: icmp_seq=1 ttl=64 time=0.398 ms
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>^C
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>--- 192.168.252.1 ping statistics ---
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>1 packets transmitted, 1 received, 0% packet loss, time 0ms
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>rtt min/avg/max/mdev = 0.398/0.398/0.398/0.000 ms
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ping 8.8.8.8
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>connect: Network is unreachable
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>ping www.google.com
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>ping: www.google.com: Name or service not known
</span></code></pre></div> <div class="admonition tip"> <p class="admonition-title">Important</p> <p>From now on, we can use our own laptop's terminal to ssh into the different VMs and carry on with the OpenShift installation. We should not need to use the web console of the bastions from the vCenter UI.</p> </div> <p>From your laptop's terminal, make sure you can ssh into the online bastion and offline bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>ssh root@192.168.252.22
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>ssh root@192.168.253.22
</span></code></pre></div> <h2 id="9-disable-selinux-in-the-online-bastion">9. Disable SELINUX in the online bastion<a class="headerlink" href="#9-disable-selinux-in-the-online-bastion" title="Permanent link">¶</a></h2> <p>In order to perform the correct configuration of the bastion node, it is recommended that the <code>SELINUX</code> is deactivated first.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>It is not strictly necessary that Linux Security is deactivated in order to install OpenShift. However, it is recommended as it eases the installation. Otherwise, you would need to open several specific ports and add rules to the firewall so that the needed communication is allowed.</p> </div> <ol> <li> <p>Access the online bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ssh root@192.168.252.22
</span></code></pre></div> </li> <li> <p>Open the <code>/etc/selinux/config</code> to disable the <code>SELINUX</code></p> <div class="language-bash copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>vi<span class="w"> </span>/etc/selinux/config
</span></code></pre></div> </li> <li> <p>Make sure your file looks like below, where the highlighted line has been modified:</p> <div class="language-properties no-copy highlight"><span class="filename">/etc/selinux/config</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># This file controls the state of SELinux on the system.</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="c1"># SELINUX= can take one of these three values:</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="c1"># enforcing - SELinux security policy is enforced.</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># permissive - SELinux prints warnings instead of enforcing.</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1"># disabled - No SELinux policy is loaded.</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="hll"><span class="na">SELINUX</span><span class="o">=</span><span class="s">disabled</span>
</span></span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="c1"># SELINUXTYPE= can take one of these three values:</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="c1"># targeted - Targeted processes are protected,</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="c1"># minimum - Modification of targeted policy. Only selected processes are protected.</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="c1"># mls - Multi Level Security protection. SELINUXTYPE=targeted</span>
</span></code></pre></div> <p>Once the change is made, save and exit the file (<code>esc</code> and <code>:wq</code>) </p> </li> <li> <p>Restart the server for the changes to take effect.</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>init 6
</span></code></pre></div> </li> </ol> <h2 id="10-disable-firewall-in-the-online-bastion">10. Disable firewall in the online bastion<a class="headerlink" href="#10-disable-firewall-in-the-online-bastion" title="Permanent link">¶</a></h2> <p>Also, and since it is an internal network, the firewall of the machine is deactivated</p> <ol> <li> <p>Access the online bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>ssh root@192.168.252.22
</span></code></pre></div> </li> <li> <p>Stop the firewall:</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>systemctl stop firewalld
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>systemctl disable firewalld
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Removed /etc/systemd/system/multi-user.target.wants/firewalld.service. 
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Removed /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
</span></code></pre></div> </li> </ol> <h2 id="11-configure-the-hostname-for-the-online-bastion">11. Configure the hostname for the online bastion<a class="headerlink" href="#11-configure-the-hostname-for-the-online-bastion" title="Permanent link">¶</a></h2> <p>We need to change the online bastion machine's default hostname as we will be referring to this machine from the DNS, load balancer, etc using a different hostname.</p> <ol> <li> <p>Edit the hostname of the machine</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>vi /etc/hostname
</span></code></pre></div> <p>set the hostname to <code>bastiononline.ocp4.platformengineers.xyz</code></p> </li> <li> <p>Once the change has been made, restart the server for it to take effect.</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>init 6
</span></code></pre></div> </li> <li> <p>Access the online bastion again:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>ssh root@192.168.252.22
</span></code></pre></div> </li> <li> <p>Check the hostname was successfully modified:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>ping bastiononline.ocp4.platformengineers.xyz
</span></code></pre></div> <p>You should see similar output as below:</p> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>PING bastiononline.ocp4.platformengineers.xyz(bastiononline.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:3e00%ens192)) 56 data bytes
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>64 bytes from bastiononline.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:3e00%ens192): icmp_seq=1 ttl=64 time=0.036 ms
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>64 bytes from bastiononline.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:3e00%ens192): icmp_seq=2 ttl=64 time=0.040 ms
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>64 bytes from bastiononline.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:3e00%ens192): icmp_seq=3 ttl=64 time=0.042 ms
</span></code></pre></div> </li> <li> <p>Finish the ping command with <code>ctrl+c</code></p> </li> </ol> <h2 id="12-install-required-redhat-packages-in-the-online-bastion">12. Install required RedHat packages in the online bastion<a class="headerlink" href="#12-install-required-redhat-packages-in-the-online-bastion" title="Permanent link">¶</a></h2> <p>For the installation of rpm packages on the online machine, the RHEL 8.7 OS ISO file that we created the VM from will help us.</p> <div class="admonition info"> <p class="admonition-title">Note</p> <p>We can skip this step if we register the machine with a Red Hat subscription, which falls outside this workshop.</p> </div> <ol> <li> <p>Make sure that, in the vCenter, the online bastion has the CD/DVD drive as connected:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/29.png" data-desc-position="bottom"><img alt="29" src="../images/airgap-4-12/29.png" style="max-height:100px"></a></p> </li> <li> <p>The purpose of having the CD/DVD drive connected is that we can now mount this drive in the file system:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>mkdir /mnt/disc
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>mount /dev/sr0 /mnt/disc
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>mount: /mnt/disc: WARNING: device write-protected, mounted read-only.
</span></code></pre></div> </li> <li> <p>Create the following following <code>rhel87dvd.repo</code> file that will define our RHEL OS repos:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>vi /etc/yum.repos.d/rhel87dvd.repo
</span></code></pre></div> <div class="language-properties copy highlight"><span class="filename">rhel87dvd.repo</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="na">[InstallMediaBase]</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="na">name</span><span class="o">=</span><span class="s">Red Hat Enterprise Linux 8.7.0 Base</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="na">mediaid</span><span class="o">=</span><span class="s">None</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="na">metadata_expire</span><span class="o">=</span><span class="s">-1</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="na">gpgcheck</span><span class="o">=</span><span class="s">0</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="na">cost</span><span class="o">=</span><span class="s">500</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="na">enabled</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="na">baseurl</span><span class="o">=</span><span class="s">file:///mnt/disc/BaseOS</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="na">[InstallMediaApps]</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="na">name</span><span class="o">=</span><span class="s">Red Hat Enterprise Linux 8.7.0 App</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="na">mediaid</span><span class="o">=</span><span class="s">None</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="na">metadata_expire</span><span class="o">=</span><span class="s">-1</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="na">gpgcheck</span><span class="o">=</span><span class="s">0</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="na">cost</span><span class="o">=</span><span class="s">500</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="na">enabled</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="na">baseurl</span><span class="o">=</span><span class="s">file:///mnt/disc/AppStream</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="na">[InstallMediaParches]</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="na">name</span><span class="o">=</span><span class="s">Red Hat Enterprise Linux KErnel</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="na">mediaid</span><span class="o">=</span><span class="s">None</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="na">metadata_expire</span><span class="o">=</span><span class="s">-1</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="na">gpgcheck</span><span class="o">=</span><span class="s">0</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="na">cost</span><span class="o">=</span><span class="s">500</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="na">enabled</span><span class="o">=</span><span class="s">0</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="na">baseurl</span><span class="o">=</span><span class="s">file:///mnt/parches</span>
</span></code></pre></div> </li> <li> <p>Make sure the cache is cleaned:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>yum clean all
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>Updating Subscription Management repositories.
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>Unable to read consumer identity
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>This system is not registered with an entitlement server. You can use subscription-manager to register.
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>0 files removed
</span></code></pre></div> </li> <li> <p>Make sure the new repositories are enabled:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>yum repolist enabled
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>Updating Subscription Management repositories.
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>Unable to read consumer identity
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>This system is not registered with an entitlement server. You can use subscription-manager to register.
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>repo id                                   repo name
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="hll">InstallMediaApps                          Red Hat Enterprise Linux 8.7.0 App
</span></span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="hll">InstallMediaBase                          Red Hat Enterprise Linux 8.7.0 Base
</span></span></code></pre></div> </li> </ol> <p>Once you have created the offline repository and confirmed it is enabled, the required packages can be installed with the <strong>yum</strong> utility.</p> <p>The following packages have been installed on the online bastion server. Some packages may not be used during the execution of online commands, but they are installed so that the "online" and "offline" bastion settings are as identical as possible.</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>yum install -y  podman \
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>                jq openssl httpd-tools curl wget telnet nfs-utils \
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>                httpd.x86_64 \
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>                bind bind-utils rsync mkisofs
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>Updating Subscription Management repositories.
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>Unable to read consumer identity
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>This system is not registered with an entitlement server. You can use subscription-manager to register.
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>Red Hat Enterprise Linux 8.7.0 Base                                                                                          40 MB/s | 2.4 MB     00:00    
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>Red Hat Enterprise Linux 8.7.0 App                                                                                           53 MB/s | 7.8 MB     00:00    
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>Package openssl-1:1.1.1k-7.el8_6.x86_64 is already installed.
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>Package curl-7.61.1-25.el8.x86_64 is already installed.
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>Dependencies resolved.
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>============================================================================================================================================================
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a> Package                                   Architecture        Version                                                  Repository                     Size
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>============================================================================================================================================================
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>Installing:
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a> bind                                      x86_64              32:9.11.36-5.el8                                         InstallMediaApps              2.1 M
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a> bind-utils                                x86_64              32:9.11.36-5.el8                                         InstallMediaApps              452 k
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a> genisoimage                               x86_64              1.1.11-39.el8                                            InstallMediaApps              316 k
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a> httpd                                     x86_64              2.4.37-51.module+el8.7.0+16050+02173b8e                  InstallMediaApps              1.4 M
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a> httpd-tools                               x86_64              2.4.37-51.module+el8.7.0+16050+02173b8e                  InstallMediaApps              109 k
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a> jq                                        x86_64              1.6-3.el8                                                InstallMediaApps              202 k
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a> nfs-utils                                 x86_64              1:2.3.3-57.el8                                           InstallMediaBase              515 k
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a> podman                                    x86_64              3:4.2.0-1.module+el8.7.0+16772+33343656                  InstallMediaApps               12 M
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a> rsync                                     x86_64              3.1.3-19.el8                                             InstallMediaBase              410 k
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a> telnet                                    x86_64              1:0.17-76.el8                                            InstallMediaApps               72 k
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a> wget                                      x86_64              1.19.5-10.el8                                            InstallMediaApps              734 k
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>...
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>...
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>Complete!
</span></code></pre></div> <p>Finally, we need to install Ansible on the system. However, this package is not included in the RHEL repositories configured previously. As a result, we will need to install it manually.</p> <ol> <li> <p>Download the Ansible RPM package to your laptop from the Red Hat portal.</p> <ul> <li><a href="https://access.redhat.com/downloads/content/ansible/2.9.27-1.el8ap/noarch/fd431d51/package" target="_blank"><strong>Link to Ansible rpm</strong></a></li> </ul> </li> <li> <p>Source copy the rpm package to the online bastion</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>scp ansible-2.9.27-1.el8ap.noarch.rpm root@192.168.252.22:/root
</span></code></pre></div> </li> <li> <p>Install it:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>yum localinstall -y ansible-2.9.27-1.el8ap.noarch.rpm
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>Updating Subscription Management repositories.
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>Unable to read consumer identity
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>This system is not registered with an entitlement server. You can use subscription-manager to register.
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>Last metadata expiration check: 0:09:27 ago on Mon 06 Nov 2023 05:40:03 PM CET.
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>Dependencies resolved.
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>============================================================================================================================================================
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>Package                                  Architecture          Version                                               Repository                       Size
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>============================================================================================================================================================
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>Installing:
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>ansible                                  noarch                2.9.27-1.el8ap                                        @commandline                     17 M
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>...
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>...
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>Complete!
</span></code></pre></div> </li> </ol> <h2 id="13-download-openshift-utilities-to-the-online-bastion">13. Download OpenShift utilities to the online bastion<a class="headerlink" href="#13-download-openshift-utilities-to-the-online-bastion" title="Permanent link">¶</a></h2> <p>A directory structure is created to accommodate the different binaries that are downloaded.</p> <ul> <li> <p>Create a directory for the registry and create the necessary directories for the registry.</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>mkdir /root/registry
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>cd registry/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>mkdir auth certs data downloads
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>total<span class="w"> </span><span class="m">4</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>dr-xr-x---.<span class="w"> </span><span class="m">7</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:43<span class="w"> </span>..
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>downloads
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>data
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>certs
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>auth
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>drwxr-xr-x<span class="w">  </span><span class="m">6</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">60</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>.
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>cd downloads/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline downloads]</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>mkdir images tools secrets
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>total<span class="w"> </span><span class="m">0</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>drwxr-xr-x<span class="w"> </span><span class="m">6</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">60</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>..
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:59<span class="w"> </span>tools
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:59<span class="w"> </span>secrets
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:59<span class="w"> </span>images
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">48</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:59<span class="w"> </span>.
</span></code></pre></div> </li> </ul> <p>The folder structure that should have got created should look like this:</p> <div class="language-text no-copy highlight"><span class="filename">Directory structure</span><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>/root
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>`-- registry
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>    |-- auth
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    |-- certs
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>    |-- data
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>    `-- downloads
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>        |-- images
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>        |-- secrets
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>        `-- tools
</span></code></pre></div> <p>For the OpenShift client, the following steps have been followed:</p> <ul> <li> <p>OpenShift client download:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline downloads]</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>cd tools/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.16.9/openshift-client-linux-amd64-rhel8-4.16.9.tar.gz
</span></code></pre></div> </li> <li> <p>Extracting the contents of the downloaded file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>tar -xvf openshift-client-linux-amd64-rhel8-4.16.9.tar.gz
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>README.md
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>oc
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>kubectl
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>total<span class="w"> </span><span class="m">1156008</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">01</span>:54<span class="w"> </span>oc
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">01</span>:54<span class="w"> </span>kubectl
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">950</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">01</span>:54<span class="w"> </span>README.md
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">66705673</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-client-linux-amd64-rhel8-4.16.9.tar.gz
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">48</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">07</span>:55<span class="w"> </span>..
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">164</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">11</span>:19<span class="w"> </span>.
</span></code></pre></div> </li> <li> <p>Copy to a location accessible from your $PATH (e.g. /usr/bin):</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>cp /root/registry/downloads/tools/oc /usr/bin/oc
</span></code></pre></div> </li> </ul> <p>For the OpenShift installer, the following steps should be followed:</p> <ul> <li> <p>Downloading the OpenShift Installer</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.16.9/openshift-install-linux-4.16.9.tar.gz
</span></code></pre></div> </li> <li> <p>Extract the contents of the downloaded file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>tar -xvf openshift-install-linux-4.16.9.tar.gz
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>README.md
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>openshift-install
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>total<span class="w"> </span><span class="m">1156008</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">01</span>:54<span class="w"> </span>oc
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">01</span>:54<span class="w"> </span>kubectl
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">707731456</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>openshift-install
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">706</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>README.md
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">66705673</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-client-linux-amd64-rhel8-4.16.9.tar.gz
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">510253136</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-install-linux-4.16.9.tar.gz
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">48</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">07</span>:55<span class="w"> </span>..
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">164</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">11</span>:19<span class="w"> </span>.
</span></code></pre></div> </li> <li> <p>Copy to a location accessible from your $PATH (e.g. /usr/bin):</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>cp /root/registry/downloads/tools/openshift-install /usr/bin/openshift-install
</span></code></pre></div> </li> </ul> <p>For the Mirror registry, the following steps should be followed:</p> <ul> <li> <p>Download the mirror-registry</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>wget https://mirror.openshift.com/pub/cgw/mirror-registry/latest/mirror-registry-amd64.tar.gz
</span></code></pre></div> </li> <li> <p>Extracting the contents of the downloaded file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>tar -xvf mirror-registry-amd64.tar.gz
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>image-archive.tar
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>execution-environment.tar
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>mirror-registry
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>total<span class="w"> </span><span class="m">4019476</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">160465008</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">00</span>:49<span class="w"> </span>oc
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">160465008</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">00</span>:49<span class="w"> </span>kubectl
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">707731456</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>openshift-install
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">706</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>README.md
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">66941882</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-client-linux-4.16.9.tar.gz
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">510253136</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-install-linux-4.16.9.tar.gz
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">9824888</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:46<span class="w"> </span>mirror-registry
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">113418240</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:47<span class="w"> </span>sqlite3.tar
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">316753920</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:50<span class="w"> </span>execution-environment.tar
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1454929920</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:50<span class="w"> </span>image-archive.tar
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">607056480</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">11</span>:44<span class="w"> </span>mirror-registry-amd64.tar.gz
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">48</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">19</span>:16<span class="w"> </span>..
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">       </span><span class="m">4096</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">19</span>:41<span class="w"> </span>.
</span></code></pre></div> </li> </ul> <p>For the oc-mirror plugin, the following steps should be followed:</p> <ul> <li> <p>Download the oc mirror program to make mirror of OCP and its operators</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.16.19/oc-mirror.tar.gz
</span></code></pre></div> </li> <li> <p>Extracting the contents of the downloaded file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>tar xvfz oc-mirror.tar.gz
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>oc-mirror
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>total<span class="w"> </span><span class="m">4245772</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">01</span>:54<span class="w"> </span>oc
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">01</span>:54<span class="w"> </span>kubectl
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">707731456</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>openshift-install
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">706</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>README.md
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">66705673</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-client-linux-amd64-rhel8-4.16.9.tar.gz
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">510253136</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-install-linux-4.16.9.tar.gz
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">9824888</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:46<span class="w"> </span>mirror-registry
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">113418240</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:47<span class="w"> </span>sqlite3.tar
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">316753920</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:50<span class="w"> </span>execution-environment.tar
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1454929920</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:50<span class="w"> </span>image-archive.tar
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">607056480</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">11</span>:44<span class="w"> </span>mirror-registry-amd64.tar.gz
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>-rw-r-----<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="m">984</span><span class="w">  </span><span class="m">984</span><span class="w">  </span><span class="m">165699280</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">02</span>:15<span class="w"> </span>oc-mirror
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">67385243</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">03</span>:02<span class="w"> </span>oc-mirror.tar.gz
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">48</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">19</span>:16<span class="w"> </span>..
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">       </span><span class="m">4096</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">09</span>:22<span class="w"> </span>.
</span></code></pre></div> </li> <li> <p>Copy to a location accessible from your $PATH (e.g. /usr/local/bin):</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>chmod +x /root/registry/downloads/tools/oc-mirror
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>cp /root/registry/downloads/tools/oc-mirror /usr/local/bin/
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>oc-mirror help
</span></code></pre></div> </li> </ul> <p>For the Butane tool, the following steps should be followed:</p> <ul> <li> <p>Download butane</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>curl https://mirror.openshift.com/pub/openshift-v4/clients/butane/latest/butane-amd64 --output butane
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline tools]</span><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>total<span class="w"> </span><span class="m">4019476</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">160465008</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">00</span>:49<span class="w"> </span>oc
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>-rwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">160465008</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">00</span>:49<span class="w"> </span>kubectl
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">707731456</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>openshift-install
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">706</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">03</span>:44<span class="w"> </span>README.md
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">66941882</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-client-linux-4.16.9.tar.gz
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">510253136</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span>:05<span class="w"> </span>openshift-install-linux-4.16.9.tar.gz
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">9824888</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:46<span class="w"> </span>mirror-registry
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">113418240</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:47<span class="w"> </span>sqlite3.tar
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">316753920</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:50<span class="w"> </span>execution-environment.tar
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1454929920</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span>:50<span class="w"> </span>image-archive.tar
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">607056480</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">11</span>:44<span class="w"> </span>mirror-registry-amd64.tar.gz
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">48</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">19</span>:16<span class="w"> </span>..
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">       </span><span class="m">4096</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">19</span>:41<span class="w"> </span>.
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">8070568</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">19</span>:41<span class="w"> </span>butane
</span></code></pre></div> </li> </ul> <p>For the ISO Maker tool, the following steps should be followed:</p> <ul> <li> <p>Download the ISO Maker</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>cd /root/
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>mkdir Coreos-iso-maker
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>cd Coreos-iso-maker/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline Coreos-iso-maker]</span><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>yum install -y git
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>Updating Subscription Management repositories.
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>Unable to read consumer identity
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>This system is not registered with an entitlement server. You can use subscription-manager to register.
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>Last metadata expiration check: 0:30:40 ago on Mon 06 Nov 2023 05:40:03 PM CET.
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>Dependencies resolved.
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>============================================================================================================================================================
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>Package                               Architecture          Version                                                  Repository                       Size
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>============================================================================================================================================================
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>Installing:
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a> git                                   x86_64                2.31.1-2.el8                                             InstallMediaApps                161 k
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a>...
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a>...
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a>Complete!
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline Coreos-iso-maker]</span><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>git clone https://github.com/chuckersjp/coreos-iso-maker
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>Cloning into 'coreos-iso-maker'...
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>remote: Enumerating objects: 391, done.
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>remote: Counting objects: 100% (129/129), done.
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>remote: Compressing objects: 100% (37/37), done.
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>remote: Total 391 (delta 116), reused 93 (delta 92), pack-reused 262
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>Receiving objects: 100% (391/391), 70.81 KiB | 1.16 MiB/s, done.
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>Resolving deltas: 100% (246/246), done.
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline Coreos-iso-maker]</span><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>total<span class="w"> </span><span class="m">8</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>dr-xr-x---.<span class="w"> </span><span class="m">8</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">11</span>:40<span class="w"> </span>..
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>drwxr-xr-x<span class="w">  </span><span class="m">3</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">30</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">11</span>:42<span class="w"> </span>.
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>drwxr-xr-x<span class="w">  </span><span class="m">4</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">11</span>:42<span class="w"> </span>coreos-iso-maker
</span></code></pre></div> </li> </ul> <h2 id="14-optional-expand-bastion-boot-disk">14. (optional) Expand bastion boot disk<a class="headerlink" href="#14-optional-expand-bastion-boot-disk" title="Permanent link">¶</a></h2> <div class="admonition info"> <p class="admonition-title">Info</p> <p>You dont need to complete this section. It is only for reference to understand what you would need to do should you require to increase disk space on any of your bastion machines.</p> </div> <p>In case you need to increase the bastion online’s disk size because at the creation moment you didn’t set the correct amount of storage, you must follow the next steps in vCenter with the vm machine stopped:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/30.png" data-desc-position="bottom"><img alt="30" src="../images/airgap-4-12/30.png" style="max-height:700px"></a></p> <p>Set the correct space you need on the disk and then start the machine and follow these commands to create a new partition:</p> <ol> <li> <p>Access the online bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>ssh root@192.168.252.22
</span></code></pre></div> </li> <li> <p>Check the actual partitions size</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>df -h
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>Filesystem             Size  Used Avail Use% Mounted on
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>devtmpfs                16G     0   16G   0% /dev
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>tmpfs                   16G     0   16G   0% /dev/shm
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>tmpfs                   16G  8.7M   16G   1% /run
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>tmpfs                   16G     0   16G   0% /sys/fs/cgroup
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="hll">/dev/mapper/rhel-root  621G   12G  610G   2% /
</span></span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>/dev/sda2             1014M  211M  804M  21% /boot
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>/dev/sda1              599M  5.8M  594M   1% /boot/efi
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>/dev/mapper/rhel-home   62G  473M   62G   1% /home
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a>tmpfs                  3.2G     0  3.2G   0% /run/user/0
</span></code></pre></div> </li> <li> <p>List the partition tables</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>fdisk -l
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>Register this system with Red Hat Insights: insights-client --register
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>Create an account or view all your systems at https://red.ht/insights-dashboard
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>Last login: Mon Nov  6 18:32:23 2023 from 192.168.253.2
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>[root@bastiononline ~]# fdisk -l
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>Disk /dev/sda: 1 TiB, 1099511627776 bytes, 2147483648 sectors
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>Units: sectors of 1 * 512 = 512 bytes
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>Disklabel type: gpt
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>Disk identifier: 68D049D0-0D01-44BA-AF0F-9371047971AE
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>Device          Start        End    Sectors   Size Type
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a>/dev/sda1        2048    1230847    1228800   600M EFI System
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>/dev/sda2     1230848    3327999    2097152     1G Linux filesystem
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a>/dev/sda3     3328000 1468004351 1464676352 698.4G Linux LVM
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="hll">/dev/sda4  1468004352 2147483614  679479263   324G Linux filesystem
</span></span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a>
</span><span id="__span-80-18"><a id="__codelineno-80-18" name="__codelineno-80-18" href="#__codelineno-80-18"></a>
</span><span id="__span-80-19"><a id="__codelineno-80-19" name="__codelineno-80-19" href="#__codelineno-80-19"></a>Disk /dev/mapper/rhel-root: 621 GiB, 666793672704 bytes, 1302331392 sectors
</span><span id="__span-80-20"><a id="__codelineno-80-20" name="__codelineno-80-20" href="#__codelineno-80-20"></a>Units: sectors of 1 * 512 = 512 bytes
</span><span id="__span-80-21"><a id="__codelineno-80-21" name="__codelineno-80-21" href="#__codelineno-80-21"></a>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span id="__span-80-22"><a id="__codelineno-80-22" name="__codelineno-80-22" href="#__codelineno-80-22"></a>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span id="__span-80-23"><a id="__codelineno-80-23" name="__codelineno-80-23" href="#__codelineno-80-23"></a>
</span><span id="__span-80-24"><a id="__codelineno-80-24" name="__codelineno-80-24" href="#__codelineno-80-24"></a>
</span><span id="__span-80-25"><a id="__codelineno-80-25" name="__codelineno-80-25" href="#__codelineno-80-25"></a>Disk /dev/mapper/rhel-swap: 15.8 GiB, 16924016640 bytes, 33054720 sectors
</span><span id="__span-80-26"><a id="__codelineno-80-26" name="__codelineno-80-26" href="#__codelineno-80-26"></a>Units: sectors of 1 * 512 = 512 bytes
</span><span id="__span-80-27"><a id="__codelineno-80-27" name="__codelineno-80-27" href="#__codelineno-80-27"></a>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span id="__span-80-28"><a id="__codelineno-80-28" name="__codelineno-80-28" href="#__codelineno-80-28"></a>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span id="__span-80-29"><a id="__codelineno-80-29" name="__codelineno-80-29" href="#__codelineno-80-29"></a>
</span><span id="__span-80-30"><a id="__codelineno-80-30" name="__codelineno-80-30" href="#__codelineno-80-30"></a>
</span><span id="__span-80-31"><a id="__codelineno-80-31" name="__codelineno-80-31" href="#__codelineno-80-31"></a>Disk /dev/mapper/rhel-home: 61.7 GiB, 66194505728 bytes, 129286144 sectors
</span><span id="__span-80-32"><a id="__codelineno-80-32" name="__codelineno-80-32" href="#__codelineno-80-32"></a>Units: sectors of 1 * 512 = 512 bytes
</span><span id="__span-80-33"><a id="__codelineno-80-33" name="__codelineno-80-33" href="#__codelineno-80-33"></a>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span id="__span-80-34"><a id="__codelineno-80-34" name="__codelineno-80-34" href="#__codelineno-80-34"></a>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span></code></pre></div> </li> <li> <p>Start the disk partition table tool for <code>/dev/sda</code></p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>fdisk /dev/sda
</span></code></pre></div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>We select <code>n</code> in the first command. Then, we press enter to leave the defaults. Finally, for the second command, we select <code>w</code> (to write the partitions)</p> </div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>Welcome to fdisk (util-linux 2.32.1).
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>Changes will remain in memory only, until you decide to write them.
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>Be careful before using the write command.
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>Command (m for help): n
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>Partition number (4-128, default 4): 
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>First sector (1468004352-2147483614, default 1468004352): 
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>Last sector, +sectors or +size{K,M,G,T,P} (1468004352-2147483614, default 2147483614): 
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a>Created a new partition 4 of type 'Linux filesystem' and of size 324 GiB.
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a>Command (m for help): w
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a>The partition table has been altered.
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a>Syncing disks.
</span></code></pre></div> </li> <li> <p>Expand the logical volume that has the operating system boot with the following commands</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>pvcreate /dev/sda4
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>Physical volume "/dev/sda4" successfully created.
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>vgs
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>VG   #PV #LV #SN Attr   VSize   VFree
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>rhel   1   3   0 wz--n- 698.41g    0
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>vgextend rhel /dev/sda4
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>Volume group "rhel" successfully extended
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>lvs
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>home rhel -wi-ao---- &lt;61.65g                                                    
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>root rhel -wi-ao---- 621.00g                                                    
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>swap rhel -wi-ao----  15.76g
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>lvextend -l +100%FREE /dev/rhel/root
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>Size of logical volume rhel/root changed from 621.00 GiB (158976 extents) to &lt;945.00 GiB (241919 extents).
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>Logical volume rhel/root successfully resized.
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>lsblk -f
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>NAME          FSTYPE      LABEL                    UUID                                   MOUNTPOINT
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>sda                                                                                       
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>|-sda1        vfat                                 6793-7237                              /boot/efi
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>|-sda2        xfs                                  c43ee8e7-77b7-40af-8367-ba7ef90fcbb5   /boot
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>|-sda3        LVM2_member                          kOrAn9-K2h6-RbB9-gINB-pWNL-dxVB-VkxYzZ 
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>| |-rhel-root xfs                                  ba1bba3c-dea8-4e2e-9882-fd866f6d13e8   /
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>| |-rhel-swap swap                                 868795de-6965-44bd-aee3-3181691531f7   [SWAP]
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>| `-rhel-home xfs                                  2bb2a05b-9811-4c10-ba3b-f1ab8084460a   /home
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>`-sda4        LVM2_member                          9apLnq-zxPM-HNZ3-ncc7-jgwZ-hhAg-T3GVk6 
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="hll">  `-rhel-root xfs                                  ba1bba3c-dea8-4e2e-9882-fd866f6d13e8   /
</span></span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>sr0           iso9660     RHEL-8-7-0-BaseOS-x86_64 2022-10-13-06-03-04-00
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>xfs_growfs /dev/rhel/root
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>meta-data=/dev/mapper/rhel-root  isize=512    agcount=4, agsize=40697856 blks
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>        =                       sectsz=512   attr=2, projid32bit=1
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>        =                       crc=1        finobt=1, sparse=1, rmapbt=0
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a>        =                       reflink=1    bigtime=0 inobtcount=0
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a>data     =                       bsize=4096   blocks=162791424, imaxpct=25
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a>        =                       sunit=0      swidth=0 blks
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a>naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a>log      =internal log           bsize=4096   blocks=79488, version=2
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a>        =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a>realtime =none                   extsz=4096   blocks=0, rtextents=0
</span><span id="__span-96-11"><a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a>data blocks changed from 162791424 to 247725056
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>df -h
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>Filesystem             Size  Used Avail Use% Mounted on
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a>devtmpfs                16G     0   16G   0% /dev
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a>tmpfs                   16G     0   16G   0% /dev/shm
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a>tmpfs                   16G  8.7M   16G   1% /run
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a>tmpfs                   16G     0   16G   0% /sys/fs/cgroup
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="hll">/dev/mapper/rhel-root  945G   14G  932G   2% /
</span></span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a>/dev/sda2             1014M  211M  804M  21% /boot
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a>/dev/sda1              599M  5.8M  594M   1% /boot/efi
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a>/dev/mapper/rhel-home   62G  473M   62G   1% /home
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a>tmpfs                  3.2G     0  3.2G   0% /run/user/0
</span></code></pre></div> </li> </ol> <p>Repeat on the offline bastion if required.</p> <h2 id="15-download-the-red-hat-coreos-images-to-the-online-bastion">15. Download the Red Hat CoreOS images to the online bastion<a class="headerlink" href="#15-download-the-red-hat-coreos-images-to-the-online-bastion" title="Permanent link">¶</a></h2> <p>We need to download the following CoreOS images for the installation of the different OpenShift nodes: </p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>cd /root/registry/downloads/images/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline images]</span><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>wget https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.16/4.16.3/rhcos-4.16.3-x86_64-metal.x86_64.raw.gz
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>wget https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.16/4.16.3/rhcos-4.16.3-x86_64-live.x86_64.iso
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline images]</span><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>total<span class="w"> </span><span class="m">2363592</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1213202432</span><span class="w"> </span>Apr<span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">2023</span><span class="w"> </span>rhcos-4.16.3-x86_64-live.x86_64.iso
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1207111745</span><span class="w"> </span>Apr<span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">2023</span><span class="w"> </span>rhcos-4.16.3-x86_64-metal.x86_64.raw.gz
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">48</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">17</span>:57<span class="w"> </span>..
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">98</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">20</span>:40<span class="w"> </span>.
</span></code></pre></div> <h2 id="16-mirror-images-on-the-online-bastion">16. Mirror images on the online bastion<a class="headerlink" href="#16-mirror-images-on-the-online-bastion" title="Permanent link">¶</a></h2> <p>For accessing your Red Hat OpenShift pull secret – containing credentials that allow for downloading OpenShift and associated artifacts – please proceed as follows:</p> <p><a href="https://cloud.redhat.com/openshift/install/pull-secret">https://cloud.redhat.com/openshift/install/pull-secret</a></p> <p>and download or copy the contents of the pull secret. </p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/31.png" data-desc-position="bottom"><img alt="31" src="../images/airgap-4-12/31.png" style="max-height:300px"></a> </p> <ol> <li>Open the link above and copy the contents of the Red Hat OpenShift pull secret</li> <li> <p>Paste the contents of the Red Hat OpenShift pull secret into a file.</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline images]</span><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>cd /root/registry/downloads/secrets/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline secrets]</span><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>vi pull-secret.txt
</span></code></pre></div> <div class="language-json no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="p">{</span><span class="nt">"auths"</span><span class="p">:{</span><span class="nt">"cloud.openshift.com"</span><span class="p">:{</span><span class="nt">"auth"</span><span class="p">:</span><span class="s2">"&lt;auth_secret&gt;"</span><span class="p">,</span><span class="nt">"email"</span><span class="p">:</span><span class="s2">"Miguel.Ariza.Colmenares2@ibm.com"</span><span class="p">},</span><span class="nt">"quay.io"</span><span class="p">:{</span><span class="nt">"auth"</span><span class="p">:</span><span class="s2">" [……………]TdUpHajdDRGJfUUNFUk9ncjJ4Qi01V0pUVUNWenpLcmJlZU5yWGo0Y2ZTTkYzVWU3NC05N3hQMVBvQjBCYmRiOEhMemgwc0NfYjdtNzlkVDVmVGRyY3M2ZENqZzV4dEZNWnhlTTFTWEg0UWJqeDJYb2xUQ2RmekRfNzRhOXRueGVLMnFHaFZPZVVnXzBSY2t5MXZQUzVFMjFvMA=="</span><span class="p">,</span><span class="nt">"email"</span><span class="p">:</span><span class="s2">"Miguel.Ariza.Colmenares2@ibm.com"</span><span class="p">}}}</span>
</span></code></pre></div> </li> <li> <p>Make a copy of your pull secret in JSON format:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline secrets]</span><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>cat ./pull-secret.txt | jq . &gt; ./pull-secret.json
</span></code></pre></div> <p>The contents of the file resemble the following example:</p> <div class="language-json no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="p">{</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="nt">"auths"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w">    </span><span class="nt">"cloud.openshift.com"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w">    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b3BlbnNo..."</span><span class="p">,</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"you@example.com"</span>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="w">    </span><span class="nt">"quay.io"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="w">    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b3BlbnNo..."</span><span class="p">,</span>
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"you@example.com"</span>
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a><span class="w">    </span><span class="nt">"registry.connect.redhat.com"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="w">    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NTE3Njg5Nj..."</span><span class="p">,</span>
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"you@example.com"</span>
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="w">    </span><span class="nt">"registry.redhat.io"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a><span class="w">    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NTE3Njg5Nj..."</span><span class="p">,</span>
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"you@example.com"</span>
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-107-19"><a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a><span class="p">}</span>
</span><span id="__span-107-20"><a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a><span class="p">}</span>
</span></code></pre></div> </li> </ol> <p>We need to copy the contents of the file to the container runtime directory so that it is accessible by the image download procedure. Save the file either as </p> <ul> <li><code>~/.docker/config.json</code> or </li> <li><code>$XDG_RUNTIME_DIR/containers/auth.json</code></li> </ul> <div class="language-text copy highlight"><span class="filename">[root@bastiononline secrets]</span><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>echo $XDG_RUNTIME_DIR
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>/run/user/0
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline secrets]</span><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>mkdir /run/user/0/containers
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>cp /root/registry/downloads/secrets/pull-secret.json /run/user/0/containers/auth.json
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>ls -lart /run/user/0/containers/auth.json
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">2943</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">12</span>:31<span class="w"> </span>/run/user/0/containers/auth.json
</span></code></pre></div> <p>Change directory in order to mirror the images</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline secrets]</span><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>cd /root/registry/
</span></code></pre></div> <!--

NEW METHOD IN 4.16?? Below are the instructions to mirror the OpenShift images. However, still to be done how to mirror catalogs.
https://docs.openshift.com/container-platform/4.16/installing/disconnected_install/installing-mirroring-installation-images.html

Set the required environment variables

1. Export the release version

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>OCP_RELEASE=4.16.17
</span></code></pre></div>

1. Export the local registry name and host port

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>LOCAL_REGISTRY=bastion.ocp4.csm-spgi.acme.es:8443
</span></code></pre></div>

    !!! info
        `bastion.ocp4.csm-spgi.acme.es:8443` will be the hostname and port of our container image private registry that will get installed on the offline bastion.

1. Export the local repository name

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>LOCAL_REPOSITORY=ocp4/openshift4
</span></code></pre></div>

1. Export the name of the repository to mirror

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>PRODUCT_REPO=openshift-release-dev
</span></code></pre></div>

1. Export the path to your registry pull secret

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>LOCAL_SECRET_JSON=/run/user/0/containers/auth.json
</span></code></pre></div>

1. Export the release mirror

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>RELEASE_NAME=ocp-release
</span></code></pre></div>

1. Export the type of architecture for your cluster

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>ARCHITECTURE=x86_64
</span></code></pre></div>

1. Export the path to the directory to host the mirrored images

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>REMOVABLE_MEDIA_PATH=/root/registry/data
</span></code></pre></div>

Check the actual disk space before mirroring the images

<div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>du -h
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>0   ./auth
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a>0   ./certs
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a>0   ./data
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a>2.4G    ./downloads/images
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a>3.7G    ./downloads/tools
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a>8.0K    ./downloads/secrets
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a>6.1G    ./downloads
</span><span id="__span-121-9"><a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a>6.1G    .
</span></code></pre></div>

Mirror the version images to the mirror registry

1. Change directory to `/root/registry/data`

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>cd data
</span></code></pre></div>

1. Review the images and configuration manifests to mirror

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>oc adm release mirror -a ${LOCAL_SECRET_JSON} --from=quay.io/${PRODUCT_REPO}/${RELEASE_NAME}:${OCP_RELEASE}-${ARCHITECTURE} --to=${LOCAL_REGISTRY}/${LOCAL_REPOSITORY} --to-release-image=${LOCAL_REGISTRY}/${LOCAL_REPOSITORY}:${OCP_RELEASE}-${ARCHITECTURE} --dry-run
</span></code></pre></div>

    !!! info
        The above dry run will display a list of images that will be downloaded in order to be able to install OpenShift as well as two important sections, `imageContentSources` and `ImageContentSourcePolicy`.

1. Copy to a notepad the entire **imageContentSources** section from the output of the previous command. The information about your mirrors is unique to your mirrored repository, and you must add the `imageContentSources` section to the `install-config.yaml` file during installation.

    <div class="language-yaml copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="nt">imageContentSources</span><span class="p">:</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.csm-spgi.acme.es:8443/ocp4/openshift4</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-release</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.csm-spgi.acme.es:8443/ocp4/openshift4</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-v4.0-art-dev</span>
</span></code></pre></div>

1. Copy to a notepad the the entire **ImageContentSourcePolicy** custom resource section from the output of the previous command. This custom resource will be needed by OpenShift, once installed, to know where to go to get its own OpenShift images, in case it needs them, which is to our container image private registry that will be deployed on the offline bastion.

    <div class="language-yaml copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operator.openshift.io/v1alpha1</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ImageContentSourcePolicy</span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="nt">repositoryDigestMirrors</span><span class="p">:</span>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.csm-spgi.acme.es:8443/ocp4/openshift4</span>
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-release</span>
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.csm-spgi.acme.es:8443/ocp4/openshift4</span>
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-v4.0-art-dev</span>
</span></code></pre></div>

1. Mirror the images to the directory specified earlier

    <div class="language-text copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a>oc adm release mirror -a ${LOCAL_SECRET_JSON} --to-dir=${REMOVABLE_MEDIA_PATH}/mirror quay.io/${PRODUCT_REPO}/${RELEASE_NAME}:${OCP_RELEASE}-${ARCHITECTURE}
</span></code></pre></div>

1. Make sure the mirroring process has finished successfully

    <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a>info: Mirroring completed in 1m29.32s (225.1MB/s)
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a>Success
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a>Update image:  openshift/release:4.16.17-x86_64
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a>
</span><span id="__span-127-6"><a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a>To upload local images to a registry, run:
</span><span id="__span-127-7"><a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a>
</span><span id="__span-127-8"><a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a>    oc image mirror --from-dir=/root/registry/data/mirror &#39;file://openshift/release:4.16.17-x86_64*&#39; REGISTRY/REPOSITORY
</span><span id="__span-127-9"><a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a>
</span><span id="__span-127-10"><a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a>Configmap signature file /root/registry/data/mirror/config/signature-sha256-a5bfe05de4c9a5cf.json created
</span></code></pre></div>

1. Check the actual disk space after mirroring the images

    <div class="language-text no-copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a>[root@bastiononline registry]# du -h /root/registry/
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a>0   /root/registry/auth
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a>0   /root/registry/certs
</span><span id="__span-128-4"><a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a>19G /root/registry/data/mirror/v2/openshift/release/blobs
</span><span id="__span-128-5"><a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a>36K /root/registry/data/mirror/v2/openshift/release/manifests
</span><span id="__span-128-6"><a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a>19G /root/registry/data/mirror/v2/openshift/release
</span><span id="__span-128-7"><a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a>19G /root/registry/data/mirror/v2/openshift
</span><span id="__span-128-8"><a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a>19G /root/registry/data/mirror/v2
</span><span id="__span-128-9"><a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a>4.0K    /root/registry/data/mirror/config
</span><span id="__span-128-10"><a id="__codelineno-128-10" name="__codelineno-128-10" href="#__codelineno-128-10"></a>19G /root/registry/data/mirror
</span><span id="__span-128-11"><a id="__codelineno-128-11" name="__codelineno-128-11" href="#__codelineno-128-11"></a><span class="hll">19G /root/registry/data
</span></span><span id="__span-128-12"><a id="__codelineno-128-12" name="__codelineno-128-12" href="#__codelineno-128-12"></a>2.4G    /root/registry/downloads/images
</span><span id="__span-128-13"><a id="__codelineno-128-13" name="__codelineno-128-13" href="#__codelineno-128-13"></a>3.7G    /root/registry/downloads/tools
</span><span id="__span-128-14"><a id="__codelineno-128-14" name="__codelineno-128-14" href="#__codelineno-128-14"></a>8.0K    /root/registry/downloads/secrets
</span><span id="__span-128-15"><a id="__codelineno-128-15" name="__codelineno-128-15" href="#__codelineno-128-15"></a>6.0G    /root/registry/downloads
</span><span id="__span-128-16"><a id="__codelineno-128-16" name="__codelineno-128-16" href="#__codelineno-128-16"></a><span class="hll">25G /root/registry/
</span></span></code></pre></div>
--> <p>Use the <code>oc mirror init</code> command to create a template for the image set configuration and save it to a file called <code>imageset-config.yaml</code>:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline secrets]</span><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>cd /root/registry/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a>oc mirror init  &gt; imageset-config.yaml
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>total<span class="w"> </span><span class="m">12</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a>drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>data
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a>drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>certs
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a>drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>auth
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a>drwxr-xr-x<span class="w">  </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">48</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">07</span>:59<span class="w"> </span>downloads
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a>dr-xr-x---.<span class="w"> </span><span class="m">8</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">14</span>:07<span class="w"> </span>..
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a>drwxr-xr-x<span class="w">  </span><span class="m">6</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">110</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">16</span>:49<span class="w"> </span>.
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a>-rw-------<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">419</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">16</span>:50<span class="w"> </span>.oc-mirror.log
</span><span id="__span-131-9"><a id="__codelineno-131-9" name="__codelineno-131-9" href="#__codelineno-131-9"></a>-rw-r--r--<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">419</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">16</span>:50<span class="w"> </span>imageset-config.yaml
</span></code></pre></div> <p>We edit the file to look exactly as shown below:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>vi imageset-config.yaml
</span></code></pre></div> <div class="language-yaml copy highlight"><span class="filename">imageset-config.yaml</span><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ImageSetConfiguration</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirror.openshift.io/v1alpha2</span>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="nt">archiveSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a><span class="nt">storageConfig</span><span class="p">:</span>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="w">  </span><span class="nt">local</span><span class="p">:</span>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/root/registry/data</span>
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="nt">mirror</span><span class="p">:</span>
</span><span id="__span-133-8"><a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="w">  </span><span class="nt">platform</span><span class="p">:</span>
</span><span id="__span-133-9"><a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a><span class="w">    </span><span class="nt">architectures</span><span class="p">:</span>
</span><span id="__span-133-10"><a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"amd64"</span>
</span><span id="__span-133-11"><a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a><span class="w">    </span><span class="nt">channels</span><span class="p">:</span>
</span><span id="__span-133-12"><a id="__codelineno-133-12" name="__codelineno-133-12" href="#__codelineno-133-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stable-4.16</span>
</span><span id="__span-133-13"><a id="__codelineno-133-13" name="__codelineno-133-13" href="#__codelineno-133-13"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ocp</span>
</span><span id="__span-133-14"><a id="__codelineno-133-14" name="__codelineno-133-14" href="#__codelineno-133-14"></a><span class="w">      </span><span class="nt">minVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.16.9</span>
</span><span id="__span-133-15"><a id="__codelineno-133-15" name="__codelineno-133-15" href="#__codelineno-133-15"></a><span class="w">      </span><span class="nt">maxVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.16.9</span>
</span><span id="__span-133-16"><a id="__codelineno-133-16" name="__codelineno-133-16" href="#__codelineno-133-16"></a><span class="w">      </span><span class="nt">shortestPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-133-17"><a id="__codelineno-133-17" name="__codelineno-133-17" href="#__codelineno-133-17"></a><span class="w">  </span><span class="nt">operators</span><span class="p">:</span>
</span><span id="__span-133-18"><a id="__codelineno-133-18" name="__codelineno-133-18" href="#__codelineno-133-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">catalog</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/redhat/redhat-operator-index:v4.16</span>
</span><span id="__span-133-19"><a id="__codelineno-133-19" name="__codelineno-133-19" href="#__codelineno-133-19"></a><span class="w">    </span><span class="nt">packages</span><span class="p">:</span>
</span><span id="__span-133-20"><a id="__codelineno-133-20" name="__codelineno-133-20" href="#__codelineno-133-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openshift-pipelines-operator-rh</span>
</span><span id="__span-133-21"><a id="__codelineno-133-21" name="__codelineno-133-21" href="#__codelineno-133-21"></a><span class="w">      </span><span class="nt">defaultChannel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-133-22"><a id="__codelineno-133-22" name="__codelineno-133-22" href="#__codelineno-133-22"></a><span class="w">      </span><span class="nt">channels</span><span class="p">:</span>
</span><span id="__span-133-23"><a id="__codelineno-133-23" name="__codelineno-133-23" href="#__codelineno-133-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-133-24"><a id="__codelineno-133-24" name="__codelineno-133-24" href="#__codelineno-133-24"></a><span class="w">  </span><span class="nt">additionalImages</span><span class="p">:</span>
</span><span id="__span-133-25"><a id="__codelineno-133-25" name="__codelineno-133-25" href="#__codelineno-133-25"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/ubi8/ubi:latest</span>
</span><span id="__span-133-26"><a id="__codelineno-133-26" name="__codelineno-133-26" href="#__codelineno-133-26"></a><span class="w">  </span><span class="nt">helm</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span></code></pre></div> <p>Execute the platform and operators mirror process.</p> <div class="admonition info"> <p class="admonition-title">Time</p> <p>Bear in mind that the mirror process can take around 10 mins to complete. Be patient.</p> </div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline registry]</span><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>oc mirror --config=./imageset-config.yaml file:///root/registry/data
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>[...]
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a>info: Mirroring completed in 7m53.51s (134.2MB/s)
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a>Creating archive /root/registry/data/mirror_seq1_000000.tar
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a>Creating archive /root/registry/data/mirror_seq1_000001.tar
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a>Creating archive /root/registry/data/mirror_seq1_000002.tar
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a>Creating archive /root/registry/data/mirror_seq1_000003.tar
</span><span id="__span-135-7"><a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a>Creating archive /root/registry/data/mirror_seq1_000004.tar
</span><span id="__span-135-8"><a id="__codelineno-135-8" name="__codelineno-135-8" href="#__codelineno-135-8"></a>Creating archive /root/registry/data/mirror_seq1_000005.tar
</span><span id="__span-135-9"><a id="__codelineno-135-9" name="__codelineno-135-9" href="#__codelineno-135-9"></a>Creating archive /root/registry/data/mirror_seq1_000006.tar
</span><span id="__span-135-10"><a id="__codelineno-135-10" name="__codelineno-135-10" href="#__codelineno-135-10"></a>Creating archive /root/registry/data/mirror_seq1_000007.tar
</span><span id="__span-135-11"><a id="__codelineno-135-11" name="__codelineno-135-11" href="#__codelineno-135-11"></a>Creating archive /root/registry/data/mirror_seq1_000008.tar
</span><span id="__span-135-12"><a id="__codelineno-135-12" name="__codelineno-135-12" href="#__codelineno-135-12"></a>Creating archive /root/registry/data/mirror_seq1_000009.tar
</span><span id="__span-135-13"><a id="__codelineno-135-13" name="__codelineno-135-13" href="#__codelineno-135-13"></a>Creating archive /root/registry/data/mirror_seq1_000010.tar
</span><span id="__span-135-14"><a id="__codelineno-135-14" name="__codelineno-135-14" href="#__codelineno-135-14"></a>Creating archive /root/registry/data/mirror_seq1_000011.tar
</span><span id="__span-135-15"><a id="__codelineno-135-15" name="__codelineno-135-15" href="#__codelineno-135-15"></a>Creating archive /root/registry/data/mirror_seq1_000012.tar
</span><span id="__span-135-16"><a id="__codelineno-135-16" name="__codelineno-135-16" href="#__codelineno-135-16"></a>Creating archive /root/registry/data/mirror_seq1_000013.tar
</span><span id="__span-135-17"><a id="__codelineno-135-17" name="__codelineno-135-17" href="#__codelineno-135-17"></a>Creating archive /root/registry/data/mirror_seq1_000014.tar
</span><span id="__span-135-18"><a id="__codelineno-135-18" name="__codelineno-135-18" href="#__codelineno-135-18"></a>Creating archive /root/registry/data/mirror_seq1_000015.tar
</span></code></pre></div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>You can find the default channel by running the following command:</p> <div class="language-text no-copy highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a>oc mirror list operators --catalog=&lt;catalog_name&gt; --package=&lt;package_name&gt;
</span></code></pre></div> <p>Examples:</p> <div class="language-text no-copy highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a>oc-mirror list operators --catalog registry.redhat.io/redhat/redhat-operator-index:v4.16
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>oc-mirror list operators --catalog registry.redhat.io/redhat/redhat-operator-index:v4.16 --package openshift-pipelines-operator-rh
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a>oc mirror list releases --channels --version 4.16
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a>oc mirror list releases --channel stable-4.16
</span></code></pre></div> </div> <h2 id="17-disable-selinux-in-the-offline-bastion">17. Disable SELINUX in the offline bastion<a class="headerlink" href="#17-disable-selinux-in-the-offline-bastion" title="Permanent link">¶</a></h2> <p>In order to perform the correct configuration of the Bastion node, it is recommended that the <code>SELINUX</code> is deactivated first.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>It is not strictly necessary that Linux Security is deactivated in order to install OpenShift. However, it is recommended as it eases the installation. Otherwise, you would need to open several specific ports and add rules to the firewall so that the needed communication is allowed.</p> </div> <ol> <li> <p>Access the offline bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a>ssh root@192.168.252.23
</span></code></pre></div> </li> <li> <p>Open the <code>/etc/selinux/config</code> to disable the <code>SELINUX</code></p> <div class="language-bash copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a>vi<span class="w"> </span>/etc/selinux/config
</span></code></pre></div> </li> <li> <p>Make sure your file looks like below, where the highlighted line has been modified:</p> <div class="language-properties no-copy highlight"><span class="filename">/etc/selinux/config</span><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="c1"># This file controls the state of SELinux on the system.</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="c1"># SELINUX= can take one of these three values:</span>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="c1"># enforcing - SELinux security policy is enforced.</span>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="c1"># permissive - SELinux prints warnings instead of enforcing.</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a><span class="c1"># disabled - No SELinux policy is loaded.</span>
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="hll"><span class="na">SELINUX</span><span class="o">=</span><span class="s">disabled</span>
</span></span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="c1"># SELINUXTYPE= can take one of these three values:</span>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="c1"># targeted - Targeted processes are protected,</span>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="c1"># minimum - Modification of targeted policy. Only selected processes are protected.</span>
</span><span id="__span-140-10"><a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a><span class="c1"># mls - Multi Level Security protection. SELINUXTYPE=targeted</span>
</span></code></pre></div> <p>Once the change is made, save and exit the file (<code>esc</code> and <code>:wq</code>) </p> </li> <li> <p>Restart the server for the changes to take effect.</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a>init 6
</span></code></pre></div> </li> </ol> <h2 id="18-disable-the-firewall-in-the-offline-bastion">18. Disable the firewall in the offline bastion<a class="headerlink" href="#18-disable-the-firewall-in-the-offline-bastion" title="Permanent link">¶</a></h2> <p>Also, and since it is an internal network, the firewall of the machine is deactivated</p> <ol> <li> <p>Access the offline bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a>ssh root@192.168.252.23
</span></code></pre></div> </li> <li> <p>Stop the firewall:</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a>systemctl stop firewalld
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a>systemctl disable firewalld
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a>Removed /etc/systemd/system/multi-user.target.wants/firewalld.service. 
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>Removed /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
</span></code></pre></div> </li> </ol> <h2 id="19-configure-the-hostname-for-the-offline-bastion">19. Configure the hostname for the offline bastion<a class="headerlink" href="#19-configure-the-hostname-for-the-offline-bastion" title="Permanent link">¶</a></h2> <p>We need to change the online bastion machine's default hostname as we will be referring to this machine from the DNS, load balancer, etc using a different hostname.</p> <ol> <li> <p>Edit the hostname of the machine</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>vi /etc/hostname
</span></code></pre></div> <p>set the hostname to <code>bastion.ocp4.platformengineers.xyz</code></p> </li> <li> <p>Once the change has been made, restart the server for it to take effect.</p> <div class="language-text copy highlight"><span class="filename">[root@localhost ~]</span><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a>init 6
</span></code></pre></div> </li> <li> <p>Access the offline bastion again:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a>ssh root@192.168.252.23
</span></code></pre></div> </li> <li> <p>Check the hostname was successfully modified:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a>ping $HOSTNAME
</span></code></pre></div> <p>You should see similar output as below:</p> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a>PING bastion.ocp4.platformengineers.xyz(bastion.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:23c2%ens192)) 56 data bytes
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a>64 bytes from bastion.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:23c2%ens192): icmp_seq=1 ttl=64 time=0.040 ms
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a>64 bytes from bastion.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:23c2%ens192): icmp_seq=2 ttl=64 time=0.055 ms
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a>64 bytes from bastion.ocp4.platformengineers.xyz (fe80::250:56ff:fe8a:23c2%ens192): icmp_seq=3 ttl=64 time=0.047 ms
</span></code></pre></div> </li> <li> <p>Finish the ping command with <code>ctrl+c</code></p> </li> </ol> <h2 id="20-install-required-redhat-packages-in-the-offline-bastion">20. Install required RedHat packages in the offline bastion<a class="headerlink" href="#20-install-required-redhat-packages-in-the-offline-bastion" title="Permanent link">¶</a></h2> <p>For the installation of rpm packages on the offline machine, the RHEL 8.7 OS ISO file that created the VM from will help us. </p> <p>Repeat the steps taken on the onlinebastion for creating a offline repository from the RHEL 8.7 ISO</p> <ol> <li> <p>Make sure that, in the vCenter, the offline bastion has the CD/DVD drive as connected:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/29.png" data-desc-position="bottom"><img alt="29" src="../images/airgap-4-12/29.png" style="max-height:100px"></a></p> </li> </ol> <p>Once the offline repository is has been created and enabled, the required packages are installed with the <strong>yum</strong> utility.</p> <p>The following packages have been installed on the online bastion server. Some packages may not be used during the execution of online commands, but they are installed so that the "online" and "offline" bastion settings are as identical as possible.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a>yum install -y podman \
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a>                    jq openssl httpd-tools curl wget telnet nfs-utils \
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a>                    httpd.x86_64 \
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a>                    bind bind-utils rsync mkisofs haproxy
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a>Updating Subscription Management repositories.
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a>Unable to read consumer identity
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a>This system is not registered with an entitlement server. You can use subscription-manager to register.
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a>Red Hat Enterprise Linux 8.7.0 Base                                                                                          40 MB/s | 2.4 MB     00:00    
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a>Red Hat Enterprise Linux 8.7.0 App                                                                                           53 MB/s | 7.8 MB     00:00    
</span><span id="__span-151-8"><a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a>Package openssl-1:1.1.1k-7.el8_6.x86_64 is already installed.
</span><span id="__span-151-9"><a id="__codelineno-151-9" name="__codelineno-151-9" href="#__codelineno-151-9"></a>Package curl-7.61.1-25.el8.x86_64 is already installed.
</span><span id="__span-151-10"><a id="__codelineno-151-10" name="__codelineno-151-10" href="#__codelineno-151-10"></a>Dependencies resolved.
</span><span id="__span-151-11"><a id="__codelineno-151-11" name="__codelineno-151-11" href="#__codelineno-151-11"></a>============================================================================================================================================================
</span><span id="__span-151-12"><a id="__codelineno-151-12" name="__codelineno-151-12" href="#__codelineno-151-12"></a> Package                                   Architecture        Version                                                  Repository                     Size
</span><span id="__span-151-13"><a id="__codelineno-151-13" name="__codelineno-151-13" href="#__codelineno-151-13"></a>============================================================================================================================================================
</span><span id="__span-151-14"><a id="__codelineno-151-14" name="__codelineno-151-14" href="#__codelineno-151-14"></a>Installing:
</span><span id="__span-151-15"><a id="__codelineno-151-15" name="__codelineno-151-15" href="#__codelineno-151-15"></a> bind                                      x86_64              32:9.11.36-5.el8                                         InstallMediaApps              2.1 M
</span><span id="__span-151-16"><a id="__codelineno-151-16" name="__codelineno-151-16" href="#__codelineno-151-16"></a> bind-utils                                x86_64              32:9.11.36-5.el8                                         InstallMediaApps              452 k
</span><span id="__span-151-17"><a id="__codelineno-151-17" name="__codelineno-151-17" href="#__codelineno-151-17"></a> genisoimage                               x86_64              1.1.11-39.el8                                            InstallMediaApps              316 k
</span><span id="__span-151-18"><a id="__codelineno-151-18" name="__codelineno-151-18" href="#__codelineno-151-18"></a> httpd                                     x86_64              2.4.37-51.module+el8.7.0+16050+02173b8e                  InstallMediaApps              1.4 M
</span><span id="__span-151-19"><a id="__codelineno-151-19" name="__codelineno-151-19" href="#__codelineno-151-19"></a> httpd-tools                               x86_64              2.4.37-51.module+el8.7.0+16050+02173b8e                  InstallMediaApps              109 k
</span><span id="__span-151-20"><a id="__codelineno-151-20" name="__codelineno-151-20" href="#__codelineno-151-20"></a> jq                                        x86_64              1.6-3.el8                                                InstallMediaApps              202 k
</span><span id="__span-151-21"><a id="__codelineno-151-21" name="__codelineno-151-21" href="#__codelineno-151-21"></a> nfs-utils                                 x86_64              1:2.3.3-57.el8                                           InstallMediaBase              515 k
</span><span id="__span-151-22"><a id="__codelineno-151-22" name="__codelineno-151-22" href="#__codelineno-151-22"></a> podman                                    x86_64              3:4.2.0-1.module+el8.7.0+16772+33343656                  InstallMediaApps               12 M
</span><span id="__span-151-23"><a id="__codelineno-151-23" name="__codelineno-151-23" href="#__codelineno-151-23"></a> rsync                                     x86_64              3.1.3-19.el8                                             InstallMediaBase              410 k
</span><span id="__span-151-24"><a id="__codelineno-151-24" name="__codelineno-151-24" href="#__codelineno-151-24"></a> telnet                                    x86_64              1:0.17-76.el8                                            InstallMediaApps               72 k
</span><span id="__span-151-25"><a id="__codelineno-151-25" name="__codelineno-151-25" href="#__codelineno-151-25"></a> wget                                      x86_64              1.19.5-10.el8                                            InstallMediaApps              734 k
</span><span id="__span-151-26"><a id="__codelineno-151-26" name="__codelineno-151-26" href="#__codelineno-151-26"></a>...
</span><span id="__span-151-27"><a id="__codelineno-151-27" name="__codelineno-151-27" href="#__codelineno-151-27"></a>...
</span><span id="__span-151-28"><a id="__codelineno-151-28" name="__codelineno-151-28" href="#__codelineno-151-28"></a>Complete!
</span></code></pre></div> <h2 id="21-copy-downloaded-artefacts-from-online-bastion-to-offline-bastion">21. Copy downloaded artefacts from online bastion to offline bastion<a class="headerlink" href="#21-copy-downloaded-artefacts-from-online-bastion-to-offline-bastion" title="Permanent link">¶</a></h2> <ol> <li> <p>Create a directory for the private image registry in the offline bastion</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a>mkdir /root/registry
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a>cd registry/
</span></code></pre></div> </li> <li> <p>Create the necessary directories for such private image registry.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion registry]</span><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a>mkdir auth certs data downloads
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a>cd downloads/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a>mkdir images tools secrets
</span></code></pre></div> <p>The folder structure that should have got created should look like this:</p> <div class="language-text no-copy highlight"><span class="filename">Directory structure</span><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a>/root
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a>`-- registry
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a>    |-- auth
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a>    |-- certs
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a>    |-- data
</span><span id="__span-155-6"><a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a>    `-- downloads
</span><span id="__span-155-7"><a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a>        |-- images
</span><span id="__span-155-8"><a id="__codelineno-155-8" name="__codelineno-155-8" href="#__codelineno-155-8"></a>        |-- secrets
</span><span id="__span-155-9"><a id="__codelineno-155-9" name="__codelineno-155-9" href="#__codelineno-155-9"></a>        `-- tools
</span></code></pre></div> </li> <li> <p>Exit the offline bastion</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a>exit
</span></code></pre></div> </li> <li> <p>Access the online bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a>ssh root@192.168.252.22
</span></code></pre></div> </li> <li> <p>Verify that the <code>.tar</code> files have been generated.</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a>cd /root/registry/data
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a>ls -hla
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a>total<span class="w"> </span>61G
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a>drwxr-xr-x<span class="w"> </span><span class="m">4</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0K<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:28<span class="w"> </span>.
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a>drwxr-xr-x<span class="w"> </span><span class="m">6</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">110</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:08<span class="w"> </span>..
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:23<span class="w"> </span>mirror_seq1_000000.tar
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.9G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:23<span class="w"> </span>mirror_seq1_000001.tar
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.6G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:24<span class="w"> </span>mirror_seq1_000002.tar
</span><span id="__span-160-7"><a id="__codelineno-160-7" name="__codelineno-160-7" href="#__codelineno-160-7"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:24<span class="w"> </span>mirror_seq1_000003.tar
</span><span id="__span-160-8"><a id="__codelineno-160-8" name="__codelineno-160-8" href="#__codelineno-160-8"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:24<span class="w"> </span>mirror_seq1_000004.tar
</span><span id="__span-160-9"><a id="__codelineno-160-9" name="__codelineno-160-9" href="#__codelineno-160-9"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.4G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:25<span class="w"> </span>mirror_seq1_000005.tar
</span><span id="__span-160-10"><a id="__codelineno-160-10" name="__codelineno-160-10" href="#__codelineno-160-10"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.7G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:25<span class="w"> </span>mirror_seq1_000006.tar
</span><span id="__span-160-11"><a id="__codelineno-160-11" name="__codelineno-160-11" href="#__codelineno-160-11"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.5G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:25<span class="w"> </span>mirror_seq1_000007.tar
</span><span id="__span-160-12"><a id="__codelineno-160-12" name="__codelineno-160-12" href="#__codelineno-160-12"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:26<span class="w"> </span>mirror_seq1_000008.tar
</span><span id="__span-160-13"><a id="__codelineno-160-13" name="__codelineno-160-13" href="#__codelineno-160-13"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:26<span class="w"> </span>mirror_seq1_000009.tar
</span><span id="__span-160-14"><a id="__codelineno-160-14" name="__codelineno-160-14" href="#__codelineno-160-14"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:26<span class="w"> </span>mirror_seq1_000010.tar
</span><span id="__span-160-15"><a id="__codelineno-160-15" name="__codelineno-160-15" href="#__codelineno-160-15"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.9G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:27<span class="w"> </span>mirror_seq1_000011.tar
</span><span id="__span-160-16"><a id="__codelineno-160-16" name="__codelineno-160-16" href="#__codelineno-160-16"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">4</span>.0G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:27<span class="w"> </span>mirror_seq1_000012.tar
</span><span id="__span-160-17"><a id="__codelineno-160-17" name="__codelineno-160-17" href="#__codelineno-160-17"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.9G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:27<span class="w"> </span>mirror_seq1_000013.tar
</span><span id="__span-160-18"><a id="__codelineno-160-18" name="__codelineno-160-18" href="#__codelineno-160-18"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.9G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:28<span class="w"> </span>mirror_seq1_000014.tar
</span><span id="__span-160-19"><a id="__codelineno-160-19" name="__codelineno-160-19" href="#__codelineno-160-19"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">3</span>.8G<span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:28<span class="w"> </span>mirror_seq1_000015.tar
</span><span id="__span-160-20"><a id="__codelineno-160-20" name="__codelineno-160-20" href="#__codelineno-160-20"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">6</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:28<span class="w"> </span>oc-mirror-workspace
</span><span id="__span-160-21"><a id="__codelineno-160-21" name="__codelineno-160-21" href="#__codelineno-160-21"></a>drwxr-x---<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">28</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">17</span>:28<span class="w"> </span>publish
</span></code></pre></div> </li> <li> <p>Copy the tar files to the offline bastion using the scp command as there is currently network connectivity between the online bastion and the offline bastion.</p> <div class="admonition note"> <p class="admonition-title">Note</p> </div> <p>In a customer air-gapped environment, you would likely need to copy the data to the offline bastion via another method, a USB drive for example.</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a>scp *.tar root@192.168.252.23:/root/registry/data
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a>mirror_seq1_000000tar   100% 4090MB 167.6MB/s   00:24
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a>mirror_seq1_000001.tar  100% 3922MB 165.8MB/s   00:23
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a>mirror_seq1_000002.tar  100% 3673MB 167.1MB/s   00:21
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a>mirror_seq1_000003.tar  100% 4093MB 168.0MB/s   00:24
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a>mirror_seq1_000004.tar  100% 4061MB 169.4MB/s   00:23
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6" href="#__codelineno-162-6"></a>mirror_seq1_000005.tar  100% 3391MB 165.0MB/s   00:20
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7" href="#__codelineno-162-7"></a>mirror_seq1_000006.tar  100% 3698MB 128.1MB/s   00:28
</span><span id="__span-162-8"><a id="__codelineno-162-8" name="__codelineno-162-8" href="#__codelineno-162-8"></a>mirror_seq1_000007.tar  100% 3567MB 168.4MB/s   00:21
</span><span id="__span-162-9"><a id="__codelineno-162-9" name="__codelineno-162-9" href="#__codelineno-162-9"></a>mirror_seq1_000008.tar  100% 4083MB 124.5MB/s   00:32
</span><span id="__span-162-10"><a id="__codelineno-162-10" name="__codelineno-162-10" href="#__codelineno-162-10"></a>mirror_seq1_000009.tar  100% 3893MB 165.2MB/s   00:23
</span><span id="__span-162-11"><a id="__codelineno-162-11" name="__codelineno-162-11" href="#__codelineno-162-11"></a>mirror_seq1_000010.tar  100% 4086MB 158.6MB/s   00:25
</span><span id="__span-162-12"><a id="__codelineno-162-12" name="__codelineno-162-12" href="#__codelineno-162-12"></a>mirror_seq1_000011.tar  100% 3894MB 165.3MB/s   00:23
</span><span id="__span-162-13"><a id="__codelineno-162-13" name="__codelineno-162-13" href="#__codelineno-162-13"></a>mirror_seq1_000012.tar  100% 3871MB 137.9MB/s   00:28
</span><span id="__span-162-14"><a id="__codelineno-162-14" name="__codelineno-162-14" href="#__codelineno-162-14"></a>mirror_seq1_000013.tar  100% 3895MB 162.9MB/s   00:23
</span><span id="__span-162-15"><a id="__codelineno-162-15" name="__codelineno-162-15" href="#__codelineno-162-15"></a>mirror_seq1_000014.tar  100% 3913MB 156.7MB/s   00:24
</span><span id="__span-162-16"><a id="__codelineno-162-16" name="__codelineno-162-16" href="#__codelineno-162-16"></a>mirror_seq1_000015.tar  100% 4094MB 133.8MB/s   00:30
</span><span id="__span-162-17"><a id="__codelineno-162-17" name="__codelineno-162-17" href="#__codelineno-162-17"></a>mirror_seq1_000016.tar  100% 4094MB 133.8MB/s   00:30
</span></code></pre></div> </li> <li> <p>Copy the remaining components downloaded in the online bastion (client oc, installer, images, image registry, butane...) to the offline bastion </p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>scp -r /root/registry/downloads/* root@192.168.252.23:/root/registry/downloads/
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a>rhcos-4.16.3-x86_64-metal.x86_64.raw.gz                  100% 1208MB 391.3MB/s   00:03    
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a>rhcos-4.16.3-x86_64-live.x86_64.iso                      100% 1164MB 188.5MB/s   00:06    
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a>pull-secret.txt                                          100% 2759     1.3MB/s   00:00    
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a>pull-secret.json                                         100% 2875     1.4MB/s   00:00    
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a>mirror-registry-amd64.tar.gz                             100%  579MB 407.7MB/s   00:01    
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a>image-archive.tar                                        100% 1388MB 139.8MB/s   00:09    
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a>execution-environment.tar                                100%  302MB 383.2MB/s   00:00    
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a>mirror-registry                                          100% 9595KB 295.8MB/s   00:00    
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a>sqlite3.tar                                              100%  108MB 193.5MB/s   00:00    
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a>butane                                                   100% 7881KB 218.3MB/s   00:00    
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a>openshift-client-linux-amd64-rhel8-4.16.9.tar.gz         100%   64MB 497.5MB/s   00:00    
</span><span id="__span-164-12"><a id="__codelineno-164-12" name="__codelineno-164-12" href="#__codelineno-164-12"></a>oc                                                       100%  152MB 373.1MB/s   00:00    
</span><span id="__span-164-13"><a id="__codelineno-164-13" name="__codelineno-164-13" href="#__codelineno-164-13"></a>kubectl                                                  100%  152MB 665.6MB/s   00:00    
</span><span id="__span-164-14"><a id="__codelineno-164-14" name="__codelineno-164-14" href="#__codelineno-164-14"></a>openshift-install-linux-4.16.9.tar.gz                    100%  487MB 497.8MB/s   00:00    
</span><span id="__span-164-15"><a id="__codelineno-164-15" name="__codelineno-164-15" href="#__codelineno-164-15"></a>README.md                                                100%  706   395.9KB/s   00:00    
</span><span id="__span-164-16"><a id="__codelineno-164-16" name="__codelineno-164-16" href="#__codelineno-164-16"></a>openshift-install                                        100%  675MB 191.8MB/s   00:03    
</span><span id="__span-164-17"><a id="__codelineno-164-17" name="__codelineno-164-17" href="#__codelineno-164-17"></a>oc-mirror.tar.gz                                         100%   64MB 525.6MB/s   00:00    
</span><span id="__span-164-18"><a id="__codelineno-164-18" name="__codelineno-164-18" href="#__codelineno-164-18"></a>oc-mirror                                                100%  158MB 386.7MB/s   00:00    
</span><span id="__span-164-19"><a id="__codelineno-164-19" name="__codelineno-164-19" href="#__codelineno-164-19"></a>.oc-mirror.log                                           100%    0     0.0KB/s   00:00
</span></code></pre></div> </li> <li> <p>Exit the online bastion</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline data]</span><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a>exit
</span></code></pre></div> </li> <li> <p>Access the offline bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a>ssh root@192.168.252.23
</span></code></pre></div> </li> <li> <p>Copy the binaries into <code>/usr/bin</code> or <code>/usr/local/bin</code> in the same way as it was done for the online bastion</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a>cd /root/registry/downloads/tools
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a>ls -lart
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a>total<span class="w"> </span><span class="m">4245772</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a>drwxr-xr-x<span class="w"> </span><span class="m">5</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">         </span><span class="m">48</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">14</span>:08<span class="w"> </span>..
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">607056480</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:43<span class="w"> </span>mirror-registry-amd64.tar.gz
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1454929920</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>image-archive.tar
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">316753920</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>execution-environment.tar
</span><span id="__span-169-6"><a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">9824888</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>mirror-registry
</span><span id="__span-169-7"><a id="__codelineno-169-7" name="__codelineno-169-7" href="#__codelineno-169-7"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">113418240</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>sqlite3.tar
</span><span id="__span-169-8"><a id="__codelineno-169-8" name="__codelineno-169-8" href="#__codelineno-169-8"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">8070568</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>butane
</span><span id="__span-169-9"><a id="__codelineno-169-9" name="__codelineno-169-9" href="#__codelineno-169-9"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">66705673</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>openshift-client-linux-amd64-rhel8-4.16.9.tar.gz
</span><span id="__span-169-10"><a id="__codelineno-169-10" name="__codelineno-169-10" href="#__codelineno-169-10"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>oc
</span><span id="__span-169-11"><a id="__codelineno-169-11" name="__codelineno-169-11" href="#__codelineno-169-11"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">159905720</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>kubectl
</span><span id="__span-169-12"><a id="__codelineno-169-12" name="__codelineno-169-12" href="#__codelineno-169-12"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">510253136</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>openshift-install-linux-4.16.9.tar.gz
</span><span id="__span-169-13"><a id="__codelineno-169-13" name="__codelineno-169-13" href="#__codelineno-169-13"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">        </span><span class="m">706</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>README.md
</span><span id="__span-169-14"><a id="__codelineno-169-14" name="__codelineno-169-14" href="#__codelineno-169-14"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">707731456</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>openshift-install
</span><span id="__span-169-15"><a id="__codelineno-169-15" name="__codelineno-169-15" href="#__codelineno-169-15"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">67385243</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>oc-mirror.tar.gz
</span><span id="__span-169-16"><a id="__codelineno-169-16" name="__codelineno-169-16" href="#__codelineno-169-16"></a>-rwxr-x--x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">165699280</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>oc-mirror
</span><span id="__span-169-17"><a id="__codelineno-169-17" name="__codelineno-169-17" href="#__codelineno-169-17"></a>-rw-------<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">          </span><span class="m">0</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>.oc-mirror.log
</span><span id="__span-169-18"><a id="__codelineno-169-18" name="__codelineno-169-18" href="#__codelineno-169-18"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">       </span><span class="m">4096</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">15</span>:44<span class="w"> </span>.
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a>cp /root/registry/downloads/tools/oc /usr/bin/oc
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a>cp /root/registry/downloads/tools/openshift-install /usr/bin/openshift-install
</span><span id="__span-170-3"><a id="__codelineno-170-3" name="__codelineno-170-3" href="#__codelineno-170-3"></a>cp /root/registry/downloads/tools/oc-mirror /usr/local/bin/oc-mirror
</span></code></pre></div> </li> </ol> <h2 id="22-create-the-private-image-registry-in-the-offline-bastion">22. Create the private image registry in the offline bastion<a class="headerlink" href="#22-create-the-private-image-registry-in-the-offline-bastion" title="Permanent link">¶</a></h2> <p>The images to be used during the installation of OpenShift are to be supplied from the bastion. To do this, a local registry must be configured as follows:</p> <ol> <li> <p>Run the <code>mirror-registry install</code> command</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a>cd /root/registry/downloads/tools
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a>./mirror-registry install --quayRoot /root/registry \
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a>                          --quayHostname bastion.ocp4.platformengineers.xyz \
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a>                          --initPassword passw0rd
</span></code></pre></div> <div class="admonition warning"> <p class="admonition-title">Important</p> <p>On a client installation, please specify a different password in agreement with the client. If the <code>--initPassword</code> is not specified during the Quay private image registry install command, a random password is generated.</p> <p><strong>IMPORTANT:</strong> If you let the install process generate a random password, please <strong>DO WRITE IT DOWN</strong> as it can not be retrieved again.</p> </div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a>__   __
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a>/  \ /  \     ______   _    _     __   __   __
</span><span id="__span-173-3"><a id="__codelineno-173-3" name="__codelineno-173-3" href="#__codelineno-173-3"></a>/ /\ / /\ \   /  __  \ | |  | |   /  \  \ \ / /
</span><span id="__span-173-4"><a id="__codelineno-173-4" name="__codelineno-173-4" href="#__codelineno-173-4"></a>/ /  / /  \ \  | |  | | | |  | |  / /\ \  \   /
</span><span id="__span-173-5"><a id="__codelineno-173-5" name="__codelineno-173-5" href="#__codelineno-173-5"></a>\ \  \ \  / /  | |__| | | |__| | / ____ \  | |
</span><span id="__span-173-6"><a id="__codelineno-173-6" name="__codelineno-173-6" href="#__codelineno-173-6"></a>\ \/ \ \/ /   \_  ___/  \____/ /_/    \_\ |_|
</span><span id="__span-173-7"><a id="__codelineno-173-7" name="__codelineno-173-7" href="#__codelineno-173-7"></a>\__/ \__/      \ \__
</span><span id="__span-173-8"><a id="__codelineno-173-8" name="__codelineno-173-8" href="#__codelineno-173-8"></a>                \___\ by Red Hat
</span><span id="__span-173-9"><a id="__codelineno-173-9" name="__codelineno-173-9" href="#__codelineno-173-9"></a>Build, Store, and Distribute your Containers
</span><span id="__span-173-10"><a id="__codelineno-173-10" name="__codelineno-173-10" href="#__codelineno-173-10"></a>
</span><span id="__span-173-11"><a id="__codelineno-173-11" name="__codelineno-173-11" href="#__codelineno-173-11"></a>INFO[2023-11-06 17:01:33] Install has begun  
</span><span id="__span-173-12"><a id="__codelineno-173-12" name="__codelineno-173-12" href="#__codelineno-173-12"></a>...
</span><span id="__span-173-13"><a id="__codelineno-173-13" name="__codelineno-173-13" href="#__codelineno-173-13"></a>...
</span><span id="__span-173-14"><a id="__codelineno-173-14" name="__codelineno-173-14" href="#__codelineno-173-14"></a>PLAY RECAP *************************************************************************************************************************************************
</span><span id="__span-173-15"><a id="__codelineno-173-15" name="__codelineno-173-15" href="#__codelineno-173-15"></a>root@bastion.ocp4.platformengineers.xyz : ok=50   changed=30   unreachable=0    failed=0    skipped=17   rescued=0    ignored=0   
</span><span id="__span-173-16"><a id="__codelineno-173-16" name="__codelineno-173-16" href="#__codelineno-173-16"></a>
</span><span id="__span-173-17"><a id="__codelineno-173-17" name="__codelineno-173-17" href="#__codelineno-173-17"></a>INFO[2023-11-06 17:04:14] Quay installed successfully, config data is stored in /root/registry 
</span><span id="__span-173-18"><a id="__codelineno-173-18" name="__codelineno-173-18" href="#__codelineno-173-18"></a><span class="hll">INFO[2023-11-06 17:04:14] Quay is available at https://bastion.ocp4.platformengineers.xyz:8443 with credentials (init, passw0rd) 
</span></span></code></pre></div> </li> <li> <p>If you let the Quay's private image registry install process generate a random password for the <code>init</code> user, log such password </p> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a>INFO[2023-09-11 18:31:13] Quay installed successfully, config data is stored in /root/registry
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a><span class="hll">INFO[2023-09-11 18:31:13] Quay is available at https://bastion.ocp4.platformengineers.xyz:8443 with credentials (init, cw9q3GC10aPQMiunkSZ6Ag7r52H8h4ve)
</span></span></code></pre></div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Take note of this user and password because you will need to use it when you create the <code>install-config.yaml</code> file on next steps.</p> </div> </li> <li> <p>Add the <code>init</code> user as a Quay super user on the following Quay private image registry configuration file within the <code>SUPER_USERS</code> section</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a>vi /root/registry/quay-config/config.yaml
</span></code></pre></div> <div class="language-yaml no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="nn">...</span>
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a><span class="nt">SUPER_USERS</span><span class="p">:</span>
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="hll"><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init</span>
</span></span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a><span class="nn">...</span>
</span></code></pre></div> </li> <li> <p>Restart the offline bastion node.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a>init 6
</span></code></pre></div> </li> </ol> <div class="admonition danger"> <p class="admonition-title">Important</p> <ul> <li> <p>The private image registry sets Quay to use the autogenerated TLS certificates to enable SSL connectivity by default. These certificates have a validity of <strong>365 days</strong> and <strong>will expire after 1 year</strong> after which they need to be rotated. The rotation procedure is not done automatically by Quay, it needs to be done manually, otherwise x509 errors will be present during pushes and pulls to/from the registry.</p> </li> <li> <p>You can find the instructions to rotate the certificates <a href="https://access.redhat.com/solutions/6980268"><strong>here</strong></a>.</p> </li> <li> <p>Newly created certificate will need to be added to all OpenShift clusters that pull images from this private image registry instance. This will ensure certificate trust. You can find the link to add certficiates to OpenShift <a href="https://docs.openshift.com/container-platform/4.15/cicd/builds/setting-up-trusted-ca.html"><strong>here</strong></a></p> </li> </ul> </div> <h2 id="23-publish-the-downloaded-images-to-the-offline-bastion-image-registry">23 Publish the downloaded images to the offline bastion Image Registry<a class="headerlink" href="#23-publish-the-downloaded-images-to-the-offline-bastion-image-registry" title="Permanent link">¶</a></h2> <p>The downloaded images must be published in the Quay private image registry installed on the previous section. </p> <ol> <li> <p>Access the offline bastion again:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a>ssh root@192.168.252.23
</span></code></pre></div> </li> <li> <p>Execute the following command to set the image registry certificate as a trusted certificate by the system:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a>cp /root/registry/quay-rootCA/rootCA.pem /usr/share/pki/ca-trust-source/anchors/
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a>update-ca-trust
</span></code></pre></div> </li> <li> <p>Log into the private image registry:</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Remember to use the user (<code>init</code>) and password (<code>passw0rd</code> if you used the command outlined in this training material) you installed the Quay private image registry with during its installation proccess. </p> </div> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a>podman login bastion.ocp4.platformengineers.xyz:8443
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a>Login Succeeded!
</span></code></pre></div> </li> <li> <p>Launch the image mirror process to load the previously downloaded images, now in <code>.tar</code> files, into the Quay private image registry:</p> <div class="admonition info"> <p class="admonition-title">Info</p> <p>This process can take around 30 mins</p> </div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>You should not need the <code>--dest-skip-tls</code> flag in the command below if you set your container image private registry CA as a trusted CA in the steps above. We've added it to avoid issues during workshops.</p> </div> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a>oc mirror --from=/root/registry/data docker://bastion.ocp4.csm-spgi.acme.es:8443 --dest-skip-tls
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a>[...]
</span><span id="__span-183-2"><a id="__codelineno-183-2" name="__codelineno-183-2" href="#__codelineno-183-2"></a>Wrote release signatures to oc-mirror-workspace/results-1694473158
</span><span id="__span-183-3"><a id="__codelineno-183-3" name="__codelineno-183-3" href="#__codelineno-183-3"></a>Rendering catalog image "bastion.ocp4.platformengineers.xyz:8443/redhat/redhat-operator-index:v4.12" with file-based catalog
</span><span id="__span-183-4"><a id="__codelineno-183-4" name="__codelineno-183-4" href="#__codelineno-183-4"></a>Writing image mapping to oc-mirror-workspace/results-1694473158/mapping.txt
</span><span id="__span-183-5"><a id="__codelineno-183-5" name="__codelineno-183-5" href="#__codelineno-183-5"></a>Writing CatalogSource manifests to oc-mirror-workspace/results-1694473158
</span><span id="__span-183-6"><a id="__codelineno-183-6" name="__codelineno-183-6" href="#__codelineno-183-6"></a>Writing ICSP manifests to oc-mirror-workspace/results-1694473158
</span></code></pre></div> </li> <li> <p>You can check the result of the image mirror process by pointing your browser to:</p> <p><a href="https://192.168.252.23:8443">https://192.168.252.23:8443</a></p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/68.png" data-desc-position="bottom"><img alt="68" src="../images/airgap-4-12/68.png" style="max-height:800px"></a></p> </li> <li> <p>Check that the <code>catalogSource-redhat-operator-index.yaml</code> and <code>imageContentSourcePolicy.yaml</code> files have been generated in the <code>/root/oc-mirror-workspace/results-XXXXXX</code> directory.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a>ls -lart ~/oc-mirror-workspace/results-XXXXXX/
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a>total<span class="w"> </span><span class="m">96</span>
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2" href="#__codelineno-185-2"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">     </span><span class="m">6</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:59<span class="w"> </span>charts
</span><span id="__span-185-3"><a id="__codelineno-185-3" name="__codelineno-185-3" href="#__codelineno-185-3"></a>drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">98</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span>:25<span class="w"> </span>release-signatures
</span><span id="__span-185-4"><a id="__codelineno-185-4" name="__codelineno-185-4" href="#__codelineno-185-4"></a>drwxr-xr-x<span class="w"> </span><span class="m">4</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">    </span><span class="m">47</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span>:25<span class="w"> </span>..
</span><span id="__span-185-5"><a id="__codelineno-185-5" name="__codelineno-185-5" href="#__codelineno-185-5"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">87467</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span>:25<span class="w"> </span>mapping.txt
</span><span id="__span-185-6"><a id="__codelineno-185-6" name="__codelineno-185-6" href="#__codelineno-185-6"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">241</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span>:25<span class="w"> </span>catalogSource-redhat-operator-index.yaml
</span><span id="__span-185-7"><a id="__codelineno-185-7" name="__codelineno-185-7" href="#__codelineno-185-7"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">1741</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span>:25<span class="w"> </span>imageContentSourcePolicy.yaml
</span><span id="__span-185-8"><a id="__codelineno-185-8" name="__codelineno-185-8" href="#__codelineno-185-8"></a>drwxr-xr-x<span class="w"> </span><span class="m">4</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">150</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span>:25<span class="w"> </span>.
</span></code></pre></div> </li> </ol> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The contents of the <code>imageContentSourcePolicy.yaml</code> must be written down for use when creating the <code>install-config.yaml</code> file later in the chapter <a href="#30-create-the-install-configyaml-file">Create the install-config.yaml file</a>.</p> <p>The contents of the <code>catalogSource-redhat-operator-index.yaml</code> file must be used when creating the RedHat Marketplace later in the chapter <a href="#34-create-the-catalog-sources-to-access-the-redhat-marketplace-operators">Create the catalog sources to access RedHat Marketplace operators</a>.</p> </div> <h2 id="24-configuring-dns-service-in-offline-bastion">24. Configuring DNS service in offline bastion<a class="headerlink" href="#24-configuring-dns-service-in-offline-bastion" title="Permanent link">¶</a></h2> <ol> <li> <p>The DNS service configuration file is located in the <code>/etc</code> directory. To start, copy <code>named.conf</code> to a backup file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a>cp /etc/named.conf /etc/named.conf.bak
</span></code></pre></div> </li> <li> <p>Open the <code>named.conf</code> file.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a>vi /etc/named.conf
</span></code></pre></div> </li> <li> <p>Edit the file to look like the one shown below </p> <div class="language-nginx copy highlight"><span class="filename">named.conf</span><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="k">//</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a><span class="s">//</span><span class="w"> </span><span class="s">named.conf</span>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a><span class="s">//</span>
</span><span id="__span-188-4"><a id="__codelineno-188-4" name="__codelineno-188-4" href="#__codelineno-188-4"></a><span class="s">//</span><span class="w"> </span><span class="s">Provided</span><span class="w"> </span><span class="s">by</span><span class="w"> </span><span class="s">Red</span><span class="w"> </span><span class="s">Hat</span><span class="w"> </span><span class="s">bind</span><span class="w"> </span><span class="s">package</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">configure</span><span class="w"> </span><span class="s">the</span><span class="w"> </span><span class="s">ISC</span><span class="w"> </span><span class="s">BIND</span><span class="w"> </span><span class="s">named(8)</span><span class="w"> </span><span class="s">DNS</span>
</span><span id="__span-188-5"><a id="__codelineno-188-5" name="__codelineno-188-5" href="#__codelineno-188-5"></a><span class="s">//</span><span class="w"> </span><span class="s">server</span><span class="w"> </span><span class="s">as</span><span class="w"> </span><span class="s">a</span><span class="w"> </span><span class="s">caching</span><span class="w"> </span><span class="no">on</span><span class="s">ly</span><span class="w"> </span><span class="s">nameserver</span><span class="w"> </span><span class="s">(as</span><span class="w"> </span><span class="s">a</span><span class="w"> </span><span class="s">localhost</span><span class="w"> </span><span class="s">DNS</span><span class="w"> </span><span class="s">resolver</span><span class="w"> </span><span class="no">on</span><span class="s">ly).</span>
</span><span id="__span-188-6"><a id="__codelineno-188-6" name="__codelineno-188-6" href="#__codelineno-188-6"></a><span class="s">//</span>
</span><span id="__span-188-7"><a id="__codelineno-188-7" name="__codelineno-188-7" href="#__codelineno-188-7"></a><span class="s">//</span><span class="w"> </span><span class="s">See</span><span class="w"> </span><span class="s">/usr/share/doc/bind*/sample/</span><span class="w"> </span><span class="s">for</span><span class="w"> </span><span class="s">example</span><span class="w"> </span><span class="s">named</span><span class="w"> </span><span class="s">configuration</span><span class="w"> </span><span class="s">files.</span>
</span><span id="__span-188-8"><a id="__codelineno-188-8" name="__codelineno-188-8" href="#__codelineno-188-8"></a><span class="s">//</span>
</span><span id="__span-188-9"><a id="__codelineno-188-9" name="__codelineno-188-9" href="#__codelineno-188-9"></a>
</span><span id="__span-188-10"><a id="__codelineno-188-10" name="__codelineno-188-10" href="#__codelineno-188-10"></a><span class="s">options</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-11"><a id="__codelineno-188-11" name="__codelineno-188-11" href="#__codelineno-188-11"></a><span class="c1">#   listen-on port 53 { 127.0.0.1; };</span>
</span><span id="__span-188-12"><a id="__codelineno-188-12" name="__codelineno-188-12" href="#__codelineno-188-12"></a><span class="c1">#   listen-on-v6 port 53 { ::1; };</span>
</span><span id="__span-188-13"><a id="__codelineno-188-13" name="__codelineno-188-13" href="#__codelineno-188-13"></a><span class="w">    </span><span class="kn">directory</span><span class="w">   </span><span class="s">"/var/named"</span><span class="p">;</span>
</span><span id="__span-188-14"><a id="__codelineno-188-14" name="__codelineno-188-14" href="#__codelineno-188-14"></a><span class="w">    </span><span class="kn">dump-file</span><span class="w">   </span><span class="s">"/var/named/data/cache_dump.db"</span><span class="p">;</span>
</span><span id="__span-188-15"><a id="__codelineno-188-15" name="__codelineno-188-15" href="#__codelineno-188-15"></a><span class="w">    </span><span class="kn">statistics-file</span><span class="w"> </span><span class="s">"/var/named/data/named_stats.txt"</span><span class="p">;</span>
</span><span id="__span-188-16"><a id="__codelineno-188-16" name="__codelineno-188-16" href="#__codelineno-188-16"></a><span class="w">    </span><span class="kn">memstatistics-file</span><span class="w"> </span><span class="s">"/var/named/data/named_mem_stats.txt"</span><span class="p">;</span>
</span><span id="__span-188-17"><a id="__codelineno-188-17" name="__codelineno-188-17" href="#__codelineno-188-17"></a><span class="w">    </span><span class="kn">secroots-file</span><span class="w">   </span><span class="s">"/var/named/data/named.secroots"</span><span class="p">;</span>
</span><span id="__span-188-18"><a id="__codelineno-188-18" name="__codelineno-188-18" href="#__codelineno-188-18"></a><span class="w">    </span><span class="kn">recursing-file</span><span class="w">  </span><span class="s">"/var/named/data/named.recursing"</span><span class="p">;</span>
</span><span id="__span-188-19"><a id="__codelineno-188-19" name="__codelineno-188-19" href="#__codelineno-188-19"></a><span class="w">    </span><span class="kn">allow-query</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="kn">any</span><span class="p">;}</span>;
</span><span id="__span-188-20"><a id="__codelineno-188-20" name="__codelineno-188-20" href="#__codelineno-188-20"></a>
</span><span id="__span-188-21"><a id="__codelineno-188-21" name="__codelineno-188-21" href="#__codelineno-188-21"></a><span class="w">    </span><span class="kn">/*</span>
</span><span id="__span-188-22"><a id="__codelineno-188-22" name="__codelineno-188-22" href="#__codelineno-188-22"></a><span class="w">    </span><span class="s">-</span><span class="w"> </span><span class="s">If</span><span class="w"> </span><span class="s">you</span><span class="w"> </span><span class="s">are</span><span class="w"> </span><span class="s">building</span><span class="w"> </span><span class="s">an</span><span class="w"> </span><span class="s">AUTHORITATIVE</span><span class="w"> </span><span class="s">DNS</span><span class="w"> </span><span class="s">server,</span><span class="w"> </span><span class="s">do</span><span class="w"> </span><span class="s">NOT</span><span class="w"> </span><span class="s">enable</span><span class="w"> </span><span class="s">recursion.</span>
</span><span id="__span-188-23"><a id="__codelineno-188-23" name="__codelineno-188-23" href="#__codelineno-188-23"></a><span class="w">    </span><span class="s">-</span><span class="w"> </span><span class="s">If</span><span class="w"> </span><span class="s">you</span><span class="w"> </span><span class="s">are</span><span class="w"> </span><span class="s">building</span><span class="w"> </span><span class="s">a</span><span class="w"> </span><span class="s">RECURSIVE</span><span class="w"> </span><span class="s">(caching)</span><span class="w"> </span><span class="s">DNS</span><span class="w"> </span><span class="s">server,</span><span class="w"> </span><span class="s">you</span><span class="w"> </span><span class="s">need</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">enable</span>
</span><span id="__span-188-24"><a id="__codelineno-188-24" name="__codelineno-188-24" href="#__codelineno-188-24"></a><span class="w">    </span><span class="s">recursion.</span>
</span><span id="__span-188-25"><a id="__codelineno-188-25" name="__codelineno-188-25" href="#__codelineno-188-25"></a><span class="w">    </span><span class="s">-</span><span class="w"> </span><span class="s">If</span><span class="w"> </span><span class="s">your</span><span class="w"> </span><span class="s">recursive</span><span class="w"> </span><span class="s">DNS</span><span class="w"> </span><span class="s">server</span><span class="w"> </span><span class="s">has</span><span class="w"> </span><span class="s">a</span><span class="w"> </span><span class="s">public</span><span class="w"> </span><span class="s">IP</span><span class="w"> </span><span class="s">address,</span><span class="w"> </span><span class="s">you</span><span class="w"> </span><span class="s">MUST</span><span class="w"> </span><span class="s">enable</span><span class="w"> </span><span class="s">access</span>
</span><span id="__span-188-26"><a id="__codelineno-188-26" name="__codelineno-188-26" href="#__codelineno-188-26"></a><span class="w">    </span><span class="s">control</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">limit</span><span class="w"> </span><span class="s">queries</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">your</span><span class="w"> </span><span class="s">legitimate</span><span class="w"> </span><span class="s">users.</span><span class="w"> </span><span class="s">Failing</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">do</span><span class="w"> </span><span class="s">so</span><span class="w"> </span><span class="s">will</span>
</span><span id="__span-188-27"><a id="__codelineno-188-27" name="__codelineno-188-27" href="#__codelineno-188-27"></a><span class="w">    </span><span class="s">cause</span><span class="w"> </span><span class="s">your</span><span class="w"> </span><span class="s">server</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">become</span><span class="w"> </span><span class="s">part</span><span class="w"> </span><span class="s">of</span><span class="w"> </span><span class="s">large</span><span class="w"> </span><span class="s">scale</span><span class="w"> </span><span class="s">DNS</span><span class="w"> </span><span class="s">amplification</span>
</span><span id="__span-188-28"><a id="__codelineno-188-28" name="__codelineno-188-28" href="#__codelineno-188-28"></a><span class="w">    </span><span class="s">attacks.</span><span class="w"> </span><span class="s">Implementing</span><span class="w"> </span><span class="s">BCP38</span><span class="w"> </span><span class="s">within</span><span class="w"> </span><span class="s">your</span><span class="w"> </span><span class="s">network</span><span class="w"> </span><span class="s">would</span><span class="w"> </span><span class="s">greatly</span>
</span><span id="__span-188-29"><a id="__codelineno-188-29" name="__codelineno-188-29" href="#__codelineno-188-29"></a><span class="w">    </span><span class="s">reduce</span><span class="w"> </span><span class="s">such</span><span class="w"> </span><span class="s">attack</span><span class="w"> </span><span class="s">surface</span>
</span><span id="__span-188-30"><a id="__codelineno-188-30" name="__codelineno-188-30" href="#__codelineno-188-30"></a><span class="w">    </span><span class="s">*/</span>
</span><span id="__span-188-31"><a id="__codelineno-188-31" name="__codelineno-188-31" href="#__codelineno-188-31"></a><span class="w">    </span><span class="s">recursion</span><span class="w"> </span><span class="s">yes</span><span class="p">;</span>
</span><span id="__span-188-32"><a id="__codelineno-188-32" name="__codelineno-188-32" href="#__codelineno-188-32"></a>
</span><span id="__span-188-33"><a id="__codelineno-188-33" name="__codelineno-188-33" href="#__codelineno-188-33"></a><span class="w">    </span><span class="kn">dnssec-enable</span><span class="w"> </span><span class="s">yes</span><span class="p">;</span>
</span><span id="__span-188-34"><a id="__codelineno-188-34" name="__codelineno-188-34" href="#__codelineno-188-34"></a><span class="c1">#   dnssec-validation yes;</span>
</span><span id="__span-188-35"><a id="__codelineno-188-35" name="__codelineno-188-35" href="#__codelineno-188-35"></a>
</span><span id="__span-188-36"><a id="__codelineno-188-36" name="__codelineno-188-36" href="#__codelineno-188-36"></a><span class="w">    </span><span class="kn">managed-keys-directory</span><span class="w"> </span><span class="s">"/var/named/dynamic"</span><span class="p">;</span>
</span><span id="__span-188-37"><a id="__codelineno-188-37" name="__codelineno-188-37" href="#__codelineno-188-37"></a>
</span><span id="__span-188-38"><a id="__codelineno-188-38" name="__codelineno-188-38" href="#__codelineno-188-38"></a><span class="w">    </span><span class="kn">pid-file</span><span class="w"> </span><span class="s">"/run/named/named.pid"</span><span class="p">;</span>
</span><span id="__span-188-39"><a id="__codelineno-188-39" name="__codelineno-188-39" href="#__codelineno-188-39"></a><span class="w">    </span><span class="kn">session-keyfile</span><span class="w"> </span><span class="s">"/run/named/session.key"</span><span class="p">;</span>
</span><span id="__span-188-40"><a id="__codelineno-188-40" name="__codelineno-188-40" href="#__codelineno-188-40"></a><span class="c1">#    forwarders { 192.168.252.1;};</span>
</span><span id="__span-188-41"><a id="__codelineno-188-41" name="__codelineno-188-41" href="#__codelineno-188-41"></a><span class="w">    </span><span class="kn">/*</span><span class="w"> </span><span class="s">https://fedoraproject.org/wiki/Changes/CryptoPolicy</span><span class="w"> </span><span class="s">*/</span>
</span><span id="__span-188-42"><a id="__codelineno-188-42" name="__codelineno-188-42" href="#__codelineno-188-42"></a><span class="w">    </span><span class="s">include</span><span class="w"> </span><span class="s">"/etc/crypto-policies/back-ends/bind.config"</span><span class="p">;</span>
</span><span id="__span-188-43"><a id="__codelineno-188-43" name="__codelineno-188-43" href="#__codelineno-188-43"></a><span class="p">}</span>;
</span><span id="__span-188-44"><a id="__codelineno-188-44" name="__codelineno-188-44" href="#__codelineno-188-44"></a>
</span><span id="__span-188-45"><a id="__codelineno-188-45" name="__codelineno-188-45" href="#__codelineno-188-45"></a><span class="k">logging</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-46"><a id="__codelineno-188-46" name="__codelineno-188-46" href="#__codelineno-188-46"></a><span class="w">        </span><span class="kn">channel</span><span class="w"> </span><span class="s">default_debug</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-47"><a id="__codelineno-188-47" name="__codelineno-188-47" href="#__codelineno-188-47"></a><span class="w">                </span><span class="kn">file</span><span class="w"> </span><span class="s">"data/named.run"</span><span class="p">;</span>
</span><span id="__span-188-48"><a id="__codelineno-188-48" name="__codelineno-188-48" href="#__codelineno-188-48"></a><span class="w">                </span><span class="kn">severity</span><span class="w"> </span><span class="s">dynamic</span><span class="p">;</span>
</span><span id="__span-188-49"><a id="__codelineno-188-49" name="__codelineno-188-49" href="#__codelineno-188-49"></a><span class="w">        </span><span class="p">}</span>;
</span><span id="__span-188-50"><a id="__codelineno-188-50" name="__codelineno-188-50" href="#__codelineno-188-50"></a><span class="p">}</span>;
</span><span id="__span-188-51"><a id="__codelineno-188-51" name="__codelineno-188-51" href="#__codelineno-188-51"></a>
</span><span id="__span-188-52"><a id="__codelineno-188-52" name="__codelineno-188-52" href="#__codelineno-188-52"></a><span class="k">zone</span><span class="w"> </span><span class="s">"."</span><span class="w"> </span><span class="s">IN</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-53"><a id="__codelineno-188-53" name="__codelineno-188-53" href="#__codelineno-188-53"></a><span class="w">    </span><span class="kn">type</span><span class="w"> </span><span class="s">hint</span><span class="p">;</span>
</span><span id="__span-188-54"><a id="__codelineno-188-54" name="__codelineno-188-54" href="#__codelineno-188-54"></a><span class="w">    </span><span class="kn">file</span><span class="w"> </span><span class="s">"named.ca"</span><span class="p">;</span>
</span><span id="__span-188-55"><a id="__codelineno-188-55" name="__codelineno-188-55" href="#__codelineno-188-55"></a><span class="p">}</span>;
</span><span id="__span-188-56"><a id="__codelineno-188-56" name="__codelineno-188-56" href="#__codelineno-188-56"></a>
</span><span id="__span-188-57"><a id="__codelineno-188-57" name="__codelineno-188-57" href="#__codelineno-188-57"></a><span class="k">include</span><span class="w"> </span><span class="n">"/etc/named.rfc1912.zones"</span>;
</span><span id="__span-188-58"><a id="__codelineno-188-58" name="__codelineno-188-58" href="#__codelineno-188-58"></a><span class="k">include</span><span class="w"> </span><span class="n">"/etc/named.root.key"</span>;
</span><span id="__span-188-59"><a id="__codelineno-188-59" name="__codelineno-188-59" href="#__codelineno-188-59"></a><span class="k">zone</span><span class="w"> </span><span class="s">"acme.es"</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-60"><a id="__codelineno-188-60" name="__codelineno-188-60" href="#__codelineno-188-60"></a><span class="w">    </span><span class="kn">type</span><span class="w"> </span><span class="s">master</span><span class="p">;</span>
</span><span id="__span-188-61"><a id="__codelineno-188-61" name="__codelineno-188-61" href="#__codelineno-188-61"></a><span class="hll"><span class="w">    </span><span class="kn">file</span><span class="w"> </span><span class="s">"platformengineers.xyz.db"</span><span class="p">;</span>
</span></span><span id="__span-188-62"><a id="__codelineno-188-62" name="__codelineno-188-62" href="#__codelineno-188-62"></a><span class="w">    </span><span class="kn">allow-update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">none</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>;
</span><span id="__span-188-63"><a id="__codelineno-188-63" name="__codelineno-188-63" href="#__codelineno-188-63"></a><span class="p">}</span>;
</span><span id="__span-188-64"><a id="__codelineno-188-64" name="__codelineno-188-64" href="#__codelineno-188-64"></a><span class="k">zone</span><span class="w"> </span><span class="s">"252.168.192.in-addr.arpa"</span><span class="w"> </span><span class="s">IN</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-65"><a id="__codelineno-188-65" name="__codelineno-188-65" href="#__codelineno-188-65"></a><span class="w">    </span><span class="kn">type</span><span class="w"> </span><span class="s">master</span><span class="p">;</span>
</span><span id="__span-188-66"><a id="__codelineno-188-66" name="__codelineno-188-66" href="#__codelineno-188-66"></a><span class="hll"><span class="w">    </span><span class="kn">file</span><span class="w"> </span><span class="s">"platformengineers.xyz.reverse.db"</span><span class="p">;</span>
</span></span><span id="__span-188-67"><a id="__codelineno-188-67" name="__codelineno-188-67" href="#__codelineno-188-67"></a><span class="w">    </span><span class="kn">allow-update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">none</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>;
</span><span id="__span-188-68"><a id="__codelineno-188-68" name="__codelineno-188-68" href="#__codelineno-188-68"></a><span class="p">}</span>;
</span></code></pre></div> </li> <li> <p>Create the <code>platformengineers.xyz.db</code> file in <code>/var/named</code> for name resolution.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a>vi /var/named/platformengineers.xyz.db
</span></code></pre></div> <div class="language-zone copy highlight"><span class="filename">platformengineers.xyz.db</span><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a><span class="k">$TTL</span><span class="w"> </span><span class="l">1D</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2" href="#__codelineno-190-2"></a><span class="o">@</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">SOA</span><span class="w"> </span><span class="l">bastion.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="l">root.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3" href="#__codelineno-190-3"></a><span class="mi">2019022409</span><span class="w"> </span><span class="c1">; serial</span>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4" href="#__codelineno-190-4"></a><span class="mi">3h</span><span class="w"> </span><span class="c1">; refresh</span>
</span><span id="__span-190-5"><a id="__codelineno-190-5" name="__codelineno-190-5" href="#__codelineno-190-5"></a><span class="mi">15</span><span class="w"> </span><span class="c1">; retry</span>
</span><span id="__span-190-6"><a id="__codelineno-190-6" name="__codelineno-190-6" href="#__codelineno-190-6"></a><span class="mi">1w</span><span class="w"> </span><span class="c1">; expire</span>
</span><span id="__span-190-7"><a id="__codelineno-190-7" name="__codelineno-190-7" href="#__codelineno-190-7"></a><span class="mi">3h</span><span class="w"> </span><span class="c1">; minimum</span>
</span><span id="__span-190-8"><a id="__codelineno-190-8" name="__codelineno-190-8" href="#__codelineno-190-8"></a><span class="p">)</span>
</span><span id="__span-190-9"><a id="__codelineno-190-9" name="__codelineno-190-9" href="#__codelineno-190-9"></a><span class="w">       </span><span class="nc">IN</span><span class="w"> </span><span class="kt">NS</span><span class="w"> </span><span class="l">bastion.ocp4.platformengineers.xyz.</span>
</span><span id="__span-190-10"><a id="__codelineno-190-10" name="__codelineno-190-10" href="#__codelineno-190-10"></a><span class="n">api.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.24</span>
</span><span id="__span-190-11"><a id="__codelineno-190-11" name="__codelineno-190-11" href="#__codelineno-190-11"></a><span class="n">api-int.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.24</span>
</span><span id="__span-190-12"><a id="__codelineno-190-12" name="__codelineno-190-12" href="#__codelineno-190-12"></a><span class="n">*.apps.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.25</span>
</span><span id="__span-190-13"><a id="__codelineno-190-13" name="__codelineno-190-13" href="#__codelineno-190-13"></a><span class="n">bootstrap.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.3</span>
</span><span id="__span-190-14"><a id="__codelineno-190-14" name="__codelineno-190-14" href="#__codelineno-190-14"></a><span class="n">bastion.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.23</span>
</span><span id="__span-190-15"><a id="__codelineno-190-15" name="__codelineno-190-15" href="#__codelineno-190-15"></a><span class="n">controlplane01.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.4</span>
</span><span id="__span-190-16"><a id="__codelineno-190-16" name="__codelineno-190-16" href="#__codelineno-190-16"></a><span class="n">controlplane02.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.5</span>
</span><span id="__span-190-17"><a id="__codelineno-190-17" name="__codelineno-190-17" href="#__codelineno-190-17"></a><span class="n">controlplane03.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.6</span>
</span><span id="__span-190-18"><a id="__codelineno-190-18" name="__codelineno-190-18" href="#__codelineno-190-18"></a><span class="n">infra01.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.7</span>
</span><span id="__span-190-19"><a id="__codelineno-190-19" name="__codelineno-190-19" href="#__codelineno-190-19"></a><span class="n">infra02.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.8</span>
</span><span id="__span-190-20"><a id="__codelineno-190-20" name="__codelineno-190-20" href="#__codelineno-190-20"></a><span class="n">infra03.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.9</span>
</span><span id="__span-190-21"><a id="__codelineno-190-21" name="__codelineno-190-21" href="#__codelineno-190-21"></a><span class="n">compute01.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.10</span>
</span><span id="__span-190-22"><a id="__codelineno-190-22" name="__codelineno-190-22" href="#__codelineno-190-22"></a><span class="n">compute02.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.11</span>
</span><span id="__span-190-23"><a id="__codelineno-190-23" name="__codelineno-190-23" href="#__codelineno-190-23"></a><span class="n">compute03.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.12</span>
</span><span id="__span-190-24"><a id="__codelineno-190-24" name="__codelineno-190-24" href="#__codelineno-190-24"></a><span class="n">storage01.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.13</span>
</span><span id="__span-190-25"><a id="__codelineno-190-25" name="__codelineno-190-25" href="#__codelineno-190-25"></a><span class="n">storage02.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.14</span>
</span><span id="__span-190-26"><a id="__codelineno-190-26" name="__codelineno-190-26" href="#__codelineno-190-26"></a><span class="n">storage03.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="l">192.168.252.15</span>
</span></code></pre></div> </li> <li> <p>Create <code>platformengineers.xyz.reverse.db</code> file in <code>/var/named</code> for reverse name resolution:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a>vi /var/named/platformengineers.xyz.reverse.db
</span></code></pre></div> <div class="language-zone copy highlight"><span class="filename">platformengineers.xyz.reverse.db</span><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a><span class="k">$TTL</span><span class="w"> </span><span class="l">1D</span>
</span><span id="__span-192-2"><a id="__codelineno-192-2" name="__codelineno-192-2" href="#__codelineno-192-2"></a><span class="o">@</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">SOA</span><span class="w"> </span><span class="l">bastion.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="l">root.ocp4.platformengineers.xyz.</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-192-3"><a id="__codelineno-192-3" name="__codelineno-192-3" href="#__codelineno-192-3"></a><span class="mi">2019022409</span><span class="w"> </span><span class="c1">; serial</span>
</span><span id="__span-192-4"><a id="__codelineno-192-4" name="__codelineno-192-4" href="#__codelineno-192-4"></a><span class="mi">3h</span><span class="w"> </span><span class="c1">; refresh</span>
</span><span id="__span-192-5"><a id="__codelineno-192-5" name="__codelineno-192-5" href="#__codelineno-192-5"></a><span class="mi">15</span><span class="w"> </span><span class="c1">; retry</span>
</span><span id="__span-192-6"><a id="__codelineno-192-6" name="__codelineno-192-6" href="#__codelineno-192-6"></a><span class="mi">1w</span><span class="w"> </span><span class="c1">; expire</span>
</span><span id="__span-192-7"><a id="__codelineno-192-7" name="__codelineno-192-7" href="#__codelineno-192-7"></a><span class="mi">3h</span><span class="w"> </span><span class="c1">; minimum</span>
</span><span id="__span-192-8"><a id="__codelineno-192-8" name="__codelineno-192-8" href="#__codelineno-192-8"></a><span class="p">)</span>
</span><span id="__span-192-9"><a id="__codelineno-192-9" name="__codelineno-192-9" href="#__codelineno-192-9"></a><span class="n">252.168.192.in-addr.arpa.</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">NS</span><span class="w"> </span><span class="l">bastion.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-10"><a id="__codelineno-192-10" name="__codelineno-192-10" href="#__codelineno-192-10"></a><span class="n">23</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">bastion.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-11"><a id="__codelineno-192-11" name="__codelineno-192-11" href="#__codelineno-192-11"></a><span class="n">3</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">bootstrap.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-12"><a id="__codelineno-192-12" name="__codelineno-192-12" href="#__codelineno-192-12"></a><span class="n">4</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">controlplane01.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-13"><a id="__codelineno-192-13" name="__codelineno-192-13" href="#__codelineno-192-13"></a><span class="n">5</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">controlplane02.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-14"><a id="__codelineno-192-14" name="__codelineno-192-14" href="#__codelineno-192-14"></a><span class="n">6</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">controlplane03.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-15"><a id="__codelineno-192-15" name="__codelineno-192-15" href="#__codelineno-192-15"></a><span class="n">7</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">infra01.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-16"><a id="__codelineno-192-16" name="__codelineno-192-16" href="#__codelineno-192-16"></a><span class="n">8</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">infra02.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-17"><a id="__codelineno-192-17" name="__codelineno-192-17" href="#__codelineno-192-17"></a><span class="n">9</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">infra03.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-18"><a id="__codelineno-192-18" name="__codelineno-192-18" href="#__codelineno-192-18"></a><span class="n">10</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">compute01.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-19"><a id="__codelineno-192-19" name="__codelineno-192-19" href="#__codelineno-192-19"></a><span class="n">11</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">compute02.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-20"><a id="__codelineno-192-20" name="__codelineno-192-20" href="#__codelineno-192-20"></a><span class="n">12</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">compute03.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-21"><a id="__codelineno-192-21" name="__codelineno-192-21" href="#__codelineno-192-21"></a><span class="n">13</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">storage01.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-22"><a id="__codelineno-192-22" name="__codelineno-192-22" href="#__codelineno-192-22"></a><span class="n">14</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">storage02.ocp4.platformengineers.xyz.</span>
</span><span id="__span-192-23"><a id="__codelineno-192-23" name="__codelineno-192-23" href="#__codelineno-192-23"></a><span class="n">15</span><span class="w"> </span><span class="nc">IN</span><span class="w"> </span><span class="kt">PTR</span><span class="w"> </span><span class="l">storage03.ocp4.platformengineers.xyz.</span>
</span></code></pre></div> </li> <li> <p>Enable the DNS service: </p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a>systemctl enable named
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-194-1"><a id="__codelineno-194-1" name="__codelineno-194-1" href="#__codelineno-194-1"></a>Created symlink /etc/systemd/system/multi-user.target.wants/named.service → /usr/lib/systemd/system/named.service.
</span></code></pre></div> </li> <li> <p>Start the DNS service:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-195-1"><a id="__codelineno-195-1" name="__codelineno-195-1" href="#__codelineno-195-1"></a>systemctl start named
</span></code></pre></div> </li> </ol> <h2 id="25-set-up-haproxy-in-the-offline-bastion">25. Set up HAProxy in the offline bastion<a class="headerlink" href="#25-set-up-haproxy-in-the-offline-bastion" title="Permanent link">¶</a></h2> <p>The following link provides an example of the HAProxy provided by RedHat as a reference:</p> <p><a href="https://access.redhat.com/articles/5127211">https://access.redhat.com/articles/5127211</a> </p> <ol> <li> <p>Open the HAProxy configuration file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-196-1"><a id="__codelineno-196-1" name="__codelineno-196-1" href="#__codelineno-196-1"></a>vi /etc/haproxy/haproxy.cfg
</span></code></pre></div> </li> <li> <p>Make sure the HAProxy configuration file looks like below:</p> <div class="language-nginx copy highlight"><span class="filename">haproxy.cfg</span><pre><span></span><code><span id="__span-197-1"><a id="__codelineno-197-1" name="__codelineno-197-1" href="#__codelineno-197-1"></a><span class="c1">#---------------------------------------------------------------------</span>
</span><span id="__span-197-2"><a id="__codelineno-197-2" name="__codelineno-197-2" href="#__codelineno-197-2"></a><span class="c1"># Global settings</span>
</span><span id="__span-197-3"><a id="__codelineno-197-3" name="__codelineno-197-3" href="#__codelineno-197-3"></a><span class="c1">#---------------------------------------------------------------------</span>
</span><span id="__span-197-4"><a id="__codelineno-197-4" name="__codelineno-197-4" href="#__codelineno-197-4"></a><span class="k">global</span>
</span><span id="__span-197-5"><a id="__codelineno-197-5" name="__codelineno-197-5" href="#__codelineno-197-5"></a><span class="s">log</span><span class="w"> </span><span class="mi">127</span><span class="s">.0.0.1</span><span class="w"> </span><span class="s">local2</span>
</span><span id="__span-197-6"><a id="__codelineno-197-6" name="__codelineno-197-6" href="#__codelineno-197-6"></a><span class="s">chroot</span><span class="w"> </span><span class="s">/var/lib/haproxy</span>
</span><span id="__span-197-7"><a id="__codelineno-197-7" name="__codelineno-197-7" href="#__codelineno-197-7"></a><span class="s">pidfile</span><span class="w"> </span><span class="s">/var/run/haproxy.pid</span>
</span><span id="__span-197-8"><a id="__codelineno-197-8" name="__codelineno-197-8" href="#__codelineno-197-8"></a><span class="s">maxconn</span><span class="w"> </span><span class="mi">4000</span>
</span><span id="__span-197-9"><a id="__codelineno-197-9" name="__codelineno-197-9" href="#__codelineno-197-9"></a><span class="s">user</span><span class="w"> </span><span class="s">haproxy</span>
</span><span id="__span-197-10"><a id="__codelineno-197-10" name="__codelineno-197-10" href="#__codelineno-197-10"></a><span class="s">group</span><span class="w"> </span><span class="s">haproxy</span>
</span><span id="__span-197-11"><a id="__codelineno-197-11" name="__codelineno-197-11" href="#__codelineno-197-11"></a><span class="s">daemon</span>
</span><span id="__span-197-12"><a id="__codelineno-197-12" name="__codelineno-197-12" href="#__codelineno-197-12"></a><span class="c1"># turn on stats unix socket</span>
</span><span id="__span-197-13"><a id="__codelineno-197-13" name="__codelineno-197-13" href="#__codelineno-197-13"></a><span class="s">stats</span><span class="w"> </span><span class="s">socket</span><span class="w"> </span><span class="s">/var/lib/haproxy/stats</span>
</span><span id="__span-197-14"><a id="__codelineno-197-14" name="__codelineno-197-14" href="#__codelineno-197-14"></a><span class="c1"># utilize system-wide crypto-policies</span>
</span><span id="__span-197-15"><a id="__codelineno-197-15" name="__codelineno-197-15" href="#__codelineno-197-15"></a><span class="c1">#ssl-default-bind-ciphers PROFILE=SYSTEM</span>
</span><span id="__span-197-16"><a id="__codelineno-197-16" name="__codelineno-197-16" href="#__codelineno-197-16"></a><span class="c1">#ssl-default-server-ciphers PROFILE=SYSTEM</span>
</span><span id="__span-197-17"><a id="__codelineno-197-17" name="__codelineno-197-17" href="#__codelineno-197-17"></a><span class="c1">#---------------------------------------------------------------------</span>
</span><span id="__span-197-18"><a id="__codelineno-197-18" name="__codelineno-197-18" href="#__codelineno-197-18"></a><span class="c1"># common defaults that all the 'listen' and 'backend' sections will</span>
</span><span id="__span-197-19"><a id="__codelineno-197-19" name="__codelineno-197-19" href="#__codelineno-197-19"></a><span class="c1"># use if not designated in their block</span>
</span><span id="__span-197-20"><a id="__codelineno-197-20" name="__codelineno-197-20" href="#__codelineno-197-20"></a><span class="c1">#---------------------------------------------------------------------</span>
</span><span id="__span-197-21"><a id="__codelineno-197-21" name="__codelineno-197-21" href="#__codelineno-197-21"></a><span class="s">defaults</span>
</span><span id="__span-197-22"><a id="__codelineno-197-22" name="__codelineno-197-22" href="#__codelineno-197-22"></a><span class="s">mode</span><span class="w"> </span><span class="s">tcp</span>
</span><span id="__span-197-23"><a id="__codelineno-197-23" name="__codelineno-197-23" href="#__codelineno-197-23"></a><span class="s">log</span><span class="w"> </span><span class="s">global</span>
</span><span id="__span-197-24"><a id="__codelineno-197-24" name="__codelineno-197-24" href="#__codelineno-197-24"></a><span class="c1">#option httplog</span>
</span><span id="__span-197-25"><a id="__codelineno-197-25" name="__codelineno-197-25" href="#__codelineno-197-25"></a><span class="s">option</span><span class="w"> </span><span class="s">dontlognull</span>
</span><span id="__span-197-26"><a id="__codelineno-197-26" name="__codelineno-197-26" href="#__codelineno-197-26"></a><span class="s">option</span><span class="w"> </span><span class="s">http-server-close</span>
</span><span id="__span-197-27"><a id="__codelineno-197-27" name="__codelineno-197-27" href="#__codelineno-197-27"></a><span class="s">option</span><span class="w"> </span><span class="s">forwardfor</span><span class="w"> </span><span class="s">except</span><span class="w"> </span><span class="mi">127</span><span class="s">.0.0.0/8</span>
</span><span id="__span-197-28"><a id="__codelineno-197-28" name="__codelineno-197-28" href="#__codelineno-197-28"></a><span class="s">option</span><span class="w"> </span><span class="s">redispatch</span>
</span><span id="__span-197-29"><a id="__codelineno-197-29" name="__codelineno-197-29" href="#__codelineno-197-29"></a><span class="s">retries</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-197-30"><a id="__codelineno-197-30" name="__codelineno-197-30" href="#__codelineno-197-30"></a><span class="s">timeout</span><span class="w"> </span><span class="s">http-request</span><span class="w"> </span><span class="s">10s</span>
</span><span id="__span-197-31"><a id="__codelineno-197-31" name="__codelineno-197-31" href="#__codelineno-197-31"></a><span class="s">timeout</span><span class="w"> </span><span class="s">queue</span><span class="w"> </span><span class="mi">1m</span>
</span><span id="__span-197-32"><a id="__codelineno-197-32" name="__codelineno-197-32" href="#__codelineno-197-32"></a><span class="s">timeout</span><span class="w"> </span><span class="s">connect</span><span class="w"> </span><span class="s">10s</span>
</span><span id="__span-197-33"><a id="__codelineno-197-33" name="__codelineno-197-33" href="#__codelineno-197-33"></a><span class="s">timeout</span><span class="w"> </span><span class="s">client</span><span class="w"> </span><span class="mi">5m</span>
</span><span id="__span-197-34"><a id="__codelineno-197-34" name="__codelineno-197-34" href="#__codelineno-197-34"></a><span class="s">timeout</span><span class="w"> </span><span class="s">server</span><span class="w"> </span><span class="mi">5m</span>
</span><span id="__span-197-35"><a id="__codelineno-197-35" name="__codelineno-197-35" href="#__codelineno-197-35"></a><span class="s">timeout</span><span class="w"> </span><span class="s">http-keep-alive</span><span class="w"> </span><span class="s">10s</span>
</span><span id="__span-197-36"><a id="__codelineno-197-36" name="__codelineno-197-36" href="#__codelineno-197-36"></a><span class="s">timeout</span><span class="w"> </span><span class="s">check</span><span class="w"> </span><span class="s">10s</span>
</span><span id="__span-197-37"><a id="__codelineno-197-37" name="__codelineno-197-37" href="#__codelineno-197-37"></a><span class="s">maxconn</span><span class="w"> </span><span class="mi">3000</span>
</span><span id="__span-197-38"><a id="__codelineno-197-38" name="__codelineno-197-38" href="#__codelineno-197-38"></a><span class="c1">#---------------------------------------------------------------------</span>
</span><span id="__span-197-39"><a id="__codelineno-197-39" name="__codelineno-197-39" href="#__codelineno-197-39"></a><span class="c1"># balancing for RHOCP Kubernetes API Server</span>
</span><span id="__span-197-40"><a id="__codelineno-197-40" name="__codelineno-197-40" href="#__codelineno-197-40"></a><span class="c1">#---------------------------------------------------------------------</span>
</span><span id="__span-197-41"><a id="__codelineno-197-41" name="__codelineno-197-41" href="#__codelineno-197-41"></a><span class="s">frontend</span><span class="w"> </span><span class="s">k8s_api</span>
</span><span id="__span-197-42"><a id="__codelineno-197-42" name="__codelineno-197-42" href="#__codelineno-197-42"></a><span class="s">bind</span><span class="w"> </span><span class="s">*:6443</span>
</span><span id="__span-197-43"><a id="__codelineno-197-43" name="__codelineno-197-43" href="#__codelineno-197-43"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-44"><a id="__codelineno-197-44" name="__codelineno-197-44" href="#__codelineno-197-44"></a><span class="s">default_backend</span><span class="w"> </span><span class="s">k8s_api_backend</span>
</span><span id="__span-197-45"><a id="__codelineno-197-45" name="__codelineno-197-45" href="#__codelineno-197-45"></a><span class="s">backend</span><span class="w"> </span><span class="s">k8s_api_backend</span>
</span><span id="__span-197-46"><a id="__codelineno-197-46" name="__codelineno-197-46" href="#__codelineno-197-46"></a><span class="c1">#balance roundrobin</span>
</span><span id="__span-197-47"><a id="__codelineno-197-47" name="__codelineno-197-47" href="#__codelineno-197-47"></a><span class="s">balance</span><span class="w"> </span><span class="s">source</span>
</span><span id="__span-197-48"><a id="__codelineno-197-48" name="__codelineno-197-48" href="#__codelineno-197-48"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-49"><a id="__codelineno-197-49" name="__codelineno-197-49" href="#__codelineno-197-49"></a><span class="s">server</span><span class="w"> </span><span class="s">bootstrap.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.3</span><span class="p">:</span><span class="mi">6443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-50"><a id="__codelineno-197-50" name="__codelineno-197-50" href="#__codelineno-197-50"></a><span class="s">server</span><span class="w"> </span><span class="s">controlplane01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.4</span><span class="p">:</span><span class="mi">6443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-51"><a id="__codelineno-197-51" name="__codelineno-197-51" href="#__codelineno-197-51"></a><span class="s">server</span><span class="w"> </span><span class="s">controlplane02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.5</span><span class="p">:</span><span class="mi">6443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-52"><a id="__codelineno-197-52" name="__codelineno-197-52" href="#__codelineno-197-52"></a><span class="s">server</span><span class="w"> </span><span class="s">controlplane03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.6</span><span class="p">:</span><span class="mi">6443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-53"><a id="__codelineno-197-53" name="__codelineno-197-53" href="#__codelineno-197-53"></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="__span-197-54"><a id="__codelineno-197-54" name="__codelineno-197-54" href="#__codelineno-197-54"></a><span class="c1"># balancing for RHOCP Machine Config Server</span>
</span><span id="__span-197-55"><a id="__codelineno-197-55" name="__codelineno-197-55" href="#__codelineno-197-55"></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="__span-197-56"><a id="__codelineno-197-56" name="__codelineno-197-56" href="#__codelineno-197-56"></a><span class="s">frontend</span><span class="w"> </span><span class="s">machine_config</span>
</span><span id="__span-197-57"><a id="__codelineno-197-57" name="__codelineno-197-57" href="#__codelineno-197-57"></a><span class="s">bind</span><span class="w"> </span><span class="s">*:22623</span>
</span><span id="__span-197-58"><a id="__codelineno-197-58" name="__codelineno-197-58" href="#__codelineno-197-58"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-59"><a id="__codelineno-197-59" name="__codelineno-197-59" href="#__codelineno-197-59"></a><span class="s">default_backend</span><span class="w"> </span><span class="s">machine_config_backend</span>
</span><span id="__span-197-60"><a id="__codelineno-197-60" name="__codelineno-197-60" href="#__codelineno-197-60"></a><span class="s">backend</span><span class="w"> </span><span class="s">machine_config_backend</span>
</span><span id="__span-197-61"><a id="__codelineno-197-61" name="__codelineno-197-61" href="#__codelineno-197-61"></a><span class="c1">#balance roundrobin</span>
</span><span id="__span-197-62"><a id="__codelineno-197-62" name="__codelineno-197-62" href="#__codelineno-197-62"></a><span class="s">balance</span><span class="w"> </span><span class="s">source</span>
</span><span id="__span-197-63"><a id="__codelineno-197-63" name="__codelineno-197-63" href="#__codelineno-197-63"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-64"><a id="__codelineno-197-64" name="__codelineno-197-64" href="#__codelineno-197-64"></a><span class="s">server</span><span class="w"> </span><span class="s">bootstrap.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.3</span><span class="p">:</span><span class="mi">22623</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-65"><a id="__codelineno-197-65" name="__codelineno-197-65" href="#__codelineno-197-65"></a><span class="s">server</span><span class="w"> </span><span class="s">controlplane01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.4</span><span class="p">:</span><span class="mi">22623</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-66"><a id="__codelineno-197-66" name="__codelineno-197-66" href="#__codelineno-197-66"></a><span class="s">server</span><span class="w"> </span><span class="s">controlplane02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.5</span><span class="p">:</span><span class="mi">22623</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-67"><a id="__codelineno-197-67" name="__codelineno-197-67" href="#__codelineno-197-67"></a><span class="s">server</span><span class="w"> </span><span class="s">controlplane03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.6</span><span class="p">:</span><span class="mi">22623</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-68"><a id="__codelineno-197-68" name="__codelineno-197-68" href="#__codelineno-197-68"></a><span class="c1"># --------------------------------------------------------------------</span>
</span><span id="__span-197-69"><a id="__codelineno-197-69" name="__codelineno-197-69" href="#__codelineno-197-69"></a><span class="c1"># balancing for RHOCP Ingress Insecure Port</span>
</span><span id="__span-197-70"><a id="__codelineno-197-70" name="__codelineno-197-70" href="#__codelineno-197-70"></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="__span-197-71"><a id="__codelineno-197-71" name="__codelineno-197-71" href="#__codelineno-197-71"></a><span class="s">frontend</span><span class="w"> </span><span class="s">ingress_insecure</span>
</span><span id="__span-197-72"><a id="__codelineno-197-72" name="__codelineno-197-72" href="#__codelineno-197-72"></a><span class="s">bind</span><span class="w"> </span><span class="s">*:80</span>
</span><span id="__span-197-73"><a id="__codelineno-197-73" name="__codelineno-197-73" href="#__codelineno-197-73"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-74"><a id="__codelineno-197-74" name="__codelineno-197-74" href="#__codelineno-197-74"></a><span class="s">default_backend</span><span class="w"> </span><span class="s">ingress_insecure_backend</span>
</span><span id="__span-197-75"><a id="__codelineno-197-75" name="__codelineno-197-75" href="#__codelineno-197-75"></a><span class="s">backend</span><span class="w"> </span><span class="s">ingress_insecure_backend</span>
</span><span id="__span-197-76"><a id="__codelineno-197-76" name="__codelineno-197-76" href="#__codelineno-197-76"></a><span class="c1">#balance roundrobin</span>
</span><span id="__span-197-77"><a id="__codelineno-197-77" name="__codelineno-197-77" href="#__codelineno-197-77"></a><span class="s">balance</span><span class="w"> </span><span class="s">source</span>
</span><span id="__span-197-78"><a id="__codelineno-197-78" name="__codelineno-197-78" href="#__codelineno-197-78"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-79"><a id="__codelineno-197-79" name="__codelineno-197-79" href="#__codelineno-197-79"></a><span class="s">server</span><span class="w"> </span><span class="s">infra01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.7</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-80"><a id="__codelineno-197-80" name="__codelineno-197-80" href="#__codelineno-197-80"></a><span class="s">server</span><span class="w"> </span><span class="s">infra02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.8</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-81"><a id="__codelineno-197-81" name="__codelineno-197-81" href="#__codelineno-197-81"></a><span class="s">server</span><span class="w"> </span><span class="s">infra03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.9</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-82"><a id="__codelineno-197-82" name="__codelineno-197-82" href="#__codelineno-197-82"></a><span class="s">server</span><span class="w"> </span><span class="s">compute01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.10</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-83"><a id="__codelineno-197-83" name="__codelineno-197-83" href="#__codelineno-197-83"></a><span class="s">server</span><span class="w"> </span><span class="s">compute02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.11</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-84"><a id="__codelineno-197-84" name="__codelineno-197-84" href="#__codelineno-197-84"></a><span class="s">server</span><span class="w"> </span><span class="s">compute03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.12</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-85"><a id="__codelineno-197-85" name="__codelineno-197-85" href="#__codelineno-197-85"></a><span class="s">server</span><span class="w"> </span><span class="s">storage01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.13</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-86"><a id="__codelineno-197-86" name="__codelineno-197-86" href="#__codelineno-197-86"></a><span class="s">server</span><span class="w"> </span><span class="s">storage02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.14</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-87"><a id="__codelineno-197-87" name="__codelineno-197-87" href="#__codelineno-197-87"></a><span class="s">server</span><span class="w"> </span><span class="s">storage03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.15</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-88"><a id="__codelineno-197-88" name="__codelineno-197-88" href="#__codelineno-197-88"></a>
</span><span id="__span-197-89"><a id="__codelineno-197-89" name="__codelineno-197-89" href="#__codelineno-197-89"></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="__span-197-90"><a id="__codelineno-197-90" name="__codelineno-197-90" href="#__codelineno-197-90"></a><span class="c1"># balancing for RHOCP Ingress Secure Port</span>
</span><span id="__span-197-91"><a id="__codelineno-197-91" name="__codelineno-197-91" href="#__codelineno-197-91"></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="__span-197-92"><a id="__codelineno-197-92" name="__codelineno-197-92" href="#__codelineno-197-92"></a><span class="s">frontend</span><span class="w"> </span><span class="s">ingress_secure</span>
</span><span id="__span-197-93"><a id="__codelineno-197-93" name="__codelineno-197-93" href="#__codelineno-197-93"></a><span class="s">bind</span><span class="w"> </span><span class="s">*:443</span>
</span><span id="__span-197-94"><a id="__codelineno-197-94" name="__codelineno-197-94" href="#__codelineno-197-94"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-95"><a id="__codelineno-197-95" name="__codelineno-197-95" href="#__codelineno-197-95"></a><span class="s">default_backend</span><span class="w"> </span><span class="s">ingress_secure_backend</span>
</span><span id="__span-197-96"><a id="__codelineno-197-96" name="__codelineno-197-96" href="#__codelineno-197-96"></a><span class="s">backend</span><span class="w"> </span><span class="s">ingress_secure_backend</span>
</span><span id="__span-197-97"><a id="__codelineno-197-97" name="__codelineno-197-97" href="#__codelineno-197-97"></a><span class="c1">#balance roundrobin</span>
</span><span id="__span-197-98"><a id="__codelineno-197-98" name="__codelineno-197-98" href="#__codelineno-197-98"></a><span class="s">balance</span><span class="w"> </span><span class="s">source</span>
</span><span id="__span-197-99"><a id="__codelineno-197-99" name="__codelineno-197-99" href="#__codelineno-197-99"></a><span class="c1">#mode tcp</span>
</span><span id="__span-197-100"><a id="__codelineno-197-100" name="__codelineno-197-100" href="#__codelineno-197-100"></a><span class="s">server</span><span class="w"> </span><span class="s">infra01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.7</span><span class="p">:</span><span class="mi">443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-101"><a id="__codelineno-197-101" name="__codelineno-197-101" href="#__codelineno-197-101"></a><span class="s">server</span><span class="w"> </span><span class="s">infra02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.8</span><span class="p">:</span><span class="mi">443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-102"><a id="__codelineno-197-102" name="__codelineno-197-102" href="#__codelineno-197-102"></a><span class="s">server</span><span class="w"> </span><span class="s">infra03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.9</span><span class="p">:</span><span class="mi">443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-103"><a id="__codelineno-197-103" name="__codelineno-197-103" href="#__codelineno-197-103"></a><span class="s">server</span><span class="w"> </span><span class="s">compute01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.10</span><span class="p">:</span><span class="mi">443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-104"><a id="__codelineno-197-104" name="__codelineno-197-104" href="#__codelineno-197-104"></a><span class="s">server</span><span class="w"> </span><span class="s">compute02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.11</span><span class="p">:</span><span class="mi">443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-105"><a id="__codelineno-197-105" name="__codelineno-197-105" href="#__codelineno-197-105"></a><span class="s">server</span><span class="w"> </span><span class="s">compute03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.12</span><span class="p">:</span><span class="mi">443</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-106"><a id="__codelineno-197-106" name="__codelineno-197-106" href="#__codelineno-197-106"></a><span class="s">server</span><span class="w"> </span><span class="s">storage01.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.13</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-107"><a id="__codelineno-197-107" name="__codelineno-197-107" href="#__codelineno-197-107"></a><span class="s">server</span><span class="w"> </span><span class="s">storage02.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.14</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-108"><a id="__codelineno-197-108" name="__codelineno-197-108" href="#__codelineno-197-108"></a><span class="s">server</span><span class="w"> </span><span class="s">storage03.ocp4.platformengineers.xyz</span><span class="w"> </span><span class="n">192.168.252.15</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">check</span>
</span><span id="__span-197-109"><a id="__codelineno-197-109" name="__codelineno-197-109" href="#__codelineno-197-109"></a>
</span><span id="__span-197-110"><a id="__codelineno-197-110" name="__codelineno-197-110" href="#__codelineno-197-110"></a>
</span><span id="__span-197-111"><a id="__codelineno-197-111" name="__codelineno-197-111" href="#__codelineno-197-111"></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="__span-197-112"><a id="__codelineno-197-112" name="__codelineno-197-112" href="#__codelineno-197-112"></a><span class="c1"># Exposing HAProxy Statistic Page</span>
</span><span id="__span-197-113"><a id="__codelineno-197-113" name="__codelineno-197-113" href="#__codelineno-197-113"></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="__span-197-114"><a id="__codelineno-197-114" name="__codelineno-197-114" href="#__codelineno-197-114"></a><span class="c1">#listen stats</span>
</span><span id="__span-197-115"><a id="__codelineno-197-115" name="__codelineno-197-115" href="#__codelineno-197-115"></a><span class="c1">#bind :32700</span>
</span><span id="__span-197-116"><a id="__codelineno-197-116" name="__codelineno-197-116" href="#__codelineno-197-116"></a><span class="c1">#stats enable</span>
</span><span id="__span-197-117"><a id="__codelineno-197-117" name="__codelineno-197-117" href="#__codelineno-197-117"></a><span class="c1">#stats uri /</span>
</span><span id="__span-197-118"><a id="__codelineno-197-118" name="__codelineno-197-118" href="#__codelineno-197-118"></a><span class="c1">#stats hide-version</span>
</span><span id="__span-197-119"><a id="__codelineno-197-119" name="__codelineno-197-119" href="#__codelineno-197-119"></a><span class="c1">#stats auth admin:RedH@t322</span>
</span></code></pre></div> </li> <li> <p>Check the configuration file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-198-1"><a id="__codelineno-198-1" name="__codelineno-198-1" href="#__codelineno-198-1"></a>haproxy -c -f /etc/haproxy/haproxy.cfg
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-199-1"><a id="__codelineno-199-1" name="__codelineno-199-1" href="#__codelineno-199-1"></a>Configuration file is valid
</span></code></pre></div> </li> <li> <p>Enable the service:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-200-1"><a id="__codelineno-200-1" name="__codelineno-200-1" href="#__codelineno-200-1"></a>systemctl enable haproxy
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-201-1"><a id="__codelineno-201-1" name="__codelineno-201-1" href="#__codelineno-201-1"></a>Created symlink /etc/systemd/system/multi-user.target.wants/haproxy.service → /usr/lib/systemd/system/haproxy.service.
</span></code></pre></div> </li> <li> <p>Start the service:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-202-1"><a id="__codelineno-202-1" name="__codelineno-202-1" href="#__codelineno-202-1"></a>systemctl start haproxy
</span></code></pre></div> </li> </ol> <h2 id="26-install-the-http-server-in-the-offline-bastion">26. Install the HTTP server in the offline bastion<a class="headerlink" href="#26-install-the-http-server-in-the-offline-bastion" title="Permanent link">¶</a></h2> <p>For the provisioning of the ignition files to configure the OpenShift cluster nodes, an HTTP server is required. In this installation, that server resides in the offline bastion. In order to install an Apache HTTPD web server, follow the steps below.</p> <ol> <li> <p>Check the http package is installed:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-203-1"><a id="__codelineno-203-1" name="__codelineno-203-1" href="#__codelineno-203-1"></a>yum list installed | grep http
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-204-1"><a id="__codelineno-204-1" name="__codelineno-204-1" href="#__codelineno-204-1"></a>httpd.x86_64     2.4.37-56.module+el8.8.0+19808+379766d6.7     @rhel-8-for-x86_64-appstream-rpms
</span></code></pre></div> </li> <li> <p>Configure the httpd server to boot on port <code>8080</code> by configuring the file in the path <code>/etc/httpd/conf/httpd.conf</code> and changing the default port <code>80</code> to <code>8080</code>.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-205-1"><a id="__codelineno-205-1" name="__codelineno-205-1" href="#__codelineno-205-1"></a>vi /etc/httpd/conf/httpd.conf
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-206-1"><a id="__codelineno-206-1" name="__codelineno-206-1" href="#__codelineno-206-1"></a>[...]
</span><span id="__span-206-2"><a id="__codelineno-206-2" name="__codelineno-206-2" href="#__codelineno-206-2"></a>#
</span><span id="__span-206-3"><a id="__codelineno-206-3" name="__codelineno-206-3" href="#__codelineno-206-3"></a>#Listen 12.34.56.78:80
</span><span id="__span-206-4"><a id="__codelineno-206-4" name="__codelineno-206-4" href="#__codelineno-206-4"></a><span class="hll">Listen 8080
</span></span><span id="__span-206-5"><a id="__codelineno-206-5" name="__codelineno-206-5" href="#__codelineno-206-5"></a>
</span><span id="__span-206-6"><a id="__codelineno-206-6" name="__codelineno-206-6" href="#__codelineno-206-6"></a>#
</span><span id="__span-206-7"><a id="__codelineno-206-7" name="__codelineno-206-7" href="#__codelineno-206-7"></a>[...]
</span></code></pre></div> </li> <li> <p>Start the service:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-207-1"><a id="__codelineno-207-1" name="__codelineno-207-1" href="#__codelineno-207-1"></a>systemctl enable httpd
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-208-1"><a id="__codelineno-208-1" name="__codelineno-208-1" href="#__codelineno-208-1"></a>Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-209-1"><a id="__codelineno-209-1" name="__codelineno-209-1" href="#__codelineno-209-1"></a>systemctl start httpd
</span></code></pre></div> </li> <li> <p>Create the following directory to host the images and the ignition files: </p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-210-1"><a id="__codelineno-210-1" name="__codelineno-210-1" href="#__codelineno-210-1"></a>mkdir /var/www/html/ign
</span></code></pre></div> </li> </ol> <h2 id="27-generate-an-ssh-key-in-the-offline-bastion">27. Generate an SSH key in the offline bastion<a class="headerlink" href="#27-generate-an-ssh-key-in-the-offline-bastion" title="Permanent link">¶</a></h2> <p>In order to be able to log on to the OpenShift cluster nodes from the bastion server using SSH after the installation has been done, a public ssh key needs to be added to the file <code>install-config.yaml</code>.</p> <ol> <li> <p>Generate an SSH key</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-211-1"><a id="__codelineno-211-1" name="__codelineno-211-1" href="#__codelineno-211-1"></a>ssh-keygen -t ed25519 -N '' -f ~/.ssh/id_ed25519
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-212-1"><a id="__codelineno-212-1" name="__codelineno-212-1" href="#__codelineno-212-1"></a>Generating public/private ed25519 key pair.
</span><span id="__span-212-2"><a id="__codelineno-212-2" name="__codelineno-212-2" href="#__codelineno-212-2"></a>Your identification has been saved in /root/.ssh/id_ed25519.
</span><span id="__span-212-3"><a id="__codelineno-212-3" name="__codelineno-212-3" href="#__codelineno-212-3"></a>Your public key has been saved in /root/.ssh/id_ed25519.pub.
</span><span id="__span-212-4"><a id="__codelineno-212-4" name="__codelineno-212-4" href="#__codelineno-212-4"></a>The key fingerprint is:
</span><span id="__span-212-5"><a id="__codelineno-212-5" name="__codelineno-212-5" href="#__codelineno-212-5"></a>SHA256:bldGYez9jXDnXs+6luiy7dDnEFVIoKqVtJpTyaMg/wU root@bastion.ocp4.platformengineers.xyz
</span><span id="__span-212-6"><a id="__codelineno-212-6" name="__codelineno-212-6" href="#__codelineno-212-6"></a>The key's randomart image is:
</span><span id="__span-212-7"><a id="__codelineno-212-7" name="__codelineno-212-7" href="#__codelineno-212-7"></a>+--[ED25519 256]--+
</span><span id="__span-212-8"><a id="__codelineno-212-8" name="__codelineno-212-8" href="#__codelineno-212-8"></a>|           .+o...|
</span><span id="__span-212-9"><a id="__codelineno-212-9" name="__codelineno-212-9" href="#__codelineno-212-9"></a>|           o.... |
</span><span id="__span-212-10"><a id="__codelineno-212-10" name="__codelineno-212-10" href="#__codelineno-212-10"></a>|        . .....  |
</span><span id="__span-212-11"><a id="__codelineno-212-11" name="__codelineno-212-11" href="#__codelineno-212-11"></a>|       o = .o.o .|
</span><span id="__span-212-12"><a id="__codelineno-212-12" name="__codelineno-212-12" href="#__codelineno-212-12"></a>|  . . E S   +o =.|
</span><span id="__span-212-13"><a id="__codelineno-212-13" name="__codelineno-212-13" href="#__codelineno-212-13"></a>|   o . X . + .. =|
</span><span id="__span-212-14"><a id="__codelineno-212-14" name="__codelineno-212-14" href="#__codelineno-212-14"></a>|    . * + o o..+o|
</span><span id="__span-212-15"><a id="__codelineno-212-15" name="__codelineno-212-15" href="#__codelineno-212-15"></a>|     . + ..o.+o +|
</span><span id="__span-212-16"><a id="__codelineno-212-16" name="__codelineno-212-16" href="#__codelineno-212-16"></a>|      .   .=+.+o |
</span><span id="__span-212-17"><a id="__codelineno-212-17" name="__codelineno-212-17" href="#__codelineno-212-17"></a>+----[SHA256]-----+
</span></code></pre></div> </li> <li> <p>Display the public key:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-213-1"><a id="__codelineno-213-1" name="__codelineno-213-1" href="#__codelineno-213-1"></a>cat /root/.ssh/id_ed25519.pub
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-214-1"><a id="__codelineno-214-1" name="__codelineno-214-1" href="#__codelineno-214-1"></a>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIET7OJRP4wD7ibIvcQxA9/9B80qUp0IPog0M9E7zofED root@bastion.ocp4.platformengineers.xyz
</span></code></pre></div> </li> <li> <p>Start the SSH agent</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-215-1"><a id="__codelineno-215-1" name="__codelineno-215-1" href="#__codelineno-215-1"></a>eval "$(ssh-agent -s)"
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-216-1"><a id="__codelineno-216-1" name="__codelineno-216-1" href="#__codelineno-216-1"></a>Agent pid 7233
</span></code></pre></div> </li> <li> <p>Add the key to the SSH agent</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-217-1"><a id="__codelineno-217-1" name="__codelineno-217-1" href="#__codelineno-217-1"></a>ssh-add ~/.ssh/id_ed25519
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-218-1"><a id="__codelineno-218-1" name="__codelineno-218-1" href="#__codelineno-218-1"></a>Identity added: /root/.ssh/id_ed25519 (root@bastion.ocp4.platformengineers.xyz)
</span></code></pre></div> </li> </ol> <h2 id="28-configure-the-coreos-iso-maker-in-the-online-bastion">28. Configure the CoreOS ISO Maker in the online bastion<a class="headerlink" href="#28-configure-the-coreos-iso-maker-in-the-online-bastion" title="Permanent link">¶</a></h2> <ol> <li> <p>Exit the offline bastion:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-219-1"><a id="__codelineno-219-1" name="__codelineno-219-1" href="#__codelineno-219-1"></a>exit
</span></code></pre></div> </li> <li> <p>Access the online bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-220-1"><a id="__codelineno-220-1" name="__codelineno-220-1" href="#__codelineno-220-1"></a>ssh root@192.168.252.22
</span></code></pre></div> </li> <li> <p>Change to the route where the CoreOS ISO Maker is</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline ~]</span><pre><span></span><code><span id="__span-221-1"><a id="__codelineno-221-1" name="__codelineno-221-1" href="#__codelineno-221-1"></a>cd /root/Coreos-iso-maker/coreos-iso-maker/
</span></code></pre></div> </li> </ol> <p>In the file <code>group_vars/all.yml</code> the following configuration is defined:</p> <table> <thead> <tr> <th>Variable</th> <th>Definition</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>gateway</td> <td>default IP router</td> <td>192.168.252.1</td> </tr> <tr> <td>netmask</td> <td>default netmask</td> <td>255.255.255.0</td> </tr> <tr> <td>interface</td> <td>NIC device name</td> <td>ens192</td> </tr> <tr> <td>dns</td> <td>dns server. This can be done as a list. Don't add more than 3</td> <td>192.168.252.23</td> </tr> <tr> <td>webserver_url</td> <td>webserver that holds the Ignition file</td> <td>bastion.ocp4.platformengineers.xyz</td> </tr> <tr> <td>webserver_port</td> <td>webserver port for the webserver above</td> <td>80</td> </tr> <tr> <td>webserver_ignition_path</td> <td>Ignition subpath in http server</td> <td>ign</td> </tr> <tr> <td>install_drive</td> <td>drive to install RHCOS on</td> <td>sda</td> </tr> <tr> <td>ocp_version</td> <td>Full CoreOS version you are going for</td> <td>4.16.3</td> </tr> <tr> <td>is_checksum</td> <td>sha256 checksum of the ISO. Got it from <a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.16/4.16.3/sha256sum.txt">https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.16/4.16.3/sha256sum.txt</a></td> <td>b4b2bbe4462258e9d30cab2f4a9d94b45960bc03ffa578be3400b9cbcac4912c</td> </tr> <tr> <td>iso_name</td> <td>Name of the ISO to download. Makes certain assumptions that should be verified</td> <td>rhcos-{{ocp_version }}-x86_64-live.x86_64.iso</td> </tr> <tr> <td>rhcos_bios</td> <td>Name of the BIOS image to boot from. This is how the file is named on your webserver. Make certain assumptions that should be verified</td> <td>rhcos-{{ocp_version }}-x86_64-metal.x86_64.raw.gz</td> </tr> <tr> <td>arch</td> <td>The CPU Architecture type. Must be one of x86_64 (default) or ppc64le</td> <td>x86_64</td> </tr> </tbody> </table> <ol> <li> <p>Open the <code>group_vars/all.yml</code> file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline core-iso-maker]</span><pre><span></span><code><span id="__span-222-1"><a id="__codelineno-222-1" name="__codelineno-222-1" href="#__codelineno-222-1"></a>vi group_vars/all.yml
</span></code></pre></div> </li> <li> <p>Make sure it looks like below:</p> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>Although you can read <code>ocp_version</code> in the file below, it refers to the RedHat CoreOS version you are getting installed (4.16.3). The OpenShift version that will eventually get installed remains 4.16.9 which is the OpentShift install binaries, CLI and container images version we have downloaded previously in this tutorial.</p> </div> <div class="language-yaml copy highlight"><span class="filename">all.yml</span><pre><span></span><code><span id="__span-223-1"><a id="__codelineno-223-1" name="__codelineno-223-1" href="#__codelineno-223-1"></a><span class="nn">---</span>
</span><span id="__span-223-2"><a id="__codelineno-223-2" name="__codelineno-223-2" href="#__codelineno-223-2"></a><span class="c1"># If only one network interface</span>
</span><span id="__span-223-3"><a id="__codelineno-223-3" name="__codelineno-223-3" href="#__codelineno-223-3"></a><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.1</span>
</span><span id="__span-223-4"><a id="__codelineno-223-4" name="__codelineno-223-4" href="#__codelineno-223-4"></a><span class="nt">netmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255.255.255.0</span>
</span><span id="__span-223-5"><a id="__codelineno-223-5" name="__codelineno-223-5" href="#__codelineno-223-5"></a><span class="c1"># VMWare default ens192</span>
</span><span id="__span-223-6"><a id="__codelineno-223-6" name="__codelineno-223-6" href="#__codelineno-223-6"></a><span class="c1"># KVM default ens3</span>
</span><span id="__span-223-7"><a id="__codelineno-223-7" name="__codelineno-223-7" href="#__codelineno-223-7"></a><span class="c1"># Libvirt default enp1s0</span>
</span><span id="__span-223-8"><a id="__codelineno-223-8" name="__codelineno-223-8" href="#__codelineno-223-8"></a><span class="c1"># Intel NUC default eno1</span>
</span><span id="__span-223-9"><a id="__codelineno-223-9" name="__codelineno-223-9" href="#__codelineno-223-9"></a><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ens192</span>
</span><span id="__span-223-10"><a id="__codelineno-223-10" name="__codelineno-223-10" href="#__codelineno-223-10"></a>
</span><span id="__span-223-11"><a id="__codelineno-223-11" name="__codelineno-223-11" href="#__codelineno-223-11"></a><span class="nt">dns</span><span class="p">:</span>
</span><span id="__span-223-12"><a id="__codelineno-223-12" name="__codelineno-223-12" href="#__codelineno-223-12"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.23</span>
</span><span id="__span-223-13"><a id="__codelineno-223-13" name="__codelineno-223-13" href="#__codelineno-223-13"></a>
</span><span id="__span-223-14"><a id="__codelineno-223-14" name="__codelineno-223-14" href="#__codelineno-223-14"></a><span class="nt">webserver_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz</span>
</span><span id="__span-223-15"><a id="__codelineno-223-15" name="__codelineno-223-15" href="#__codelineno-223-15"></a><span class="nt">webserver_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-223-16"><a id="__codelineno-223-16" name="__codelineno-223-16" href="#__codelineno-223-16"></a><span class="c1"># Ignition subpath in http server (optionnal, defaults to nothing)</span>
</span><span id="__span-223-17"><a id="__codelineno-223-17" name="__codelineno-223-17" href="#__codelineno-223-17"></a><span class="nt">webserver_ignition_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/ign</span>
</span><span id="__span-223-18"><a id="__codelineno-223-18" name="__codelineno-223-18" href="#__codelineno-223-18"></a><span class="c1"># Path to download master ignition file will be</span>
</span><span id="__span-223-19"><a id="__codelineno-223-19" name="__codelineno-223-19" href="#__codelineno-223-19"></a><span class="c1"># http://192.168.1.20:8080/ignition/master.ign</span>
</span><span id="__span-223-20"><a id="__codelineno-223-20" name="__codelineno-223-20" href="#__codelineno-223-20"></a>
</span><span id="__span-223-21"><a id="__codelineno-223-21" name="__codelineno-223-21" href="#__codelineno-223-21"></a><span class="c1"># Drive to install RHCOS</span>
</span><span id="__span-223-22"><a id="__codelineno-223-22" name="__codelineno-223-22" href="#__codelineno-223-22"></a><span class="c1"># Libvirt - can be vda</span>
</span><span id="__span-223-23"><a id="__codelineno-223-23" name="__codelineno-223-23" href="#__codelineno-223-23"></a><span class="nt">install_drive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sda</span>
</span><span id="__span-223-24"><a id="__codelineno-223-24" name="__codelineno-223-24" href="#__codelineno-223-24"></a>
</span><span id="__span-223-25"><a id="__codelineno-223-25" name="__codelineno-223-25" href="#__codelineno-223-25"></a><span class="c1"># Timeout for selection menu during first boot</span>
</span><span id="__span-223-26"><a id="__codelineno-223-26" name="__codelineno-223-26" href="#__codelineno-223-26"></a><span class="c1"># '-1' for infinite timeout. Default '10'</span>
</span><span id="__span-223-27"><a id="__codelineno-223-27" name="__codelineno-223-27" href="#__codelineno-223-27"></a><span class="nt">boot_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span>
</span><span id="__span-223-28"><a id="__codelineno-223-28" name="__codelineno-223-28" href="#__codelineno-223-28"></a>
</span><span id="__span-223-29"><a id="__codelineno-223-29" name="__codelineno-223-29" href="#__codelineno-223-29"></a><span class="c1"># Chose the binary architecture</span>
</span><span id="__span-223-30"><a id="__codelineno-223-30" name="__codelineno-223-30" href="#__codelineno-223-30"></a><span class="c1"># x86_64 or ppc64le</span>
</span><span id="__span-223-31"><a id="__codelineno-223-31" name="__codelineno-223-31" href="#__codelineno-223-31"></a><span class="nt">arch</span><span class="p">:</span><span class="w"> </span><span class="s">"x86_64"</span>
</span><span id="__span-223-32"><a id="__codelineno-223-32" name="__codelineno-223-32" href="#__codelineno-223-32"></a>
</span><span id="__span-223-33"><a id="__codelineno-223-33" name="__codelineno-223-33" href="#__codelineno-223-33"></a><span class="nt">ocp_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.16.3</span>
</span><span id="__span-223-34"><a id="__codelineno-223-34" name="__codelineno-223-34" href="#__codelineno-223-34"></a><span class="c1">#iso_checksum: d15bd7ae942573eece34ba9c59e110e360f15608f36e9b83ab9f2372d235bef2</span>
</span><span id="__span-223-35"><a id="__codelineno-223-35" name="__codelineno-223-35" href="#__codelineno-223-35"></a><span class="nt">iso_checksum</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b4b2bbe4462258e9d30cab2f4a9d94b45960bc03ffa578be3400b9cbcac4912c</span>
</span><span id="__span-223-36"><a id="__codelineno-223-36" name="__codelineno-223-36" href="#__codelineno-223-36"></a><span class="c1">#iso_checksum_ppc64: ff3ef20a0c4c29022f52ad932278b9040739dc48f4062411b5a3255af863c95e</span>
</span><span id="__span-223-37"><a id="__codelineno-223-37" name="__codelineno-223-37" href="#__codelineno-223-37"></a><span class="nt">iso_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rhcos-{{ ocp_version }}-x86_64-live.x86_64.iso</span>
</span><span id="__span-223-38"><a id="__codelineno-223-38" name="__codelineno-223-38" href="#__codelineno-223-38"></a><span class="c1">#iso_name_ppc64: rhcos-{{ ocp_version }}-ppc64le-installer.ppc64le.iso</span>
</span><span id="__span-223-39"><a id="__codelineno-223-39" name="__codelineno-223-39" href="#__codelineno-223-39"></a><span class="nt">rhcos_bios</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rhcos-{{ ocp_version }}-x86_64-metal.x86_64.raw.gz</span>
</span><span id="__span-223-40"><a id="__codelineno-223-40" name="__codelineno-223-40" href="#__codelineno-223-40"></a><span class="nn">...</span>
</span></code></pre></div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>Dont forget to set <code>boot_timeout: -1</code> so that you have no time limit when asked for the machine type at boot time</p> </div> </li> </ol> <p>The machines of the OpenShift cluster are defined in the <code>inventory.yml</code> file.</p> <ol> <li> <p>Open the <code>inventory.yml</code> file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline core-iso-maker]</span><pre><span></span><code><span id="__span-224-1"><a id="__codelineno-224-1" name="__codelineno-224-1" href="#__codelineno-224-1"></a>vi inventory.yml
</span></code></pre></div> </li> <li> <p>Make sure the file looks like below:</p> <div class="language-yaml copy highlight"><span class="filename">inventory.yml</span><pre><span></span><code><span id="__span-225-1"><a id="__codelineno-225-1" name="__codelineno-225-1" href="#__codelineno-225-1"></a><span class="nn">---</span><span class="w"> </span>
</span><span id="__span-225-2"><a id="__codelineno-225-2" name="__codelineno-225-2" href="#__codelineno-225-2"></a><span class="nt">all</span><span class="p">:</span>
</span><span id="__span-225-3"><a id="__codelineno-225-3" name="__codelineno-225-3" href="#__codelineno-225-3"></a><span class="w">  </span><span class="nt">children</span><span class="p">:</span>
</span><span id="__span-225-4"><a id="__codelineno-225-4" name="__codelineno-225-4" href="#__codelineno-225-4"></a><span class="w">    </span><span class="nt">bootstrap</span><span class="p">:</span>
</span><span id="__span-225-5"><a id="__codelineno-225-5" name="__codelineno-225-5" href="#__codelineno-225-5"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-6"><a id="__codelineno-225-6" name="__codelineno-225-6" href="#__codelineno-225-6"></a><span class="w">        </span><span class="nt">bootstrap.ocp4.platformengineers.xyz</span><span class="p">:</span>
</span><span id="__span-225-7"><a id="__codelineno-225-7" name="__codelineno-225-7" href="#__codelineno-225-7"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-8"><a id="__codelineno-225-8" name="__codelineno-225-8" href="#__codelineno-225-8"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.3</span>
</span><span id="__span-225-9"><a id="__codelineno-225-9" name="__codelineno-225-9" href="#__codelineno-225-9"></a><span class="w">    </span><span class="nt">controlplane</span><span class="p">:</span>
</span><span id="__span-225-10"><a id="__codelineno-225-10" name="__codelineno-225-10" href="#__codelineno-225-10"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-225-11"><a id="__codelineno-225-11" name="__codelineno-225-11" href="#__codelineno-225-11"></a><span class="w">        </span><span class="nt">controlplane01.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-12"><a id="__codelineno-225-12" name="__codelineno-225-12" href="#__codelineno-225-12"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-13"><a id="__codelineno-225-13" name="__codelineno-225-13" href="#__codelineno-225-13"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.4</span>
</span><span id="__span-225-14"><a id="__codelineno-225-14" name="__codelineno-225-14" href="#__codelineno-225-14"></a><span class="w">        </span><span class="nt">controlplane02.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-15"><a id="__codelineno-225-15" name="__codelineno-225-15" href="#__codelineno-225-15"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-16"><a id="__codelineno-225-16" name="__codelineno-225-16" href="#__codelineno-225-16"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.5</span>
</span><span id="__span-225-17"><a id="__codelineno-225-17" name="__codelineno-225-17" href="#__codelineno-225-17"></a><span class="w">        </span><span class="nt">controlplane03.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-18"><a id="__codelineno-225-18" name="__codelineno-225-18" href="#__codelineno-225-18"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-19"><a id="__codelineno-225-19" name="__codelineno-225-19" href="#__codelineno-225-19"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.6</span>
</span><span id="__span-225-20"><a id="__codelineno-225-20" name="__codelineno-225-20" href="#__codelineno-225-20"></a><span class="w">    </span><span class="nt">compute</span><span class="p">:</span>
</span><span id="__span-225-21"><a id="__codelineno-225-21" name="__codelineno-225-21" href="#__codelineno-225-21"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-225-22"><a id="__codelineno-225-22" name="__codelineno-225-22" href="#__codelineno-225-22"></a><span class="w">        </span><span class="nt">infra01.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-23"><a id="__codelineno-225-23" name="__codelineno-225-23" href="#__codelineno-225-23"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-24"><a id="__codelineno-225-24" name="__codelineno-225-24" href="#__codelineno-225-24"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.7</span>
</span><span id="__span-225-25"><a id="__codelineno-225-25" name="__codelineno-225-25" href="#__codelineno-225-25"></a><span class="w">        </span><span class="nt">infra02.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-26"><a id="__codelineno-225-26" name="__codelineno-225-26" href="#__codelineno-225-26"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-27"><a id="__codelineno-225-27" name="__codelineno-225-27" href="#__codelineno-225-27"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.8</span>
</span><span id="__span-225-28"><a id="__codelineno-225-28" name="__codelineno-225-28" href="#__codelineno-225-28"></a><span class="w">        </span><span class="nt">infra03.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-29"><a id="__codelineno-225-29" name="__codelineno-225-29" href="#__codelineno-225-29"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-30"><a id="__codelineno-225-30" name="__codelineno-225-30" href="#__codelineno-225-30"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.9</span>
</span><span id="__span-225-31"><a id="__codelineno-225-31" name="__codelineno-225-31" href="#__codelineno-225-31"></a><span class="w">        </span><span class="nt">compute01.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-32"><a id="__codelineno-225-32" name="__codelineno-225-32" href="#__codelineno-225-32"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-33"><a id="__codelineno-225-33" name="__codelineno-225-33" href="#__codelineno-225-33"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.10</span><span class="w">                </span>
</span><span id="__span-225-34"><a id="__codelineno-225-34" name="__codelineno-225-34" href="#__codelineno-225-34"></a><span class="w">        </span><span class="nt">compute02.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-35"><a id="__codelineno-225-35" name="__codelineno-225-35" href="#__codelineno-225-35"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-36"><a id="__codelineno-225-36" name="__codelineno-225-36" href="#__codelineno-225-36"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.11</span>
</span><span id="__span-225-37"><a id="__codelineno-225-37" name="__codelineno-225-37" href="#__codelineno-225-37"></a><span class="w">        </span><span class="nt">compute03.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-38"><a id="__codelineno-225-38" name="__codelineno-225-38" href="#__codelineno-225-38"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-39"><a id="__codelineno-225-39" name="__codelineno-225-39" href="#__codelineno-225-39"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.12</span>
</span><span id="__span-225-40"><a id="__codelineno-225-40" name="__codelineno-225-40" href="#__codelineno-225-40"></a><span class="w">        </span><span class="nt">storage01.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-41"><a id="__codelineno-225-41" name="__codelineno-225-41" href="#__codelineno-225-41"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-42"><a id="__codelineno-225-42" name="__codelineno-225-42" href="#__codelineno-225-42"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.13</span><span class="w">                </span>
</span><span id="__span-225-43"><a id="__codelineno-225-43" name="__codelineno-225-43" href="#__codelineno-225-43"></a><span class="w">        </span><span class="nt">storage02.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-44"><a id="__codelineno-225-44" name="__codelineno-225-44" href="#__codelineno-225-44"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-45"><a id="__codelineno-225-45" name="__codelineno-225-45" href="#__codelineno-225-45"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.14</span>
</span><span id="__span-225-46"><a id="__codelineno-225-46" name="__codelineno-225-46" href="#__codelineno-225-46"></a><span class="w">        </span><span class="nt">storage03.ocp4.platformengineers.xyz</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-225-47"><a id="__codelineno-225-47" name="__codelineno-225-47" href="#__codelineno-225-47"></a><span class="w">          </span><span class="nt">dhcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-225-48"><a id="__codelineno-225-48" name="__codelineno-225-48" href="#__codelineno-225-48"></a><span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.15</span><span class="w"> </span>
</span><span id="__span-225-49"><a id="__codelineno-225-49" name="__codelineno-225-49" href="#__codelineno-225-49"></a><span class="nn">...</span>
</span></code></pre></div> </li> <li> <p>Copy the RHCOS ISO live image and the metal raw file for the OpenShift version we are going to install to the temporary directory:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline core-iso-maker]</span><pre><span></span><code><span id="__span-226-1"><a id="__codelineno-226-1" name="__codelineno-226-1" href="#__codelineno-226-1"></a>cp /root/registry/downloads/images/rhcos-4.16.3-x86_64-live.x86_64.iso /tmp
</span><span id="__span-226-2"><a id="__codelineno-226-2" name="__codelineno-226-2" href="#__codelineno-226-2"></a>cp /root/registry/downloads/images/rhcos-4.16.3-x86_64-metal.x86_64.raw.gz /tmp
</span></code></pre></div> </li> <li> <p>Run the following Ansible playbook to create the ISO image:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline core-iso-maker]</span><pre><span></span><code><span id="__span-227-1"><a id="__codelineno-227-1" name="__codelineno-227-1" href="#__codelineno-227-1"></a>ansible-playbook playbook-single.yml
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-228-1"><a id="__codelineno-228-1" name="__codelineno-228-1" href="#__codelineno-228-1"></a>[...]
</span><span id="__span-228-2"><a id="__codelineno-228-2" name="__codelineno-228-2" href="#__codelineno-228-2"></a>PLAY RECAP *********************************************************************************************************************
</span><span id="__span-228-3"><a id="__codelineno-228-3" name="__codelineno-228-3" href="#__codelineno-228-3"></a>bootstrap.ocp4.platformengineers.xyz : ok=4    changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-4"><a id="__codelineno-228-4" name="__codelineno-228-4" href="#__codelineno-228-4"></a>infra01.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-5"><a id="__codelineno-228-5" name="__codelineno-228-5" href="#__codelineno-228-5"></a>infra02.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-6"><a id="__codelineno-228-6" name="__codelineno-228-6" href="#__codelineno-228-6"></a>infra03.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-7"><a id="__codelineno-228-7" name="__codelineno-228-7" href="#__codelineno-228-7"></a>localhost                  : ok=7    changed=4    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0
</span><span id="__span-228-8"><a id="__codelineno-228-8" name="__codelineno-228-8" href="#__codelineno-228-8"></a>controlplane01.ocp4.platformengineers.xyz : ok=4    changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-9"><a id="__codelineno-228-9" name="__codelineno-228-9" href="#__codelineno-228-9"></a>controlplane02.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-10"><a id="__codelineno-228-10" name="__codelineno-228-10" href="#__codelineno-228-10"></a>controlplane03.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-11"><a id="__codelineno-228-11" name="__codelineno-228-11" href="#__codelineno-228-11"></a>compute01.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-12"><a id="__codelineno-228-12" name="__codelineno-228-12" href="#__codelineno-228-12"></a>compute02.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-13"><a id="__codelineno-228-13" name="__codelineno-228-13" href="#__codelineno-228-13"></a>compute03.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-14"><a id="__codelineno-228-14" name="__codelineno-228-14" href="#__codelineno-228-14"></a>storage01.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-15"><a id="__codelineno-228-15" name="__codelineno-228-15" href="#__codelineno-228-15"></a>storage02.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span><span id="__span-228-16"><a id="__codelineno-228-16" name="__codelineno-228-16" href="#__codelineno-228-16"></a>storage03.ocp4.platformengineers.xyz : ok=4    changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
</span></code></pre></div> </li> </ol> <p>Copy the resulting ISO files to the image directory <code>/root/registry/downloads/images/</code> and upload the <code>rhcos-install-cluster.iso</code> file to the vCenter datastore to be used as an ISO to install the OpenShift cluster master and worker nodes.</p> <ol> <li> <p>List the ISO files in the <code>/tmp</code> folder</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline core-iso-maker]</span><pre><span></span><code><span id="__span-229-1"><a id="__codelineno-229-1" name="__codelineno-229-1" href="#__codelineno-229-1"></a>ls -lart /tmp/*iso
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-230-1"><a id="__codelineno-230-1" name="__codelineno-230-1" href="#__codelineno-230-1"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1220542464</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">11</span>:58<span class="w"> </span>/tmp/rhcos-4.16.3-x86_64-live.x86_64.iso
</span><span id="__span-230-2"><a id="__codelineno-230-2" name="__codelineno-230-2" href="#__codelineno-230-2"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1220235264</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">11</span>:59<span class="w"> </span>/tmp/rhcos-install-cluster.iso
</span></code></pre></div> </li> <li> <p>Move original ISO files to their own folder:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline core-iso-maker]</span><pre><span></span><code><span id="__span-231-1"><a id="__codelineno-231-1" name="__codelineno-231-1" href="#__codelineno-231-1"></a>mkdir /root/registry/downloads/images/orig
</span><span id="__span-231-2"><a id="__codelineno-231-2" name="__codelineno-231-2" href="#__codelineno-231-2"></a>mv /root/registry/downloads/images/rhcos-4.16.3-x86_64-* /root/registry/downloads/images/orig/
</span><span id="__span-231-3"><a id="__codelineno-231-3" name="__codelineno-231-3" href="#__codelineno-231-3"></a>cp /tmp/*.iso /root/registry/downloads/images/
</span><span id="__span-231-4"><a id="__codelineno-231-4" name="__codelineno-231-4" href="#__codelineno-231-4"></a>chmod 777 /tmp/rhcos-install-cluster.iso
</span></code></pre></div> </li> <li> <p>SCP the final ISO file into the Guacamole VM.</p> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>The following command is <strong>executed from within the Guacamole VM</strong>. That is, you need to connect to the vCenter, launch the web console for the Guacamole VM, open a terminal window in there and execute the command below. To upload ISO files, as we did in the section <a href="#7-guacamole-vm">7. Guacamole VM</a> at the begining of the course for uploading the RHEL 8.7 OS ISO file for the online bastion and offline bastion, we must do it from the Guacamole VM because the VPN bandwidth is very limited.</p> </div> <div class="admonition tip"> <p class="admonition-title">Extra tip for free ;-)</p> <p>To get the <code>@</code> symbol typed on the terminal, because the layout of the keyboard set up in the Guacamole VM might very well be different than your laptops keyboard layout, we strongly recommned you open the brower and google "at symbol". From the results displayed by Google, copy the <code>@</code> symbol and paste it in your terminal</p> </div> <div class="language-text copy highlight"><span class="filename">[Guacamole VM]</span><pre><span></span><code><span id="__span-232-1"><a id="__codelineno-232-1" name="__codelineno-232-1" href="#__codelineno-232-1"></a>scp root@192.168.252.22:/tmp/rhcos-install-cluster.iso ./
</span></code></pre></div> </li> </ol> <p>Once you have copied the ISO file from the online bastion, you must add the file to vCenter into a datastore:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/69.png" data-desc-position="bottom"><img alt="69" src="../images/airgap-4-12/69.png" style="max-height:400px"></a></p> <h2 id="29-create-the-openshift-vms-in-the-vcenter">29. Create the OpenShift VMs in the vCenter<a class="headerlink" href="#29-create-the-openshift-vms-in-the-vcenter" title="Permanent link">¶</a></h2> <p>We need to create the following virtual machines in vCenter according to the following specs:</p> <p>| <strong>Type</strong> | <strong>Number of servers</strong> | <strong>vCPU</strong> | <strong>RAM Memory</strong> | <strong>Storage (system)</strong> | <strong>Storage (data)</strong> | |------|-------------------|------|------------|------------------|----------------|-----| |<strong>Control Plane</strong> |3|8 vCPU|32 GB|300 GB|0 GB| |<strong>Infra</strong> |3|8 vCPU|32 GB|300 GB|0 GB| |<strong>Compute</strong> |3|16 vCPU|64 GB|300 GB|0 GB| |<strong>Storage</strong> |3|16 vCPU|64 GB|300 GB|500 GB| |<strong>Bootstrap</strong> |1|4 vCPU|16 GB|320 GB|0 GB|</p> <p>And with the following nomenclature:</p> <table> <thead> <tr> <th><strong>Type</strong></th> <th><strong>FQDN hostname</strong></th> </tr> </thead> <tbody> <tr> <td><strong>Bootstrap</strong></td> <td>bootstrap.ocp4.platformengineers.xyz</td> </tr> <tr> <td><strong>Control Plane</strong></td> <td>controlplane01.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>controlplane02.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>controlplane03.ocp4.platformengineers.xyz</td> </tr> <tr> <td><strong>Infra</strong></td> <td>infra01.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>infra02.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>infra03.ocp4.platformengineers.xyz</td> </tr> <tr> <td><strong>Compute</strong></td> <td>compute01.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>compute02.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>compute03.ocp4.platformengineers.xyz</td> </tr> <tr> <td><strong>Storage</strong></td> <td>storage01.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>storage02.ocp4.platformengineers.xyz</td> </tr> <tr> <td></td> <td>storage03.ocp4.platformengineers.xyz</td> </tr> </tbody> </table> <p>You can create folders for the different type of VMs if you wish.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/33.png" data-desc-position="bottom"><img alt="32" src="../images/airgap-4-12/33.png" style="max-height:400px"></a></p> <p>You can review the process for creating the VMs in the section <a href="#81-create-the-online-bastion-node">Create the online bastion</a>.</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/34.png" data-desc-position="bottom"><img alt="33" src="../images/airgap-4-12/34.png" style="max-height:600px"></a></p> <p>You need to configure the machines to boot from the ISO that was created in the previous chapter <a href="#29-configure-coreos-iso-maker-in-online-bastion">Configure CoreOS ISO Maker in "online" bastion</a></p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/35.png" data-desc-position="bottom"><img alt="35" src="../images/airgap-4-12/35.png" style="max-height:600px"></a></p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/36.png" data-desc-position="bottom"><img alt="36" src="../images/airgap-4-12/36.png" style="max-height:600px"></a></p> <p>At the end, you should have the following VMs created in your vCenter</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/37.png" data-desc-position="bottom"><img alt="37" src="../images/airgap-4-12/37.png" style="max-height:700px"></a></p> <h2 id="30-create-the-install-configyaml-file">30. Create the install-config.yaml file<a class="headerlink" href="#30-create-the-install-configyaml-file" title="Permanent link">¶</a></h2> <ol> <li> <p>Exit the online bastion:</p> <div class="language-text copy highlight"><span class="filename">[root@bastiononline coreos-iso-maker]</span><pre><span></span><code><span id="__span-233-1"><a id="__codelineno-233-1" name="__codelineno-233-1" href="#__codelineno-233-1"></a>exit
</span></code></pre></div> </li> <li> <p>Access the offline bastion:</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-234-1"><a id="__codelineno-234-1" name="__codelineno-234-1" href="#__codelineno-234-1"></a>ssh root@192.168.252.23
</span></code></pre></div> </li> <li> <p>Create the directory where the <code>install-config.yaml</code> file will be placed:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-235-1"><a id="__codelineno-235-1" name="__codelineno-235-1" href="#__codelineno-235-1"></a>cd /root/registry/downloads/tools/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-236-1"><a id="__codelineno-236-1" name="__codelineno-236-1" href="#__codelineno-236-1"></a>mkdir ocp4
</span><span id="__span-236-2"><a id="__codelineno-236-2" name="__codelineno-236-2" href="#__codelineno-236-2"></a>cd ocp4
</span></code></pre></div> </li> </ol> <p>You need to cat the following files to create the <code>install-config.yaml</code> in the next step:</p> <ol> <li> <p>Quay private image registry CA</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-237-1"><a id="__codelineno-237-1" name="__codelineno-237-1" href="#__codelineno-237-1"></a>cat /root/registry/quay-rootCA/rootCA.pem
</span></code></pre></div> <div class="language-pem no-copy highlight"><span class="filename">rootCA.pem</span><pre><span></span><code><span id="__span-238-1"><a id="__codelineno-238-1" name="__codelineno-238-1" href="#__codelineno-238-1"></a><span class="gh">-----BEGIN CERTIFICATE-----</span>
</span><span id="__span-238-2"><a id="__codelineno-238-2" name="__codelineno-238-2" href="#__codelineno-238-2"></a><span class="s">MIID3jCCAsagAwIBAgIUHj/Ux66Fpoktc/qtzoP6wgWZ2aIwDQYJKoZIhvcNAQEL</span>
</span><span id="__span-238-3"><a id="__codelineno-238-3" name="__codelineno-238-3" href="#__codelineno-238-3"></a><span class="s">BQAwdzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAlZBMREwDwYDVQQHDAhOZXcgWW9y</span>
</span><span id="__span-238-4"><a id="__codelineno-238-4" name="__codelineno-238-4" href="#__codelineno-238-4"></a><span class="s">azENMAsGA1UECgwEUXVheTERMA8GA1UECwwIRGl2aXNpb24xJjAkBgNVBAMMHWJh</span>
</span><span id="__span-238-5"><a id="__codelineno-238-5" name="__codelineno-238-5" href="#__codelineno-238-5"></a><span class="s">c3Rpb24ub2NwNC5jc20tc3BnaS5hY21lLmVzMB4XDTIzMDkyMTE4NDAzM1oXDTI2</span>
</span><span id="__span-238-6"><a id="__codelineno-238-6" name="__codelineno-238-6" href="#__codelineno-238-6"></a><span class="s">MDcxMTE4NDAzM1owdzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAlZBMREwDwYDVQQH</span>
</span><span id="__span-238-7"><a id="__codelineno-238-7" name="__codelineno-238-7" href="#__codelineno-238-7"></a><span class="s">DAhOZXcgWW9yazENMAsGA1UECgwEUXVheTERMA8GA1UECwwIRGl2aXNpb24xJjAk</span>
</span><span id="__span-238-8"><a id="__codelineno-238-8" name="__codelineno-238-8" href="#__codelineno-238-8"></a><span class="s">BgNVBAMMHWJhc3Rpb24ub2NwNC5jc20tc3BnaS5hY21lLmVzMIIBIjANBgkqhkiG</span>
</span><span id="__span-238-9"><a id="__codelineno-238-9" name="__codelineno-238-9" href="#__codelineno-238-9"></a><span class="s">9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv3eDBDh1GH6i+hptdlbMPYztWDsHCihyjRta</span>
</span><span id="__span-238-10"><a id="__codelineno-238-10" name="__codelineno-238-10" href="#__codelineno-238-10"></a><span class="s">WgD3SEyHobuWM/lSepwMC2mmyejZKsv/x4PYFsNrWBwt1oVicP3+sGNuNfKheFgn</span>
</span><span id="__span-238-11"><a id="__codelineno-238-11" name="__codelineno-238-11" href="#__codelineno-238-11"></a><span class="s">LAiXAgt35MLPR7oXZKCb82rb5jFUYWU6Ro2xHv8qxLAAv+BRzq5fDYczvsps3pq0</span>
</span><span id="__span-238-12"><a id="__codelineno-238-12" name="__codelineno-238-12" href="#__codelineno-238-12"></a><span class="s">rvdNLfCORBmtQnoRuKXTmOreQgZqHZkhb1g8P4jE+BJugSAQT4gy1cnP5HXFqpdC</span>
</span><span id="__span-238-13"><a id="__codelineno-238-13" name="__codelineno-238-13" href="#__codelineno-238-13"></a><span class="s">qaehQeQEi+k3yHVdYnMyVC2Ya609SUUeSUxuLrlO2EQTSwLzSZ02sMsIfBKbOgmu</span>
</span><span id="__span-238-14"><a id="__codelineno-238-14" name="__codelineno-238-14" href="#__codelineno-238-14"></a><span class="s">TJPGgd5jqrSu1LDem8YKws8u0MVEhkl3LkuUuOYBbt4kPxoTIwIDAQABo2IwYDAL</span>
</span><span id="__span-238-15"><a id="__codelineno-238-15" name="__codelineno-238-15" href="#__codelineno-238-15"></a><span class="s">BgNVHQ8EBAMCAuQwEwYDVR0lBAwwCgYIKwYBBQUHAwEwKAYDVR0RBCEwH4IdYmFz</span>
</span><span id="__span-238-16"><a id="__codelineno-238-16" name="__codelineno-238-16" href="#__codelineno-238-16"></a><span class="s">dGlvbi5vY3A0LmNzbS1zcGdpLmFjbWUuZXMwEgYDVR0TAQH/BAgwBgEB/wIBATAN</span>
</span><span id="__span-238-17"><a id="__codelineno-238-17" name="__codelineno-238-17" href="#__codelineno-238-17"></a><span class="s">BgkqhkiG9w0BAQsFAAOCAQEAEIanwOhmODUlshlmpXUMeAa7g8S/cEUy19tpo932</span>
</span><span id="__span-238-18"><a id="__codelineno-238-18" name="__codelineno-238-18" href="#__codelineno-238-18"></a><span class="s">/sHoxVJogMVdxBY2V1EjNUPr/6PImesUq0IA1piYXqdxw23kiTgAM01THn6xq9Bn</span>
</span><span id="__span-238-19"><a id="__codelineno-238-19" name="__codelineno-238-19" href="#__codelineno-238-19"></a><span class="s">ef7jKPuD7dVY1V8xMmt9EF1Bh4aTObCotF/6XOnBA6NaxWNq5jJ7dfRVU7Vqh5xa</span>
</span><span id="__span-238-20"><a id="__codelineno-238-20" name="__codelineno-238-20" href="#__codelineno-238-20"></a><span class="s">hyGRglgJw1LmrhwXTHLi6XBZXuwVlAw5HZFEsKsqD/6YqhmTMV7DA3Er/g3Qv1iJ</span>
</span><span id="__span-238-21"><a id="__codelineno-238-21" name="__codelineno-238-21" href="#__codelineno-238-21"></a><span class="s">NmnM5Ftr1huVtwXuETzm0VHIteSWXBV8/c4+COTlQpwVH2mQRcAZQsW8FibQIjP5</span>
</span><span id="__span-238-22"><a id="__codelineno-238-22" name="__codelineno-238-22" href="#__codelineno-238-22"></a><span class="s">k/26D0f5XWdf0u6cLowCmWRWhHrTe0ttUUm5ZcP7xeZNjA==</span>
</span><span id="__span-238-23"><a id="__codelineno-238-23" name="__codelineno-238-23" href="#__codelineno-238-23"></a><span class="gh">-----END CERTIFICATE-----</span>
</span></code></pre></div> <div class="admonition info"> <p class="admonition-title">Info</p> <p>The content of this file will be pasted under <code>additionalTrustBundle</code> tag in the <code>install-config.yaml</code> file.</p> </div> </li> <li> <p>The Image Content Source Policy for the mirrored images</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-239-1"><a id="__codelineno-239-1" name="__codelineno-239-1" href="#__codelineno-239-1"></a>cat /root/oc-mirror-workspace/results-XXXXXX/imageContentSourcePolicy.yaml
</span></code></pre></div> <div class="language-yaml copy highlight"><span class="filename">imageContentSourcePolicy.yaml</span><pre><span></span><code><span id="__span-240-1"><a id="__codelineno-240-1" name="__codelineno-240-1" href="#__codelineno-240-1"></a><span class="nn">---</span>
</span><span id="__span-240-2"><a id="__codelineno-240-2" name="__codelineno-240-2" href="#__codelineno-240-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operator.openshift.io/v1alpha1</span>
</span><span id="__span-240-3"><a id="__codelineno-240-3" name="__codelineno-240-3" href="#__codelineno-240-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ImageContentSourcePolicy</span>
</span><span id="__span-240-4"><a id="__codelineno-240-4" name="__codelineno-240-4" href="#__codelineno-240-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-240-5"><a id="__codelineno-240-5" name="__codelineno-240-5" href="#__codelineno-240-5"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic-0</span>
</span><span id="__span-240-6"><a id="__codelineno-240-6" name="__codelineno-240-6" href="#__codelineno-240-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-240-7"><a id="__codelineno-240-7" name="__codelineno-240-7" href="#__codelineno-240-7"></a><span class="nt">repositoryDigestMirrors</span><span class="p">:</span>
</span><span id="__span-240-8"><a id="__codelineno-240-8" name="__codelineno-240-8" href="#__codelineno-240-8"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-9"><a id="__codelineno-240-9" name="__codelineno-240-9" href="#__codelineno-240-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/ubi8</span>
</span><span id="__span-240-10"><a id="__codelineno-240-10" name="__codelineno-240-10" href="#__codelineno-240-10"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/ubi8</span>
</span><span id="__span-240-11"><a id="__codelineno-240-11" name="__codelineno-240-11" href="#__codelineno-240-11"></a><span class="nn">---</span>
</span><span id="__span-240-12"><a id="__codelineno-240-12" name="__codelineno-240-12" href="#__codelineno-240-12"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operator.openshift.io/v1alpha1</span>
</span><span id="__span-240-13"><a id="__codelineno-240-13" name="__codelineno-240-13" href="#__codelineno-240-13"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ImageContentSourcePolicy</span>
</span><span id="__span-240-14"><a id="__codelineno-240-14" name="__codelineno-240-14" href="#__codelineno-240-14"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-240-15"><a id="__codelineno-240-15" name="__codelineno-240-15" href="#__codelineno-240-15"></a><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-240-16"><a id="__codelineno-240-16" name="__codelineno-240-16" href="#__codelineno-240-16"></a><span class="w">    </span><span class="nt">operators.openshift.org/catalog</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-240-17"><a id="__codelineno-240-17" name="__codelineno-240-17" href="#__codelineno-240-17"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operator-0</span>
</span><span id="__span-240-18"><a id="__codelineno-240-18" name="__codelineno-240-18" href="#__codelineno-240-18"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-240-19"><a id="__codelineno-240-19" name="__codelineno-240-19" href="#__codelineno-240-19"></a><span class="nt">repositoryDigestMirrors</span><span class="p">:</span>
</span><span id="__span-240-20"><a id="__codelineno-240-20" name="__codelineno-240-20" href="#__codelineno-240-20"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-21"><a id="__codelineno-240-21" name="__codelineno-240-21" href="#__codelineno-240-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift-logging</span>
</span><span id="__span-240-22"><a id="__codelineno-240-22" name="__codelineno-240-22" href="#__codelineno-240-22"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/openshift-logging</span>
</span><span id="__span-240-23"><a id="__codelineno-240-23" name="__codelineno-240-23" href="#__codelineno-240-23"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-24"><a id="__codelineno-240-24" name="__codelineno-240-24" href="#__codelineno-240-24"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift-pipelines</span>
</span><span id="__span-240-25"><a id="__codelineno-240-25" name="__codelineno-240-25" href="#__codelineno-240-25"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/openshift-pipelines</span>
</span><span id="__span-240-26"><a id="__codelineno-240-26" name="__codelineno-240-26" href="#__codelineno-240-26"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-27"><a id="__codelineno-240-27" name="__codelineno-240-27" href="#__codelineno-240-27"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/rhel8</span>
</span><span id="__span-240-28"><a id="__codelineno-240-28" name="__codelineno-240-28" href="#__codelineno-240-28"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/rhel8</span>
</span><span id="__span-240-29"><a id="__codelineno-240-29" name="__codelineno-240-29" href="#__codelineno-240-29"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-30"><a id="__codelineno-240-30" name="__codelineno-240-30" href="#__codelineno-240-30"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/ubi8</span>
</span><span id="__span-240-31"><a id="__codelineno-240-31" name="__codelineno-240-31" href="#__codelineno-240-31"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/ubi8</span>
</span><span id="__span-240-32"><a id="__codelineno-240-32" name="__codelineno-240-32" href="#__codelineno-240-32"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-33"><a id="__codelineno-240-33" name="__codelineno-240-33" href="#__codelineno-240-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/redhat</span>
</span><span id="__span-240-34"><a id="__codelineno-240-34" name="__codelineno-240-34" href="#__codelineno-240-34"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/redhat</span>
</span><span id="__span-240-35"><a id="__codelineno-240-35" name="__codelineno-240-35" href="#__codelineno-240-35"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-36"><a id="__codelineno-240-36" name="__codelineno-240-36" href="#__codelineno-240-36"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift-serverless-1</span>
</span><span id="__span-240-37"><a id="__codelineno-240-37" name="__codelineno-240-37" href="#__codelineno-240-37"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/openshift-serverless-1</span>
</span><span id="__span-240-38"><a id="__codelineno-240-38" name="__codelineno-240-38" href="#__codelineno-240-38"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-39"><a id="__codelineno-240-39" name="__codelineno-240-39" href="#__codelineno-240-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/ocp-tools-4-tech-preview</span>
</span><span id="__span-240-40"><a id="__codelineno-240-40" name="__codelineno-240-40" href="#__codelineno-240-40"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/ocp-tools-4-tech-preview</span>
</span><span id="__span-240-41"><a id="__codelineno-240-41" name="__codelineno-240-41" href="#__codelineno-240-41"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-240-42"><a id="__codelineno-240-42" name="__codelineno-240-42" href="#__codelineno-240-42"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift4</span>
</span><span id="__span-240-43"><a id="__codelineno-240-43" name="__codelineno-240-43" href="#__codelineno-240-43"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/openshift4</span>
</span><span id="__span-240-44"><a id="__codelineno-240-44" name="__codelineno-240-44" href="#__codelineno-240-44"></a><span class="nn">---</span>
</span><span id="__span-240-45"><a id="__codelineno-240-45" name="__codelineno-240-45" href="#__codelineno-240-45"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operator.openshift.io/v1alpha1</span>
</span><span id="__span-240-46"><a id="__codelineno-240-46" name="__codelineno-240-46" href="#__codelineno-240-46"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ImageContentSourcePolicy</span>
</span><span id="__span-240-47"><a id="__codelineno-240-47" name="__codelineno-240-47" href="#__codelineno-240-47"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-240-48"><a id="__codelineno-240-48" name="__codelineno-240-48" href="#__codelineno-240-48"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">release-0</span>
</span><span id="__span-240-49"><a id="__codelineno-240-49" name="__codelineno-240-49" href="#__codelineno-240-49"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-240-50"><a id="__codelineno-240-50" name="__codelineno-240-50" href="#__codelineno-240-50"></a><span class="nt">repositoryDigestMirrors</span><span class="p">:</span>
</span><span id="__span-240-51"><a id="__codelineno-240-51" name="__codelineno-240-51" href="#__codelineno-240-51"></a><span class="hll"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span></span><span id="__span-240-52"><a id="__codelineno-240-52" name="__codelineno-240-52" href="#__codelineno-240-52"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift/release</span>
</span></span><span id="__span-240-53"><a id="__codelineno-240-53" name="__codelineno-240-53" href="#__codelineno-240-53"></a><span class="hll"><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-v4.0-art-dev</span>
</span></span><span id="__span-240-54"><a id="__codelineno-240-54" name="__codelineno-240-54" href="#__codelineno-240-54"></a><span class="hll"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span></span><span id="__span-240-55"><a id="__codelineno-240-55" name="__codelineno-240-55" href="#__codelineno-240-55"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift/release-images</span>
</span></span><span id="__span-240-56"><a id="__codelineno-240-56" name="__codelineno-240-56" href="#__codelineno-240-56"></a><span class="hll"><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-release</span>
</span></span></code></pre></div> <div class="admonition info"> <p class="admonition-title">Info</p> <p>The highlighted content will be pasted under <code>imageContentSources</code> tag in the <code>install-config.yaml</code> file.</p> </div> </li> <li> <p>Create the <code>install-config.yaml</code> file:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-241-1"><a id="__codelineno-241-1" name="__codelineno-241-1" href="#__codelineno-241-1"></a>vi install-config.yaml
</span></code></pre></div> </li> <li> <p>Make sure it looks like below:</p> <div class="language-yaml copy highlight"><span class="filename">install-config.yaml</span><pre><span></span><code><span id="__span-242-1"><a id="__codelineno-242-1" name="__codelineno-242-1" href="#__codelineno-242-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-242-2"><a id="__codelineno-242-2" name="__codelineno-242-2" href="#__codelineno-242-2"></a><span class="nt">baseDomain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">platformengineers.xyz</span>
</span><span id="__span-242-3"><a id="__codelineno-242-3" name="__codelineno-242-3" href="#__codelineno-242-3"></a><span class="nt">compute</span><span class="p">:</span>
</span><span id="__span-242-4"><a id="__codelineno-242-4" name="__codelineno-242-4" href="#__codelineno-242-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hyperthreading</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Enabled</span>
</span><span id="__span-242-5"><a id="__codelineno-242-5" name="__codelineno-242-5" href="#__codelineno-242-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker</span>
</span><span id="__span-242-6"><a id="__codelineno-242-6" name="__codelineno-242-6" href="#__codelineno-242-6"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9</span>
</span><span id="__span-242-7"><a id="__codelineno-242-7" name="__codelineno-242-7" href="#__codelineno-242-7"></a><span class="nt">controlPlane</span><span class="p">:</span>
</span><span id="__span-242-8"><a id="__codelineno-242-8" name="__codelineno-242-8" href="#__codelineno-242-8"></a><span class="w">  </span><span class="nt">hyperthreading</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Enabled</span>
</span><span id="__span-242-9"><a id="__codelineno-242-9" name="__codelineno-242-9" href="#__codelineno-242-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
</span><span id="__span-242-10"><a id="__codelineno-242-10" name="__codelineno-242-10" href="#__codelineno-242-10"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-242-11"><a id="__codelineno-242-11" name="__codelineno-242-11" href="#__codelineno-242-11"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-242-12"><a id="__codelineno-242-12" name="__codelineno-242-12" href="#__codelineno-242-12"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ocp4</span>
</span><span id="__span-242-13"><a id="__codelineno-242-13" name="__codelineno-242-13" href="#__codelineno-242-13"></a><span class="nt">networking</span><span class="p">:</span>
</span><span id="__span-242-14"><a id="__codelineno-242-14" name="__codelineno-242-14" href="#__codelineno-242-14"></a><span class="w">  </span><span class="nt">clusterNetworks</span><span class="p">:</span>
</span><span id="__span-242-15"><a id="__codelineno-242-15" name="__codelineno-242-15" href="#__codelineno-242-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9.248.0.0/14</span>
</span><span id="__span-242-16"><a id="__codelineno-242-16" name="__codelineno-242-16" href="#__codelineno-242-16"></a><span class="w">    </span><span class="nt">hostPrefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
</span><span id="__span-242-17"><a id="__codelineno-242-17" name="__codelineno-242-17" href="#__codelineno-242-17"></a><span class="w">  </span><span class="nt">machineNetwork</span><span class="p">:</span>
</span><span id="__span-242-18"><a id="__codelineno-242-18" name="__codelineno-242-18" href="#__codelineno-242-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.252.0/24</span>
</span><span id="__span-242-19"><a id="__codelineno-242-19" name="__codelineno-242-19" href="#__codelineno-242-19"></a><span class="w">  </span><span class="nt">networkType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OVNKubernetes</span>
</span><span id="__span-242-20"><a id="__codelineno-242-20" name="__codelineno-242-20" href="#__codelineno-242-20"></a><span class="w">  </span><span class="nt">serviceNetwork</span><span class="p">:</span>
</span><span id="__span-242-21"><a id="__codelineno-242-21" name="__codelineno-242-21" href="#__codelineno-242-21"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9.31.0.0/16</span>
</span><span id="__span-242-22"><a id="__codelineno-242-22" name="__codelineno-242-22" href="#__codelineno-242-22"></a><span class="nt">platform</span><span class="p">:</span>
</span><span id="__span-242-23"><a id="__codelineno-242-23" name="__codelineno-242-23" href="#__codelineno-242-23"></a><span class="w">  </span><span class="nt">none</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-242-24"><a id="__codelineno-242-24" name="__codelineno-242-24" href="#__codelineno-242-24"></a><span class="nt">fips</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-242-25"><a id="__codelineno-242-25" name="__codelineno-242-25" href="#__codelineno-242-25"></a><span class="hll"><span class="nt">pullSecret</span><span class="p">:</span><span class="w"> </span><span class="s">'{"auths":</span><span class="nv"> </span><span class="s">{"bastion.ocp4.platformengineers.xyz:8443":</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">"auth":</span><span class="nv"> </span><span class="s">"aW5pdDpwYXNzdzByZA==",</span><span class="nv"> </span><span class="s">"email":</span><span class="nv"> </span><span class="s">"you@example.com"}}}'</span>
</span></span><span id="__span-242-26"><a id="__codelineno-242-26" name="__codelineno-242-26" href="#__codelineno-242-26"></a><span class="hll"><span class="nt">sshKey</span><span class="p">:</span><span class="w"> </span><span class="s">'ssh-ed25519</span><span class="nv"> </span><span class="s">AAAAC3NzaC1lZDI1NTE5AAAAICIl3vZvi6eh1SkTE9EWKnZZwG6bVvZZzZzBHuKgbrVW</span><span class="nv"> </span><span class="s">root@bastion.ocp4.platformengineers.xyz'</span>
</span></span><span id="__span-242-27"><a id="__codelineno-242-27" name="__codelineno-242-27" href="#__codelineno-242-27"></a><span class="nt">additionalTrustBundle</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-242-28"><a id="__codelineno-242-28" name="__codelineno-242-28" href="#__codelineno-242-28"></a><span class="w">    </span><span class="no">-----BEGIN CERTIFICATE-----</span>
</span><span id="__span-242-29"><a id="__codelineno-242-29" name="__codelineno-242-29" href="#__codelineno-242-29"></a><span class="w">    </span><span class="no">MIID3jCCAsagAwIBAgIUHj/Ux66Fpoktc/qtzoP6wgWZ2aIwDQYJKoZIhvcNAQEL</span>
</span><span id="__span-242-30"><a id="__codelineno-242-30" name="__codelineno-242-30" href="#__codelineno-242-30"></a><span class="w">    </span><span class="no">BQAwdzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAlZBMREwDwYDVQQHDAhOZXcgWW9y</span>
</span><span id="__span-242-31"><a id="__codelineno-242-31" name="__codelineno-242-31" href="#__codelineno-242-31"></a><span class="w">    </span><span class="no">azENMAsGA1UECgwEUXVheTERMA8GA1UECwwIRGl2aXNpb24xJjAkBgNVBAMMHWJh</span>
</span><span id="__span-242-32"><a id="__codelineno-242-32" name="__codelineno-242-32" href="#__codelineno-242-32"></a><span class="w">    </span><span class="no">c3Rpb24ub2NwNC5jc20tc3BnaS5hY21lLmVzMB4XDTIzMDkyMTE4NDAzM1oXDTI2</span>
</span><span id="__span-242-33"><a id="__codelineno-242-33" name="__codelineno-242-33" href="#__codelineno-242-33"></a><span class="w">    </span><span class="no">MDcxMTE4NDAzM1owdzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAlZBMREwDwYDVQQH</span>
</span><span id="__span-242-34"><a id="__codelineno-242-34" name="__codelineno-242-34" href="#__codelineno-242-34"></a><span class="w">    </span><span class="no">DAhOZXcgWW9yazENMAsGA1UECgwEUXVheTERMA8GA1UECwwIRGl2aXNpb24xJjAk</span>
</span><span id="__span-242-35"><a id="__codelineno-242-35" name="__codelineno-242-35" href="#__codelineno-242-35"></a><span class="w">    </span><span class="no">BgNVBAMMHWJhc3Rpb24ub2NwNC5jc20tc3BnaS5hY21lLmVzMIIBIjANBgkqhkiG</span>
</span><span id="__span-242-36"><a id="__codelineno-242-36" name="__codelineno-242-36" href="#__codelineno-242-36"></a><span class="w">    </span><span class="no">9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv3eDBDh1GH6i+hptdlbMPYztWDsHCihyjRta</span>
</span><span id="__span-242-37"><a id="__codelineno-242-37" name="__codelineno-242-37" href="#__codelineno-242-37"></a><span class="w">    </span><span class="no">WgD3SEyHobuWM/lSepwMC2mmyejZKsv/x4PYFsNrWBwt1oVicP3+sGNuNfKheFgn</span>
</span><span id="__span-242-38"><a id="__codelineno-242-38" name="__codelineno-242-38" href="#__codelineno-242-38"></a><span class="w">    </span><span class="no">LAiXAgt35MLPR7oXZKCb82rb5jFUYWU6Ro2xHv8qxLAAv+BRzq5fDYczvsps3pq0</span>
</span><span id="__span-242-39"><a id="__codelineno-242-39" name="__codelineno-242-39" href="#__codelineno-242-39"></a><span class="w">    </span><span class="no">rvdNLfCORBmtQnoRuKXTmOreQgZqHZkhb1g8P4jE+BJugSAQT4gy1cnP5HXFqpdC</span>
</span><span id="__span-242-40"><a id="__codelineno-242-40" name="__codelineno-242-40" href="#__codelineno-242-40"></a><span class="w">    </span><span class="no">qaehQeQEi+k3yHVdYnMyVC2Ya609SUUeSUxuLrlO2EQTSwLzSZ02sMsIfBKbOgmu</span>
</span><span id="__span-242-41"><a id="__codelineno-242-41" name="__codelineno-242-41" href="#__codelineno-242-41"></a><span class="w">    </span><span class="no">TJPGgd5jqrSu1LDem8YKws8u0MVEhkl3LkuUuOYBbt4kPxoTIwIDAQABo2IwYDAL</span>
</span><span id="__span-242-42"><a id="__codelineno-242-42" name="__codelineno-242-42" href="#__codelineno-242-42"></a><span class="w">    </span><span class="no">BgNVHQ8EBAMCAuQwEwYDVR0lBAwwCgYIKwYBBQUHAwEwKAYDVR0RBCEwH4IdYmFz</span>
</span><span id="__span-242-43"><a id="__codelineno-242-43" name="__codelineno-242-43" href="#__codelineno-242-43"></a><span class="w">    </span><span class="no">dGlvbi5vY3A0LmNzbS1zcGdpLmFjbWUuZXMwEgYDVR0TAQH/BAgwBgEB/wIBATAN</span>
</span><span id="__span-242-44"><a id="__codelineno-242-44" name="__codelineno-242-44" href="#__codelineno-242-44"></a><span class="w">    </span><span class="no">BgkqhkiG9w0BAQsFAAOCAQEAEIanwOhmODUlshlmpXUMeAa7g8S/cEUy19tpo932</span>
</span><span id="__span-242-45"><a id="__codelineno-242-45" name="__codelineno-242-45" href="#__codelineno-242-45"></a><span class="w">    </span><span class="no">/sHoxVJogMVdxBY2V1EjNUPr/6PImesUq0IA1piYXqdxw23kiTgAM01THn6xq9Bn</span>
</span><span id="__span-242-46"><a id="__codelineno-242-46" name="__codelineno-242-46" href="#__codelineno-242-46"></a><span class="w">    </span><span class="no">ef7jKPuD7dVY1V8xMmt9EF1Bh4aTObCotF/6XOnBA6NaxWNq5jJ7dfRVU7Vqh5xa</span>
</span><span id="__span-242-47"><a id="__codelineno-242-47" name="__codelineno-242-47" href="#__codelineno-242-47"></a><span class="w">    </span><span class="no">hyGRglgJw1LmrhwXTHLi6XBZXuwVlAw5HZFEsKsqD/6YqhmTMV7DA3Er/g3Qv1iJ</span>
</span><span id="__span-242-48"><a id="__codelineno-242-48" name="__codelineno-242-48" href="#__codelineno-242-48"></a><span class="w">    </span><span class="no">NmnM5Ftr1huVtwXuETzm0VHIteSWXBV8/c4+COTlQpwVH2mQRcAZQsW8FibQIjP5</span>
</span><span id="__span-242-49"><a id="__codelineno-242-49" name="__codelineno-242-49" href="#__codelineno-242-49"></a><span class="w">    </span><span class="no">k/26D0f5XWdf0u6cLowCmWRWhHrTe0ttUUm5ZcP7xeZNjA==</span>
</span><span id="__span-242-50"><a id="__codelineno-242-50" name="__codelineno-242-50" href="#__codelineno-242-50"></a><span class="w">    </span><span class="no">-----END CERTIFICATE-----</span>
</span><span id="__span-242-51"><a id="__codelineno-242-51" name="__codelineno-242-51" href="#__codelineno-242-51"></a><span class="nt">imageContentSources</span><span class="p">:</span>
</span><span id="__span-242-52"><a id="__codelineno-242-52" name="__codelineno-242-52" href="#__codelineno-242-52"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-242-53"><a id="__codelineno-242-53" name="__codelineno-242-53" href="#__codelineno-242-53"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift/release</span>
</span><span id="__span-242-54"><a id="__codelineno-242-54" name="__codelineno-242-54" href="#__codelineno-242-54"></a><span class="w">  </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-v4.0-art-dev</span>
</span><span id="__span-242-55"><a id="__codelineno-242-55" name="__codelineno-242-55" href="#__codelineno-242-55"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mirrors</span><span class="p">:</span>
</span><span id="__span-242-56"><a id="__codelineno-242-56" name="__codelineno-242-56" href="#__codelineno-242-56"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bastion.ocp4.platformengineers.xyz:8443/openshift/release-images</span>
</span><span id="__span-242-57"><a id="__codelineno-242-57" name="__codelineno-242-57" href="#__codelineno-242-57"></a><span class="w">  </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/openshift-release-dev/ocp-release</span>
</span></code></pre></div> <div class="admonition warning"> <p class="admonition-title">Important</p> <p>Remember the <code>additionalTrusBundle</code> and <code>imageContentSources</code> sections come from the data output in the steps above.</p> </div> <p>The highlighted content on the <code>pullSecret</code> tag is the base64-encoded username and password obtained on the <a href="#22-create-the-private-image-registry-in-the-offline-bastion">Create the private image registry in the offline bastion</a> section when we ran the <code>mirror-registry install</code> command.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-243-1"><a id="__codelineno-243-1" name="__codelineno-243-1" href="#__codelineno-243-1"></a>echo -n 'init:passw0rd' | base64 -w0
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-244-1"><a id="__codelineno-244-1" name="__codelineno-244-1" href="#__codelineno-244-1"></a>aW5pdDpwYXNzdzByZA==
</span></code></pre></div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>If you used the default <code>passw0rd</code> when installing your Quay private image registry, the <code>pullSecret</code> value in the <code>instal-config.yaml</code> above will be exactly the same value you need to use.</p> </div> <p>The content for the <code>sshKey</code> tag is the output of:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-245-1"><a id="__codelineno-245-1" name="__codelineno-245-1" href="#__codelineno-245-1"></a>cat /root/.ssh/id_ed25519.pub
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-246-1"><a id="__codelineno-246-1" name="__codelineno-246-1" href="#__codelineno-246-1"></a>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICIl3vZvi6eh1SkTE9EWKnZZwG6bVvZZzZzBHuKgbrVW root@bastion.ocp4.platformengineers.xyz
</span></code></pre></div> </li> <li> <p>Create a copy of the <code>install-config.yaml</code> file in another directory, as it is automatically deleted in the following steps:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-247-1"><a id="__codelineno-247-1" name="__codelineno-247-1" href="#__codelineno-247-1"></a>cp install-config.yaml ../install-config.yaml
</span></code></pre></div> </li> </ol> <h2 id="31-create-the-openshift-manifests-and-ignition-files">31. Create the OpenShift Manifests and Ignition files<a class="headerlink" href="#31-create-the-openshift-manifests-and-ignition-files" title="Permanent link">¶</a></h2> <ol> <li> <p>Create the OpenShift manifest files</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-248-1"><a id="__codelineno-248-1" name="__codelineno-248-1" href="#__codelineno-248-1"></a>openshift-install create manifests --dir /root/registry/downloads/tools/ocp4
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-249-1"><a id="__codelineno-249-1" name="__codelineno-249-1" href="#__codelineno-249-1"></a>INFO Consuming Install Config from target directory
</span><span id="__span-249-2"><a id="__codelineno-249-2" name="__codelineno-249-2" href="#__codelineno-249-2"></a>INFO Manifests created in: /root/registry/downloads/tools/ocp4/manifests and /root/registry/downloads/tools/ocp4/openshift
</span></code></pre></div> </li> <li> <p>In order to create the ignition files, install butane in the bastion node:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-250-1"><a id="__codelineno-250-1" name="__codelineno-250-1" href="#__codelineno-250-1"></a>cd /root/registry/downloads/tools/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-251-1"><a id="__codelineno-251-1" name="__codelineno-251-1" href="#__codelineno-251-1"></a>chmod u+x butane
</span><span id="__span-251-2"><a id="__codelineno-251-2" name="__codelineno-251-2" href="#__codelineno-251-2"></a>cp butane /usr/local/bin/butane
</span><span id="__span-251-3"><a id="__codelineno-251-3" name="__codelineno-251-3" href="#__codelineno-251-3"></a>butane -V
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-252-1"><a id="__codelineno-252-1" name="__codelineno-252-1" href="#__codelineno-252-1"></a>Butane 0.18.0
</span></code></pre></div> </li> </ol> <p>Create two butane files for the master and worker nodes. In these files, you set the chrony configuration for master and worker nodes.</p> <p><strong>99-worker-chrony-conf-override.bu</strong></p> <ol> <li> <p>Create the <code>99-worker-chrony-conf-override.bu</code> file</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-253-1"><a id="__codelineno-253-1" name="__codelineno-253-1" href="#__codelineno-253-1"></a>vi 99-worker-chrony-conf-override.bu
</span></code></pre></div> </li> <li> <p>Make sure it looks like below</p> <div class="language-yaml copy highlight"><span class="filename">99-worker-chrony-conf-override.bu</span><pre><span></span><code><span id="__span-254-1"><a id="__codelineno-254-1" name="__codelineno-254-1" href="#__codelineno-254-1"></a><span class="nt">variant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openshift</span>
</span><span id="__span-254-2"><a id="__codelineno-254-2" name="__codelineno-254-2" href="#__codelineno-254-2"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.16.0</span>
</span><span id="__span-254-3"><a id="__codelineno-254-3" name="__codelineno-254-3" href="#__codelineno-254-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-254-4"><a id="__codelineno-254-4" name="__codelineno-254-4" href="#__codelineno-254-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">99-worker-chrony-conf-override</span>
</span><span id="__span-254-5"><a id="__codelineno-254-5" name="__codelineno-254-5" href="#__codelineno-254-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-254-6"><a id="__codelineno-254-6" name="__codelineno-254-6" href="#__codelineno-254-6"></a><span class="w">    </span><span class="nt">machineconfiguration.openshift.io/role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker</span>
</span><span id="__span-254-7"><a id="__codelineno-254-7" name="__codelineno-254-7" href="#__codelineno-254-7"></a><span class="nt">storage</span><span class="p">:</span>
</span><span id="__span-254-8"><a id="__codelineno-254-8" name="__codelineno-254-8" href="#__codelineno-254-8"></a><span class="w">  </span><span class="nt">files</span><span class="p">:</span>
</span><span id="__span-254-9"><a id="__codelineno-254-9" name="__codelineno-254-9" href="#__codelineno-254-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/chrony.conf</span>
</span><span id="__span-254-10"><a id="__codelineno-254-10" name="__codelineno-254-10" href="#__codelineno-254-10"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0644</span>
</span><span id="__span-254-11"><a id="__codelineno-254-11" name="__codelineno-254-11" href="#__codelineno-254-11"></a><span class="w">      </span><span class="nt">overwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-254-12"><a id="__codelineno-254-12" name="__codelineno-254-12" href="#__codelineno-254-12"></a><span class="w">      </span><span class="nt">contents</span><span class="p">:</span>
</span><span id="__span-254-13"><a id="__codelineno-254-13" name="__codelineno-254-13" href="#__codelineno-254-13"></a><span class="w">        </span><span class="nt">inline</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-254-14"><a id="__codelineno-254-14" name="__codelineno-254-14" href="#__codelineno-254-14"></a><span class="w">          </span><span class="no"># The Machine Config Operator manages this file.</span>
</span><span id="__span-254-15"><a id="__codelineno-254-15" name="__codelineno-254-15" href="#__codelineno-254-15"></a><span class="w">          </span><span class="no">server controlplane01.ocp4.platformengineers.xyz iburst</span>
</span><span id="__span-254-16"><a id="__codelineno-254-16" name="__codelineno-254-16" href="#__codelineno-254-16"></a><span class="w">          </span><span class="no">server controlplane02.ocp4.platformengineers.xyz iburst</span>
</span><span id="__span-254-17"><a id="__codelineno-254-17" name="__codelineno-254-17" href="#__codelineno-254-17"></a><span class="w">          </span><span class="no">server controlplane03.ocp4.platformengineers.xyz iburst</span>
</span><span id="__span-254-18"><a id="__codelineno-254-18" name="__codelineno-254-18" href="#__codelineno-254-18"></a>
</span><span id="__span-254-19"><a id="__codelineno-254-19" name="__codelineno-254-19" href="#__codelineno-254-19"></a><span class="w">          </span><span class="no">stratumweight 0</span>
</span><span id="__span-254-20"><a id="__codelineno-254-20" name="__codelineno-254-20" href="#__codelineno-254-20"></a><span class="w">          </span><span class="no">driftfile /var/lib/chrony/drift</span>
</span><span id="__span-254-21"><a id="__codelineno-254-21" name="__codelineno-254-21" href="#__codelineno-254-21"></a><span class="w">          </span><span class="no">rtcsync</span>
</span><span id="__span-254-22"><a id="__codelineno-254-22" name="__codelineno-254-22" href="#__codelineno-254-22"></a><span class="w">          </span><span class="no">makestep 10 3</span>
</span><span id="__span-254-23"><a id="__codelineno-254-23" name="__codelineno-254-23" href="#__codelineno-254-23"></a><span class="w">          </span><span class="no">bindcmdaddress 127.0.0.1</span>
</span><span id="__span-254-24"><a id="__codelineno-254-24" name="__codelineno-254-24" href="#__codelineno-254-24"></a><span class="w">          </span><span class="no">bindcmdaddress ::1</span>
</span><span id="__span-254-25"><a id="__codelineno-254-25" name="__codelineno-254-25" href="#__codelineno-254-25"></a><span class="w">          </span><span class="no">keyfile /etc/chrony.keys</span>
</span><span id="__span-254-26"><a id="__codelineno-254-26" name="__codelineno-254-26" href="#__codelineno-254-26"></a><span class="w">          </span><span class="no">commandkey 1</span>
</span><span id="__span-254-27"><a id="__codelineno-254-27" name="__codelineno-254-27" href="#__codelineno-254-27"></a><span class="w">          </span><span class="no">generatecommandkey</span>
</span><span id="__span-254-28"><a id="__codelineno-254-28" name="__codelineno-254-28" href="#__codelineno-254-28"></a><span class="w">          </span><span class="no">noclientlog</span>
</span><span id="__span-254-29"><a id="__codelineno-254-29" name="__codelineno-254-29" href="#__codelineno-254-29"></a><span class="w">          </span><span class="no">logchange 0.5</span>
</span><span id="__span-254-30"><a id="__codelineno-254-30" name="__codelineno-254-30" href="#__codelineno-254-30"></a><span class="w">          </span><span class="no">logdir /var/log/chrony</span>
</span></code></pre></div> </li> </ol> <p><strong>99-master-chrony-conf-override.bu</strong></p> <ol> <li> <p>Create the <code>99-master-chrony-conf-override.bu</code> file</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-255-1"><a id="__codelineno-255-1" name="__codelineno-255-1" href="#__codelineno-255-1"></a>vi 99-master-chrony-conf-override.bu
</span></code></pre></div> </li> <li> <p>Make sure it looks like below</p> <div class="language-yaml copy highlight"><span class="filename">99-master-chrony-conf-override.bu</span><pre><span></span><code><span id="__span-256-1"><a id="__codelineno-256-1" name="__codelineno-256-1" href="#__codelineno-256-1"></a><span class="nt">variant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openshift</span>
</span><span id="__span-256-2"><a id="__codelineno-256-2" name="__codelineno-256-2" href="#__codelineno-256-2"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.16.0</span>
</span><span id="__span-256-3"><a id="__codelineno-256-3" name="__codelineno-256-3" href="#__codelineno-256-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-256-4"><a id="__codelineno-256-4" name="__codelineno-256-4" href="#__codelineno-256-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">99-master-chrony-conf-override</span>
</span><span id="__span-256-5"><a id="__codelineno-256-5" name="__codelineno-256-5" href="#__codelineno-256-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-256-6"><a id="__codelineno-256-6" name="__codelineno-256-6" href="#__codelineno-256-6"></a><span class="w">    </span><span class="nt">machineconfiguration.openshift.io/role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
</span><span id="__span-256-7"><a id="__codelineno-256-7" name="__codelineno-256-7" href="#__codelineno-256-7"></a><span class="nt">storage</span><span class="p">:</span>
</span><span id="__span-256-8"><a id="__codelineno-256-8" name="__codelineno-256-8" href="#__codelineno-256-8"></a><span class="w">  </span><span class="nt">files</span><span class="p">:</span>
</span><span id="__span-256-9"><a id="__codelineno-256-9" name="__codelineno-256-9" href="#__codelineno-256-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/chrony.conf</span>
</span><span id="__span-256-10"><a id="__codelineno-256-10" name="__codelineno-256-10" href="#__codelineno-256-10"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0644</span>
</span><span id="__span-256-11"><a id="__codelineno-256-11" name="__codelineno-256-11" href="#__codelineno-256-11"></a><span class="w">      </span><span class="nt">overwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-256-12"><a id="__codelineno-256-12" name="__codelineno-256-12" href="#__codelineno-256-12"></a><span class="w">      </span><span class="nt">contents</span><span class="p">:</span>
</span><span id="__span-256-13"><a id="__codelineno-256-13" name="__codelineno-256-13" href="#__codelineno-256-13"></a><span class="w">        </span><span class="nt">inline</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-256-14"><a id="__codelineno-256-14" name="__codelineno-256-14" href="#__codelineno-256-14"></a><span class="w">          </span><span class="no"># Use public servers from the pool.ntp.org project.</span>
</span><span id="__span-256-15"><a id="__codelineno-256-15" name="__codelineno-256-15" href="#__codelineno-256-15"></a><span class="w">          </span><span class="no"># Please consider joining the pool (https://www.pool.ntp.org/join.html).</span>
</span><span id="__span-256-16"><a id="__codelineno-256-16" name="__codelineno-256-16" href="#__codelineno-256-16"></a>
</span><span id="__span-256-17"><a id="__codelineno-256-17" name="__codelineno-256-17" href="#__codelineno-256-17"></a><span class="w">          </span><span class="no"># The Machine Config Operator manages this file</span>
</span><span id="__span-256-18"><a id="__codelineno-256-18" name="__codelineno-256-18" href="#__codelineno-256-18"></a><span class="w">          </span><span class="no">server controlplane01.ocp4.platformengineers.xyz iburst</span>
</span><span id="__span-256-19"><a id="__codelineno-256-19" name="__codelineno-256-19" href="#__codelineno-256-19"></a><span class="w">          </span><span class="no">server controlplane02.ocp4.platformengineers.xyz iburst</span>
</span><span id="__span-256-20"><a id="__codelineno-256-20" name="__codelineno-256-20" href="#__codelineno-256-20"></a><span class="w">          </span><span class="no">server controlplane03.ocp4.platformengineers.xyz iburst</span>
</span><span id="__span-256-21"><a id="__codelineno-256-21" name="__codelineno-256-21" href="#__codelineno-256-21"></a>
</span><span id="__span-256-22"><a id="__codelineno-256-22" name="__codelineno-256-22" href="#__codelineno-256-22"></a><span class="w">          </span><span class="no">stratumweight 0</span>
</span><span id="__span-256-23"><a id="__codelineno-256-23" name="__codelineno-256-23" href="#__codelineno-256-23"></a><span class="w">          </span><span class="no">driftfile /var/lib/chrony/drift</span>
</span><span id="__span-256-24"><a id="__codelineno-256-24" name="__codelineno-256-24" href="#__codelineno-256-24"></a><span class="w">          </span><span class="no">rtcsync</span>
</span><span id="__span-256-25"><a id="__codelineno-256-25" name="__codelineno-256-25" href="#__codelineno-256-25"></a><span class="w">          </span><span class="no">makestep 10 3</span>
</span><span id="__span-256-26"><a id="__codelineno-256-26" name="__codelineno-256-26" href="#__codelineno-256-26"></a><span class="w">          </span><span class="no">bindcmdaddress 127.0.0.1</span>
</span><span id="__span-256-27"><a id="__codelineno-256-27" name="__codelineno-256-27" href="#__codelineno-256-27"></a><span class="w">          </span><span class="no">bindcmdaddress ::1</span>
</span><span id="__span-256-28"><a id="__codelineno-256-28" name="__codelineno-256-28" href="#__codelineno-256-28"></a><span class="w">          </span><span class="no">keyfile /etc/chrony.keys</span>
</span><span id="__span-256-29"><a id="__codelineno-256-29" name="__codelineno-256-29" href="#__codelineno-256-29"></a><span class="w">          </span><span class="no">commandkey 1</span>
</span><span id="__span-256-30"><a id="__codelineno-256-30" name="__codelineno-256-30" href="#__codelineno-256-30"></a><span class="w">          </span><span class="no">generatecommandkey</span>
</span><span id="__span-256-31"><a id="__codelineno-256-31" name="__codelineno-256-31" href="#__codelineno-256-31"></a><span class="w">          </span><span class="no">noclientlog</span>
</span><span id="__span-256-32"><a id="__codelineno-256-32" name="__codelineno-256-32" href="#__codelineno-256-32"></a><span class="w">          </span><span class="no">logchange 0.5</span>
</span><span id="__span-256-33"><a id="__codelineno-256-33" name="__codelineno-256-33" href="#__codelineno-256-33"></a><span class="w">          </span><span class="no">logdir /var/log/chrony</span>
</span><span id="__span-256-34"><a id="__codelineno-256-34" name="__codelineno-256-34" href="#__codelineno-256-34"></a>
</span><span id="__span-256-35"><a id="__codelineno-256-35" name="__codelineno-256-35" href="#__codelineno-256-35"></a><span class="w">          </span><span class="no"># Configure the control plane nodes to serve as local NTP servers</span>
</span><span id="__span-256-36"><a id="__codelineno-256-36" name="__codelineno-256-36" href="#__codelineno-256-36"></a><span class="w">          </span><span class="no"># for all worker nodes, even if they are not in sync with an</span>
</span><span id="__span-256-37"><a id="__codelineno-256-37" name="__codelineno-256-37" href="#__codelineno-256-37"></a><span class="w">          </span><span class="no"># upstream NTP server.</span>
</span><span id="__span-256-38"><a id="__codelineno-256-38" name="__codelineno-256-38" href="#__codelineno-256-38"></a>
</span><span id="__span-256-39"><a id="__codelineno-256-39" name="__codelineno-256-39" href="#__codelineno-256-39"></a><span class="w">          </span><span class="no"># Allow NTP client access from the local network.</span>
</span><span id="__span-256-40"><a id="__codelineno-256-40" name="__codelineno-256-40" href="#__codelineno-256-40"></a><span class="w">          </span><span class="no">allow all</span>
</span><span id="__span-256-41"><a id="__codelineno-256-41" name="__codelineno-256-41" href="#__codelineno-256-41"></a><span class="w">          </span><span class="no"># Serve time even if not synchronized to a time source.</span>
</span><span id="__span-256-42"><a id="__codelineno-256-42" name="__codelineno-256-42" href="#__codelineno-256-42"></a><span class="w">          </span><span class="no">local stratum 3 orphan</span>
</span></code></pre></div> </li> <li> <p>Generate the yaml files with butane:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-257-1"><a id="__codelineno-257-1" name="__codelineno-257-1" href="#__codelineno-257-1"></a>butane 99-worker-chrony-conf-override.bu -o 99-worker-chrony-conf-override.yaml
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-258-1"><a id="__codelineno-258-1" name="__codelineno-258-1" href="#__codelineno-258-1"></a>butane 99-master-chrony-conf-override.bu -o 99-master-chrony-conf-override.yaml
</span></code></pre></div> </li> <li> <p>Copy them to the installation directory:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-259-1"><a id="__codelineno-259-1" name="__codelineno-259-1" href="#__codelineno-259-1"></a>cp 99-*.yaml /root/registry/downloads/tools/ocp4/manifests/
</span></code></pre></div> </li> <li> <p>Make a copy of the installation directory:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-260-1"><a id="__codelineno-260-1" name="__codelineno-260-1" href="#__codelineno-260-1"></a>cp -r ocp4 ocp4_backup
</span></code></pre></div> </li> <li> <p>Create the ignition files:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-261-1"><a id="__codelineno-261-1" name="__codelineno-261-1" href="#__codelineno-261-1"></a>openshift-install create ignition-configs --dir /root/registry/downloads/tools/ocp4/
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-262-1"><a id="__codelineno-262-1" name="__codelineno-262-1" href="#__codelineno-262-1"></a>INFO Consuming Common Manifests from target directory
</span><span id="__span-262-2"><a id="__codelineno-262-2" name="__codelineno-262-2" href="#__codelineno-262-2"></a>INFO Consuming OpenShift Install (Manifests) from target directory
</span><span id="__span-262-3"><a id="__codelineno-262-3" name="__codelineno-262-3" href="#__codelineno-262-3"></a>INFO Consuming Master Machines from target directory
</span><span id="__span-262-4"><a id="__codelineno-262-4" name="__codelineno-262-4" href="#__codelineno-262-4"></a>INFO Consuming Openshift Manifests from target directory
</span><span id="__span-262-5"><a id="__codelineno-262-5" name="__codelineno-262-5" href="#__codelineno-262-5"></a>INFO Consuming Worker Machines from target directory
</span><span id="__span-262-6"><a id="__codelineno-262-6" name="__codelineno-262-6" href="#__codelineno-262-6"></a>INFO Ignition-Configs created in: /root/registry/downloads/tools/ocp4 and /root/registry/downloads/tools/ocp4/auth
</span></code></pre></div> </li> <li> <p>Provide read and execute permissions for other users and groups to the ignition files:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-263-1"><a id="__codelineno-263-1" name="__codelineno-263-1" href="#__codelineno-263-1"></a>chmod 755 /root/registry/downloads/tools/ocp4/*.ign
</span></code></pre></div> </li> <li> <p>Copy the ignition files to the serving path of the HTTP Server we installed on the <a href="#26-install-the-http-server-in-the-offline-bastion">Install the http server in the offline bastion</a> section before.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-264-1"><a id="__codelineno-264-1" name="__codelineno-264-1" href="#__codelineno-264-1"></a>cp /root/registry/downloads/tools/ocp4/*.ign /var/www/html/ign/
</span><span id="__span-264-2"><a id="__codelineno-264-2" name="__codelineno-264-2" href="#__codelineno-264-2"></a>ll /var/www/html/ign/
</span></code></pre></div> <div class="language-sh no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-265-1"><a id="__codelineno-265-1" name="__codelineno-265-1" href="#__codelineno-265-1"></a>total<span class="w"> </span><span class="m">288</span>
</span><span id="__span-265-2"><a id="__codelineno-265-2" name="__codelineno-265-2" href="#__codelineno-265-2"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">284065</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">05</span>:19<span class="w"> </span>bootstrap.ign
</span><span id="__span-265-3"><a id="__codelineno-265-3" name="__codelineno-265-3" href="#__codelineno-265-3"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">1723</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">05</span>:19<span class="w"> </span>master.ign
</span><span id="__span-265-4"><a id="__codelineno-265-4" name="__codelineno-265-4" href="#__codelineno-265-4"></a>-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">1723</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">05</span>:19<span class="w"> </span>worker.ign
</span></code></pre></div> </li> <li> <p>It is recommended to back the directory <code>ocp4/auth</code> up, because it contains the certificates and key of the initial user and administrator of OpenShift: the user <strong>kubeadmin</strong>.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion tools]</span><pre><span></span><code><span id="__span-266-1"><a id="__codelineno-266-1" name="__codelineno-266-1" href="#__codelineno-266-1"></a>cp -r /root/registry/downloads/tools/ocp4/auth/ /root/registry/downloads/tools/ocp4_auth/
</span></code></pre></div> </li> </ol> <h2 id="32-deploy-the-openshift-cluster">32. Deploy the OpenShift cluster<a class="headerlink" href="#32-deploy-the-openshift-cluster" title="Permanent link">¶</a></h2> <p>In order to get our OpenShift cluster deployed, we first need to start up the bootstrap node that will operate as a temporary control plane for the Control Plane nodes to join later.</p> <h3 id="321-control-plane-nodes">32.1. Control Plane Nodes<a class="headerlink" href="#321-control-plane-nodes" title="Permanent link">¶</a></h3> <ol> <li> <p>In your vCenter, start up the <strong>bootstrap node</strong>. Open the web console for this node in the vCenter so that you can interact with the ISO bootup menu. Remember, this is the bootup menu we have baked into the ISO with the ISO maker from the previous section. Select the bootstrap option from the bootup menu:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/40.png" data-desc-position="bottom"><img alt="40" src="../images/airgap-4-12/40.png" style="max-height:250px"></a></p> <p>Once the specific bootstrap configuration has been loaded on the machine, you should see the following login screen:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-16/41.png" data-desc-position="bottom"><img alt="41" src="../images/airgap-4-16/41.png" style="max-height:250px"></a></p> </li> </ol> <p>At this point, that temporary control plane node for the rest of the Contol Plane nodes to join has been created and started so that you can you can start the <strong>control machines</strong>.</p> <div class="admonition warning"> <p class="admonition-title">Important</p> <p>Remember to select the appropriate bootup option for the machine you will be starting up on the following steps.</p> </div> <ol> <li> <p>Start the <strong>controlplane01</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/42.png" data-desc-position="bottom"><img alt="42" src="../images/airgap-4-12/42.png" style="max-height:250px"></a></p> <p>Make sure it starts up properly:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-16/45.png" data-desc-position="bottom"><img alt="45" src="../images/airgap-4-16/45.png" style="max-height:200px"></a></p> </li> <li> <p>Start the <strong>controlplane02</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/43.png" data-desc-position="bottom"><img alt="43" src="../images/airgap-4-12/43.png" style="max-height:250px"></a></p> <p>Make sure it starts up properly:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-16/46.png" data-desc-position="bottom"><img alt="46" src="../images/airgap-4-16/46.png" style="max-height:200px"></a></p> </li> <li> <p>Start the <strong>controlplane03</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/44.png" data-desc-position="bottom"><img alt="44" src="../images/airgap-4-12/44.png" style="max-height:250px"></a></p> <p>Make sure it starts up properly:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-16/47.png" data-desc-position="bottom"><img alt="47" src="../images/airgap-4-16/47.png" style="max-height:200px"></a></p> </li> <li> <p>Access the offline bastion:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-267-1"><a id="__codelineno-267-1" name="__codelineno-267-1" href="#__codelineno-267-1"></a>ssh root@192.168.252.23
</span></code></pre></div> </li> <li> <p>Go to <code>/root/registry/downloads/</code> to kick off the wait for the bootstrap to complete command:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-268-1"><a id="__codelineno-268-1" name="__codelineno-268-1" href="#__codelineno-268-1"></a>cd /root/registry/downloads/
</span></code></pre></div> </li> <li> <p>Kick off the wait for the bootstrap to complete command:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-269-1"><a id="__codelineno-269-1" name="__codelineno-269-1" href="#__codelineno-269-1"></a>openshift-install wait-for bootstrap-complete --dir=/root/registry/downloads/tools/ocp4 --log-level=debug
</span></code></pre></div> <p>If the bootstrap of the control plane nodes for your OpenShift cluster has completed correctly, you should see the following ouput:</p> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-270-1"><a id="__codelineno-270-1" name="__codelineno-270-1" href="#__codelineno-270-1"></a>DEBUG OpenShift Installer 4.16.9
</span><span id="__span-270-2"><a id="__codelineno-270-2" name="__codelineno-270-2" href="#__codelineno-270-2"></a>DEBUG Built from commit 194f806390b2b20668f5ac32d7918f9773b29a5e
</span><span id="__span-270-3"><a id="__codelineno-270-3" name="__codelineno-270-3" href="#__codelineno-270-3"></a>INFO Waiting up to 20m0s (until 9:53AM) for the Kubernetes API at https://api.ocp4.platformengineers.xyz:6443...
</span><span id="__span-270-4"><a id="__codelineno-270-4" name="__codelineno-270-4" href="#__codelineno-270-4"></a>DEBUG Loading Agent Config...
</span><span id="__span-270-5"><a id="__codelineno-270-5" name="__codelineno-270-5" href="#__codelineno-270-5"></a>INFO API v1.25.11+1485cc9 up
</span><span id="__span-270-6"><a id="__codelineno-270-6" name="__codelineno-270-6" href="#__codelineno-270-6"></a>DEBUG Loading Install Config...
</span><span id="__span-270-7"><a id="__codelineno-270-7" name="__codelineno-270-7" href="#__codelineno-270-7"></a>DEBUG   Loading SSH Key...
</span><span id="__span-270-8"><a id="__codelineno-270-8" name="__codelineno-270-8" href="#__codelineno-270-8"></a>DEBUG   Loading Base Domain...
</span><span id="__span-270-9"><a id="__codelineno-270-9" name="__codelineno-270-9" href="#__codelineno-270-9"></a>DEBUG     Loading Platform...
</span><span id="__span-270-10"><a id="__codelineno-270-10" name="__codelineno-270-10" href="#__codelineno-270-10"></a>DEBUG   Loading Cluster Name...
</span><span id="__span-270-11"><a id="__codelineno-270-11" name="__codelineno-270-11" href="#__codelineno-270-11"></a>DEBUG     Loading Base Domain...
</span><span id="__span-270-12"><a id="__codelineno-270-12" name="__codelineno-270-12" href="#__codelineno-270-12"></a>DEBUG     Loading Platform...
</span><span id="__span-270-13"><a id="__codelineno-270-13" name="__codelineno-270-13" href="#__codelineno-270-13"></a>DEBUG   Loading Networking...
</span><span id="__span-270-14"><a id="__codelineno-270-14" name="__codelineno-270-14" href="#__codelineno-270-14"></a>DEBUG     Loading Platform...
</span><span id="__span-270-15"><a id="__codelineno-270-15" name="__codelineno-270-15" href="#__codelineno-270-15"></a>DEBUG   Loading Pull Secret...
</span><span id="__span-270-16"><a id="__codelineno-270-16" name="__codelineno-270-16" href="#__codelineno-270-16"></a>DEBUG   Loading Platform...
</span><span id="__span-270-17"><a id="__codelineno-270-17" name="__codelineno-270-17" href="#__codelineno-270-17"></a>DEBUG Using Install Config loaded from state file
</span><span id="__span-270-18"><a id="__codelineno-270-18" name="__codelineno-270-18" href="#__codelineno-270-18"></a>INFO Waiting up to 30m0s (until 10:03AM) for bootstrapping to complete...
</span><span id="__span-270-19"><a id="__codelineno-270-19" name="__codelineno-270-19" href="#__codelineno-270-19"></a><span class="hll">DEBUG Bootstrap status: complete
</span></span><span id="__span-270-20"><a id="__codelineno-270-20" name="__codelineno-270-20" href="#__codelineno-270-20"></a><span class="hll">INFO It is now safe to remove the bootstrap resources
</span></span><span id="__span-270-21"><a id="__codelineno-270-21" name="__codelineno-270-21" href="#__codelineno-270-21"></a>DEBUG Time elapsed per stage:
</span><span id="__span-270-22"><a id="__codelineno-270-22" name="__codelineno-270-22" href="#__codelineno-270-22"></a>DEBUG Bootstrap Complete: 1m48s
</span><span id="__span-270-23"><a id="__codelineno-270-23" name="__codelineno-270-23" href="#__codelineno-270-23"></a>INFO Time elapsed: 1m48s
</span></code></pre></div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>If the previous command <strong>fails or takes too long</strong>, you can do the following to troubleshoot/debug:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-271-1"><a id="__codelineno-271-1" name="__codelineno-271-1" href="#__codelineno-271-1"></a>ssh core@bootstrap.ocp4.platformengineers.xyz
</span></code></pre></div> <p>Once inside the bootstrap machine, execute the following command to see if there are any errors that ocurred during the installation.</p> <div class="language-text copy highlight"><span class="filename">[core@bootstrap ~]</span><pre><span></span><code><span id="__span-272-1"><a id="__codelineno-272-1" name="__codelineno-272-1" href="#__codelineno-272-1"></a>journalctl -f
</span></code></pre></div> </div> </li> <li> <p>At this point, we can stop the <strong>bootstrap</strong> machine and delete it from the vCenter as it will no longer be used during installation.</p> </li> <li> <p>Execute the following command to be able to use oc commands as an administrator against the control plane of your OpenShift cluster:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-273-1"><a id="__codelineno-273-1" name="__codelineno-273-1" href="#__codelineno-273-1"></a>export KUBECONFIG=/root/registry/downloads/tools/ocp4/auth/kubeconfig
</span></code></pre></div> </li> <li> <p>Execute the following command that should output what user are you authenticated as by using the above <code>kubeconfig</code> credentials file.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-274-1"><a id="__codelineno-274-1" name="__codelineno-274-1" href="#__codelineno-274-1"></a>oc whoami
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-275-1"><a id="__codelineno-275-1" name="__codelineno-275-1" href="#__codelineno-275-1"></a>system:admin
</span></code></pre></div> </li> <li> <p>Get the nodes of your OpenShift cluster</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-276-1"><a id="__codelineno-276-1" name="__codelineno-276-1" href="#__codelineno-276-1"></a>oc get nodes
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-277-1"><a id="__codelineno-277-1" name="__codelineno-277-1" href="#__codelineno-277-1"></a>NAME                             STATUS   ROLES                  AGE     VERSION
</span><span id="__span-277-2"><a id="__codelineno-277-2" name="__codelineno-277-2" href="#__codelineno-277-2"></a>controlplane01.ocp4.platformengineers.xyz   Ready    control-plane,master   25m     v1.29.7+4510e9c
</span><span id="__span-277-3"><a id="__codelineno-277-3" name="__codelineno-277-3" href="#__codelineno-277-3"></a>controlplane02.ocp4.platformengineers.xyz   Ready    control-plane,master   19m     v1.29.7+4510e9c
</span><span id="__span-277-4"><a id="__codelineno-277-4" name="__codelineno-277-4" href="#__codelineno-277-4"></a>controlplane03.ocp4.platformengineers.xyz   Ready    control-plane,master   7m41s   v1.29.7+4510e9c
</span></code></pre></div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Control Plane nodes must appear in <strong>Ready</strong> state.</p> </div> </li> </ol> <h3 id="322-compute-nodes">32.2. Compute Nodes<a class="headerlink" href="#322-compute-nodes" title="Permanent link">¶</a></h3> <p>Once the control plane nodes are ready, we can start all the compute machines, including the infra and storage machines, and to do this, again, make sure you select the appropriate option on the bootup menu:</p> <ol> <li> <p>Start the <strong>compute01</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/48.png" data-desc-position="bottom"><img alt="48" src="../images/airgap-4-12/48.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>compute02</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/49.png" data-desc-position="bottom"><img alt="49" src="../images/airgap-4-12/49.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>compute03</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/50.png" data-desc-position="bottom"><img alt="50" src="../images/airgap-4-12/50.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>infra01</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/51.png" data-desc-position="bottom"><img alt="51" src="../images/airgap-4-12/51.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>infra02</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/52.png" data-desc-position="bottom"><img alt="52" src="../images/airgap-4-12/52.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>infra03</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/53.png" data-desc-position="bottom"><img alt="53" src="../images/airgap-4-12/53.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>storage01</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/51.png" data-desc-position="bottom"><img alt="51" src="../images/airgap-4-12/51.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>storage02</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/52.png" data-desc-position="bottom"><img alt="52" src="../images/airgap-4-12/52.png" style="max-height:250px"></a></p> </li> <li> <p>Start the <strong>storage03</strong> machine:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/53.png" data-desc-position="bottom"><img alt="53" src="../images/airgap-4-12/53.png" style="max-height:250px"></a></p> </li> </ol> <p>Once the compute nodes have successfully started, we should see that the certificate signing request to join the OpenShift cluster should be pending. In order to authorize these workers to join the OpenShift cluster, we need to approve those certificate signing requests.</p> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>Give around 10mins for the machines to start up so that you can see all the CSR at once. You should have one per machine and you will need to approve a CSR per machine twice.</p> </div> <ol> <li> <p>Get the certificate signing requests (csr):</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-278-1"><a id="__codelineno-278-1" name="__codelineno-278-1" href="#__codelineno-278-1"></a>oc get csr
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-279-1"><a id="__codelineno-279-1" name="__codelineno-279-1" href="#__codelineno-279-1"></a>NAME        AGE   SIGNERNAME                                    REQUESTOR                                                                   REQUESTEDDURATION   CONDITION
</span><span id="__span-279-2"><a id="__codelineno-279-2" name="__codelineno-279-2" href="#__codelineno-279-2"></a>csr-dncq9   96s   kubernetes.io/kube-apiserver-client-kubelet   system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   &lt;none&gt;              Pending
</span><span id="__span-279-3"><a id="__codelineno-279-3" name="__codelineno-279-3" href="#__codelineno-279-3"></a>csr-fxhxg   62s   kubernetes.io/kube-apiserver-client-kubelet   system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   &lt;none&gt;              Pending
</span><span id="__span-279-4"><a id="__codelineno-279-4" name="__codelineno-279-4" href="#__codelineno-279-4"></a>csr-kgkgs   6s    kubernetes.io/kube-apiserver-client-kubelet   system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   &lt;none&gt;              Pending
</span><span id="__span-279-5"><a id="__codelineno-279-5" name="__codelineno-279-5" href="#__codelineno-279-5"></a>csr-ntmtw   12s   kubernetes.io/kube-apiserver-client-kubelet   system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   &lt;none&gt;              Pending
</span><span id="__span-279-6"><a id="__codelineno-279-6" name="__codelineno-279-6" href="#__codelineno-279-6"></a>csr-vzbgt   76s   kubernetes.io/kube-apiserver-client-kubelet   system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   &lt;none&gt;              Pending
</span><span id="__span-279-7"><a id="__codelineno-279-7" name="__codelineno-279-7" href="#__codelineno-279-7"></a>csr-zrr6n   41s   kubernetes.io/kube-apiserver-client-kubelet   system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   &lt;none&gt;              Pending
</span></code></pre></div> </li> <li> <p>Approve any pending certificate signing request:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-280-1"><a id="__codelineno-280-1" name="__codelineno-280-1" href="#__codelineno-280-1"></a>oc get csr -o go-template='{{range .items}}{{if not .status}}{{.metadata.name}}{{"\n"}}{{end}}{{end}}' | xargs oc adm certificate approve
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-281-1"><a id="__codelineno-281-1" name="__codelineno-281-1" href="#__codelineno-281-1"></a>certificatesigningrequest.certificates.k8s.io/csr-dncq9 approved
</span><span id="__span-281-2"><a id="__codelineno-281-2" name="__codelineno-281-2" href="#__codelineno-281-2"></a>certificatesigningrequest.certificates.k8s.io/csr-fxhxg approved
</span><span id="__span-281-3"><a id="__codelineno-281-3" name="__codelineno-281-3" href="#__codelineno-281-3"></a>certificatesigningrequest.certificates.k8s.io/csr-kgkgs approved
</span><span id="__span-281-4"><a id="__codelineno-281-4" name="__codelineno-281-4" href="#__codelineno-281-4"></a>certificatesigningrequest.certificates.k8s.io/csr-ntmtw approved
</span><span id="__span-281-5"><a id="__codelineno-281-5" name="__codelineno-281-5" href="#__codelineno-281-5"></a>certificatesigningrequest.certificates.k8s.io/csr-vzbgt approved
</span><span id="__span-281-6"><a id="__codelineno-281-6" name="__codelineno-281-6" href="#__codelineno-281-6"></a>certificatesigningrequest.certificates.k8s.io/csr-zrr6n approved
</span></code></pre></div> </li> </ol> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>You may need to get and approve all pending certificate signing request few times as these will appear as machines come up. Also, to get a node to join the OpenShift cluster, two cerficate signing requests must be approved. Therefore, repeat the previous two steps few times until there is no pending certificate signing request.</p> </div> <p>After a reasonable amount of time (15 minutes aprox), confirm that the cluster operators are available and there is none in degraded state if no pending certificate signing request is listed. </p> <ol> <li> <p>Get the not ready cluster operators</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-282-1"><a id="__codelineno-282-1" name="__codelineno-282-1" href="#__codelineno-282-1"></a>oc get co | grep -e "4.16.9 False" -e "False True" -e "True          False" -e "NAME"
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-283-1"><a id="__codelineno-283-1" name="__codelineno-283-1" href="#__codelineno-283-1"></a>NAME                                       VERSION   AVAILABLE   PROGRESSING   DEGRADED   SINCE   MESSAGE
</span><span id="__span-283-2"><a id="__codelineno-283-2" name="__codelineno-283-2" href="#__codelineno-283-2"></a>authentication                             4.16.9    False       True          False      7h40m   WellKnownAvailable: The well-known endpoint is not yet available: kube-apiserver oauth endpoint https://192.168.252.5:6443/.well-known/oauth-authorization-server is not yet served and authentication operator keeps waiting (check kube-apiserver operator, and check that instances roll out successfully, which can take several minutes per instance)
</span><span id="__span-283-3"><a id="__codelineno-283-3" name="__codelineno-283-3" href="#__codelineno-283-3"></a>kube-apiserver                             4.16.9   True        True          False      7h36m   NodeInstallerProgressing: 2 nodes are at revision 6; 1 nodes are at revision 7
</span></code></pre></div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Repeat the command until there is no cluster operator listed. That will mean all cluster operators are healthy</p> </div> </li> <li> <p>Get all the cluster operators</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-284-1"><a id="__codelineno-284-1" name="__codelineno-284-1" href="#__codelineno-284-1"></a>oc get co
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-285-1"><a id="__codelineno-285-1" name="__codelineno-285-1" href="#__codelineno-285-1"></a>NAME                                       VERSION   AVAILABLE   PROGRESSING   DEGRADED   SINCE   MESSAGE
</span><span id="__span-285-2"><a id="__codelineno-285-2" name="__codelineno-285-2" href="#__codelineno-285-2"></a>authentication                             4.16.9    True        False         False      2m22s
</span><span id="__span-285-3"><a id="__codelineno-285-3" name="__codelineno-285-3" href="#__codelineno-285-3"></a>baremetal                                  4.16.9    True        False         False      47m
</span><span id="__span-285-4"><a id="__codelineno-285-4" name="__codelineno-285-4" href="#__codelineno-285-4"></a>cloud-controller-manager                   4.16.9    True        False         False      50m
</span><span id="__span-285-5"><a id="__codelineno-285-5" name="__codelineno-285-5" href="#__codelineno-285-5"></a>cloud-credential                           4.16.9    True        False         False      55m
</span><span id="__span-285-6"><a id="__codelineno-285-6" name="__codelineno-285-6" href="#__codelineno-285-6"></a>cluster-autoscaler                         4.16.9    True        False         False      47m
</span><span id="__span-285-7"><a id="__codelineno-285-7" name="__codelineno-285-7" href="#__codelineno-285-7"></a>config-operator                            4.16.9    True        False         False      48m
</span><span id="__span-285-8"><a id="__codelineno-285-8" name="__codelineno-285-8" href="#__codelineno-285-8"></a>console                                    4.16.9    True        False         False      7m59s
</span><span id="__span-285-9"><a id="__codelineno-285-9" name="__codelineno-285-9" href="#__codelineno-285-9"></a>control-plane-machine-set                  4.16.9    True        False         False      48m
</span><span id="__span-285-10"><a id="__codelineno-285-10" name="__codelineno-285-10" href="#__codelineno-285-10"></a>csi-snapshot-controller                    4.16.9    True        False         False      48m
</span><span id="__span-285-11"><a id="__codelineno-285-11" name="__codelineno-285-11" href="#__codelineno-285-11"></a>dns                                        4.16.9    True        False         False      47m
</span><span id="__span-285-12"><a id="__codelineno-285-12" name="__codelineno-285-12" href="#__codelineno-285-12"></a>etcd                                       4.16.9    True        False         False      46m
</span><span id="__span-285-13"><a id="__codelineno-285-13" name="__codelineno-285-13" href="#__codelineno-285-13"></a>image-registry                             4.16.9    True        False         False      23m
</span><span id="__span-285-14"><a id="__codelineno-285-14" name="__codelineno-285-14" href="#__codelineno-285-14"></a>ingress                                    4.16.9    True        False         False      10m
</span><span id="__span-285-15"><a id="__codelineno-285-15" name="__codelineno-285-15" href="#__codelineno-285-15"></a>insights                                   4.16.9    True        False         False      35m
</span><span id="__span-285-16"><a id="__codelineno-285-16" name="__codelineno-285-16" href="#__codelineno-285-16"></a>kube-apiserver                             4.16.9    True        False         False      34m
</span><span id="__span-285-17"><a id="__codelineno-285-17" name="__codelineno-285-17" href="#__codelineno-285-17"></a>kube-controller-manager                    4.16.9    True        False         False      45m
</span><span id="__span-285-18"><a id="__codelineno-285-18" name="__codelineno-285-18" href="#__codelineno-285-18"></a>kube-scheduler                             4.16.9    True        False         False      45m
</span><span id="__span-285-19"><a id="__codelineno-285-19" name="__codelineno-285-19" href="#__codelineno-285-19"></a>kube-storage-version-migrator              4.16.9    True        False         False      48m
</span><span id="__span-285-20"><a id="__codelineno-285-20" name="__codelineno-285-20" href="#__codelineno-285-20"></a>machine-api                                4.16.9    True        False         False      47m
</span><span id="__span-285-21"><a id="__codelineno-285-21" name="__codelineno-285-21" href="#__codelineno-285-21"></a>machine-approver                           4.16.9    True        False         False      47m
</span><span id="__span-285-22"><a id="__codelineno-285-22" name="__codelineno-285-22" href="#__codelineno-285-22"></a>machine-config                             4.16.9    True        False         False      47m
</span><span id="__span-285-23"><a id="__codelineno-285-23" name="__codelineno-285-23" href="#__codelineno-285-23"></a>marketplace                                4.16.9    True        False         False      47m
</span><span id="__span-285-24"><a id="__codelineno-285-24" name="__codelineno-285-24" href="#__codelineno-285-24"></a>monitoring                                 4.16.9    True        False         False      9m37s
</span><span id="__span-285-25"><a id="__codelineno-285-25" name="__codelineno-285-25" href="#__codelineno-285-25"></a>network                                    4.16.9    True        False         False      40m
</span><span id="__span-285-26"><a id="__codelineno-285-26" name="__codelineno-285-26" href="#__codelineno-285-26"></a>node-tuning                                4.16.9    True        False         False      13m
</span><span id="__span-285-27"><a id="__codelineno-285-27" name="__codelineno-285-27" href="#__codelineno-285-27"></a>openshift-apiserver                        4.16.9    True        False         False      30m
</span><span id="__span-285-28"><a id="__codelineno-285-28" name="__codelineno-285-28" href="#__codelineno-285-28"></a>openshift-controller-manager               4.16.9    True        False         False      40m
</span><span id="__span-285-29"><a id="__codelineno-285-29" name="__codelineno-285-29" href="#__codelineno-285-29"></a>openshift-samples                          4.16.9    True        False         False      25m
</span><span id="__span-285-30"><a id="__codelineno-285-30" name="__codelineno-285-30" href="#__codelineno-285-30"></a>operator-lifecycle-manager                 4.16.9    True        False         False      47m
</span><span id="__span-285-31"><a id="__codelineno-285-31" name="__codelineno-285-31" href="#__codelineno-285-31"></a>operator-lifecycle-manager-catalog         4.16.9    True        False         False      47m
</span><span id="__span-285-32"><a id="__codelineno-285-32" name="__codelineno-285-32" href="#__codelineno-285-32"></a>operator-lifecycle-manager-packageserver   4.16.9    True        False         False      33m
</span><span id="__span-285-33"><a id="__codelineno-285-33" name="__codelineno-285-33" href="#__codelineno-285-33"></a>service-ca                                 4.16.9    True        False         False      48m
</span><span id="__span-285-34"><a id="__codelineno-285-34" name="__codelineno-285-34" href="#__codelineno-285-34"></a>storage                                    4.16.9    True        False         False      48m
</span></code></pre></div> </li> <li> <p>Execute the wait for install to complete command</p> <div class="language-text copy highlight"><span class="filename">[root@bastion downloads]</span><pre><span></span><code><span id="__span-286-1"><a id="__codelineno-286-1" name="__codelineno-286-1" href="#__codelineno-286-1"></a>cd /root/registry/downloads/tools/ocp4
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-287-1"><a id="__codelineno-287-1" name="__codelineno-287-1" href="#__codelineno-287-1"></a>openshift-install wait-for install-complete
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-288-1"><a id="__codelineno-288-1" name="__codelineno-288-1" href="#__codelineno-288-1"></a>INFO Waiting up to 40m0s (until 4:28PM) for the cluster at https://api.ocp4.platformengineers.xyz:6443 to initialize...
</span><span id="__span-288-2"><a id="__codelineno-288-2" name="__codelineno-288-2" href="#__codelineno-288-2"></a>INFO Checking to see if there is a route at openshift-console/console...
</span><span id="__span-288-3"><a id="__codelineno-288-3" name="__codelineno-288-3" href="#__codelineno-288-3"></a><span class="hll">INFO Install complete!
</span></span><span id="__span-288-4"><a id="__codelineno-288-4" name="__codelineno-288-4" href="#__codelineno-288-4"></a><span class="hll">INFO To access the cluster as the system:admin user when using 'oc', run 'export KUBECONFIG=/root/registry/downloads/tools/ocp4/auth/kubeconfig'
</span></span><span id="__span-288-5"><a id="__codelineno-288-5" name="__codelineno-288-5" href="#__codelineno-288-5"></a><span class="hll">INFO Access the OpenShift web-console here: https://console-openshift-console.apps.ocp4.platformengineers.xyz
</span></span><span id="__span-288-6"><a id="__codelineno-288-6" name="__codelineno-288-6" href="#__codelineno-288-6"></a><span class="hll">INFO Login to the console with user: "kubeadmin", and password: "o8o6u-zgz8h-CobwL-pWb9i"
</span></span><span id="__span-288-7"><a id="__codelineno-288-7" name="__codelineno-288-7" href="#__codelineno-288-7"></a>INFO Time elapsed: 0s
</span></code></pre></div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>Alternatively, the same credentials can be found at <code>/root/registry/downloads/tools/ocp4/auth</code></p> </div> </li> </ol> <p>Let's now open up our OpenShift cluster web console in our laptop's web browser.</p> <ol> <li> <p>Add the following urls to your laptop hosts file with the IP address of the load balancer so that you can access them.</p> <div class="language-text copy highlight"><span class="filename">[student laptop]</span><pre><span></span><code><span id="__span-289-1"><a id="__codelineno-289-1" name="__codelineno-289-1" href="#__codelineno-289-1"></a>vi /etc/hosts
</span></code></pre></div> <p>Add the following entry to your hosts file:</p> <div class="language-text copy highlight"><span class="filename">/etc/hosts</span><pre><span></span><code><span id="__span-290-1"><a id="__codelineno-290-1" name="__codelineno-290-1" href="#__codelineno-290-1"></a>192.168.252.24 console-openshift-console.apps.ocp4.platformengineers.xyz oauth-openshift.apps.ocp4.platformengineers.xyz
</span></code></pre></div> </li> <li> <p>Now, you can connect via a web browser to the OpenShift web console using the credentials and url from the OpenShift wait for install to complete command:</p> <p><a href="https://console-openshift-console.apps.ocp4.platformengineers.xyz">https://console-openshift-console.apps.ocp4.platformengineers.xyz</a></p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/54.png" data-desc-position="bottom"><img alt="54" src="../images/airgap-4-12/54.png" style="max-height:800px"></a></p> </li> </ol> <h2 id="33-move-ingress-routing-and-internal-registry-loads-to-infrastructure-nodes">33. Move ingress routing and internal registry loads to infrastructure nodes<a class="headerlink" href="#33-move-ingress-routing-and-internal-registry-loads-to-infrastructure-nodes" title="Permanent link">¶</a></h2> <p>This operation is performed to move OpenShift infrastructure components from the compute nodes to the infra nodes. The infra nodes do not consume OpenShift licenses.</p> <ol> <li> <p>Create the labels for the infra nodes</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-291-1"><a id="__codelineno-291-1" name="__codelineno-291-1" href="#__codelineno-291-1"></a>oc label node infra01.ocp4.platformengineers.xyz node-role.kubernetes.io/infra=
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-292-1"><a id="__codelineno-292-1" name="__codelineno-292-1" href="#__codelineno-292-1"></a>node/infra01.ocp4.platformengineers.xyz labeled
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-293-1"><a id="__codelineno-293-1" name="__codelineno-293-1" href="#__codelineno-293-1"></a>oc label node infra02.ocp4.platformengineers.xyz node-role.kubernetes.io/infra=
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-294-1"><a id="__codelineno-294-1" name="__codelineno-294-1" href="#__codelineno-294-1"></a>node/infra02.ocp4.platformengineers.xyz labeled
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-295-1"><a id="__codelineno-295-1" name="__codelineno-295-1" href="#__codelineno-295-1"></a>oc label node infra03.ocp4.platformengineers.xyz node-role.kubernetes.io/infra=
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-296-1"><a id="__codelineno-296-1" name="__codelineno-296-1" href="#__codelineno-296-1"></a>node/infra03.ocp4.platformengineers.xyz labeled
</span></code></pre></div> </li> <li> <p>Taint the infra nodes to prevent them from receiving other workloads</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-297-1"><a id="__codelineno-297-1" name="__codelineno-297-1" href="#__codelineno-297-1"></a>oc adm taint nodes -l node-role.kubernetes.io/infra infra=reserved:NoSchedule infra=reserved:NoExecute
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-298-1"><a id="__codelineno-298-1" name="__codelineno-298-1" href="#__codelineno-298-1"></a>node/infra01.ocp4.platformengineers.xyz tainted
</span><span id="__span-298-2"><a id="__codelineno-298-2" name="__codelineno-298-2" href="#__codelineno-298-2"></a>node/infra02.ocp4.platformengineers.xyz tainted
</span><span id="__span-298-3"><a id="__codelineno-298-3" name="__codelineno-298-3" href="#__codelineno-298-3"></a>node/infra03.ocp4.platformengineers.xyz tainted
</span></code></pre></div> </li> <li> <p>Move the OpenShift cluster ingress controller to the infra nodes.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-299-1"><a id="__codelineno-299-1" name="__codelineno-299-1" href="#__codelineno-299-1"></a>oc edit ingresscontroller default -n openshift-ingress-operator
</span></code></pre></div> </li> <li> <p>Copy the highlighted lines into your default Ingress Controller specification.</p> <div class="language-yaml copy highlight"><span class="filename">deault</span><pre><span></span><code><span id="__span-300-1"><a id="__codelineno-300-1" name="__codelineno-300-1" href="#__codelineno-300-1"></a><span class="c1"># Please edit the object below. Lines beginning with a '#' will be ignored,</span>
</span><span id="__span-300-2"><a id="__codelineno-300-2" name="__codelineno-300-2" href="#__codelineno-300-2"></a><span class="c1"># and an empty file will abort the edit. If an error occurs while saving this file will be</span>
</span><span id="__span-300-3"><a id="__codelineno-300-3" name="__codelineno-300-3" href="#__codelineno-300-3"></a><span class="c1"># reopened with the relevant failures.</span>
</span><span id="__span-300-4"><a id="__codelineno-300-4" name="__codelineno-300-4" href="#__codelineno-300-4"></a><span class="c1">#</span>
</span><span id="__span-300-5"><a id="__codelineno-300-5" name="__codelineno-300-5" href="#__codelineno-300-5"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operator.openshift.io/v1</span>
</span><span id="__span-300-6"><a id="__codelineno-300-6" name="__codelineno-300-6" href="#__codelineno-300-6"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IngressController</span>
</span><span id="__span-300-7"><a id="__codelineno-300-7" name="__codelineno-300-7" href="#__codelineno-300-7"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-300-8"><a id="__codelineno-300-8" name="__codelineno-300-8" href="#__codelineno-300-8"></a><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s">"2023-09-14T13:30:51Z"</span>
</span><span id="__span-300-9"><a id="__codelineno-300-9" name="__codelineno-300-9" href="#__codelineno-300-9"></a><span class="nt">finalizers</span><span class="p">:</span>
</span><span id="__span-300-10"><a id="__codelineno-300-10" name="__codelineno-300-10" href="#__codelineno-300-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingresscontroller.operator.openshift.io/finalizer-ingresscontroller</span>
</span><span id="__span-300-11"><a id="__codelineno-300-11" name="__codelineno-300-11" href="#__codelineno-300-11"></a><span class="nt">generation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-300-12"><a id="__codelineno-300-12" name="__codelineno-300-12" href="#__codelineno-300-12"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-300-13"><a id="__codelineno-300-13" name="__codelineno-300-13" href="#__codelineno-300-13"></a><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openshift-ingress-operator</span>
</span><span id="__span-300-14"><a id="__codelineno-300-14" name="__codelineno-300-14" href="#__codelineno-300-14"></a><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">"2658200"</span>
</span><span id="__span-300-15"><a id="__codelineno-300-15" name="__codelineno-300-15" href="#__codelineno-300-15"></a><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40d5648f-98c3-46ac-9223-773e52b65f6a</span>
</span><span id="__span-300-16"><a id="__codelineno-300-16" name="__codelineno-300-16" href="#__codelineno-300-16"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-300-17"><a id="__codelineno-300-17" name="__codelineno-300-17" href="#__codelineno-300-17"></a><span class="nt">clientTLS</span><span class="p">:</span>
</span><span id="__span-300-18"><a id="__codelineno-300-18" name="__codelineno-300-18" href="#__codelineno-300-18"></a><span class="w">    </span><span class="nt">clientCA</span><span class="p">:</span>
</span><span id="__span-300-19"><a id="__codelineno-300-19" name="__codelineno-300-19" href="#__codelineno-300-19"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-300-20"><a id="__codelineno-300-20" name="__codelineno-300-20" href="#__codelineno-300-20"></a><span class="w">    </span><span class="nt">clientCertificatePolicy</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-300-21"><a id="__codelineno-300-21" name="__codelineno-300-21" href="#__codelineno-300-21"></a><span class="nt">httpCompression</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-300-22"><a id="__codelineno-300-22" name="__codelineno-300-22" href="#__codelineno-300-22"></a><span class="nt">httpEmptyRequestsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Respond</span>
</span><span id="__span-300-23"><a id="__codelineno-300-23" name="__codelineno-300-23" href="#__codelineno-300-23"></a><span class="nt">httpErrorCodePages</span><span class="p">:</span>
</span><span id="__span-300-24"><a id="__codelineno-300-24" name="__codelineno-300-24" href="#__codelineno-300-24"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-300-25"><a id="__codelineno-300-25" name="__codelineno-300-25" href="#__codelineno-300-25"></a><span class="hll"><span class="nt">nodePlacement</span><span class="p">:</span>
</span></span><span id="__span-300-26"><a id="__codelineno-300-26" name="__codelineno-300-26" href="#__codelineno-300-26"></a><span class="hll"><span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span>
</span></span><span id="__span-300-27"><a id="__codelineno-300-27" name="__codelineno-300-27" href="#__codelineno-300-27"></a><span class="hll"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span></span><span id="__span-300-28"><a id="__codelineno-300-28" name="__codelineno-300-28" href="#__codelineno-300-28"></a><span class="hll"><span class="w">      </span><span class="nt">node-role.kubernetes.io/infra</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
</span></span><span id="__span-300-29"><a id="__codelineno-300-29" name="__codelineno-300-29" href="#__codelineno-300-29"></a><span class="hll"><span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span>
</span></span><span id="__span-300-30"><a id="__codelineno-300-30" name="__codelineno-300-30" href="#__codelineno-300-30"></a><span class="hll"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
</span></span><span id="__span-300-31"><a id="__codelineno-300-31" name="__codelineno-300-31" href="#__codelineno-300-31"></a><span class="hll"><span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infra</span>
</span></span><span id="__span-300-32"><a id="__codelineno-300-32" name="__codelineno-300-32" href="#__codelineno-300-32"></a><span class="hll"><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reserved</span>
</span></span><span id="__span-300-33"><a id="__codelineno-300-33" name="__codelineno-300-33" href="#__codelineno-300-33"></a><span class="hll"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoExecute</span>
</span></span><span id="__span-300-34"><a id="__codelineno-300-34" name="__codelineno-300-34" href="#__codelineno-300-34"></a><span class="hll"><span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infra</span>
</span></span><span id="__span-300-35"><a id="__codelineno-300-35" name="__codelineno-300-35" href="#__codelineno-300-35"></a><span class="hll"><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reserved</span>
</span></span><span id="__span-300-36"><a id="__codelineno-300-36" name="__codelineno-300-36" href="#__codelineno-300-36"></a><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-300-37"><a id="__codelineno-300-37" name="__codelineno-300-37" href="#__codelineno-300-37"></a><span class="nt">tuningOptions</span><span class="p">:</span>
</span><span id="__span-300-38"><a id="__codelineno-300-38" name="__codelineno-300-38" href="#__codelineno-300-38"></a><span class="w">    </span><span class="nt">reloadInterval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0s</span>
</span><span id="__span-300-39"><a id="__codelineno-300-39" name="__codelineno-300-39" href="#__codelineno-300-39"></a><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</span></code></pre></div> </li> <li> <p>Move the internal OpenShift image registry to the infra nodes</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-301-1"><a id="__codelineno-301-1" name="__codelineno-301-1" href="#__codelineno-301-1"></a>oc patch configs.imageregistry.operator.openshift.io/cluster --type=merge -p '{"spec":{"nodeSelector": {"node-role.kubernetes.io/infra": ""},"tolerations": [{"effect":"NoSchedule","key": "infra","value": "reserved"},{"effect":"NoExecute","key": "infra","value": "reserved"}]}}'
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-302-1"><a id="__codelineno-302-1" name="__codelineno-302-1" href="#__codelineno-302-1"></a>config.imageregistry.operator.openshift.io/cluster patched
</span></code></pre></div> </li> </ol> <h2 id="34-deploy-openshift-data-foundation-on-storage-nodes">34. Deploy OpenShift Data Foundation on Storage nodes<a class="headerlink" href="#34-deploy-openshift-data-foundation-on-storage-nodes" title="Permanent link">¶</a></h2> <p>This operation is performed to provide OpenShift with Block, Object and File persistent storage. Storage nodes do not consume OpenShift Licences.</p> <ol> <li> <p>Create the labels for the infra nodes</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ocp4]</span><pre><span></span><code><span id="__span-303-1"><a id="__codelineno-303-1" name="__codelineno-303-1" href="#__codelineno-303-1"></a>oc label node storage01.ocp4.platformengineers.xyz node-role.kubernetes.io/infra=
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-304-1"><a id="__codelineno-304-1" name="__codelineno-304-1" href="#__codelineno-304-1"></a>node/storage01.ocp4.platformengineers.xyz labeled
</span></code></pre></div> </li> </ol> <h2 id="35-create-the-catalog-sources-to-access-the-redhat-marketplace-operators">35. Create the catalog sources to access the RedHat Marketplace operators<a class="headerlink" href="#35-create-the-catalog-sources-to-access-the-redhat-marketplace-operators" title="Permanent link">¶</a></h2> <p>The OpenShift cluster does not have internet access. Therefore the operator catalog for available operators has to be configured to point to the image mirrored to the Quay private image registry installed on the offline bastion.</p> <p>To do this, we will use the <code>catalogSource-redhat-operator-index.yaml</code> file previously created during installation and available in <code>/root/oc-mirror-workspace/results-XXXXXX</code>.</p> <p>Before applying the catalog source, the default catalogs that have been installed with Openshift cluster need to be deactivated:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-305-1"><a id="__codelineno-305-1" name="__codelineno-305-1" href="#__codelineno-305-1"></a>oc patch OperatorHub cluster --type json -p '[{"op": "add", "path": "/spec/disableAllDefaultSources", "value": true}]'
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-306-1"><a id="__codelineno-306-1" name="__codelineno-306-1" href="#__codelineno-306-1"></a>operatorhub.config.openshift.io/cluster patched
</span></code></pre></div> <p>We should see no operator available in the OperatorHub of our OpenShift cluster:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-12/55.png" data-desc-position="bottom"><img alt="55" src="../images/airgap-4-12/55.png" style="max-height:400px"></a></p> <p>Now, to create that custom catalog source that points to our Quay private image registry, execute the following commands:</p> <div class="language-text copy highlight"><span class="filename">[root@bastion ~]</span><pre><span></span><code><span id="__span-307-1"><a id="__codelineno-307-1" name="__codelineno-307-1" href="#__codelineno-307-1"></a>cd /root/oc-mirror-workspace/results-XXXXX/
</span></code></pre></div> <div class="language-text copy highlight"><span class="filename">[root@bastion results-XXXXX]</span><pre><span></span><code><span id="__span-308-1"><a id="__codelineno-308-1" name="__codelineno-308-1" href="#__codelineno-308-1"></a>oc apply -f catalogSource-cs-redhat-operator-index.yaml
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-309-1"><a id="__codelineno-309-1" name="__codelineno-309-1" href="#__codelineno-309-1"></a>catalogsource.operators.coreos.com/redhat-operator-index created
</span></code></pre></div> <p>Check now if the operators are listed:</p> <p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../images/airgap-4-16/56.png" data-desc-position="bottom"><img alt="56" src="../images/airgap-4-16/56.png" style="max-height:900px"></a></p> <h2 id="35-deactivate-the-cluster-update-channel">35. Deactivate the cluster update channel<a class="headerlink" href="#35-deactivate-the-cluster-update-channel" title="Permanent link">¶</a></h2> <p>Openshift defines an update channel to search for and install updates. Since this cluster does not have any internet access, it is recommended to turn off the update channel.</p> <p>Run the following command to modify the update channel and set it to null, leaving the cluster without an update channel.</p> <div class="language-text copy highlight"><span class="filename">[root@bastion transfer-files]</span><pre><span></span><code><span id="__span-310-1"><a id="__codelineno-310-1" name="__codelineno-310-1" href="#__codelineno-310-1"></a>oc adm upgrade channel --allow-explicit-channel
</span></code></pre></div> <div class="language-text no-copy highlight"><span class="filename">Output</span><pre><span></span><code><span id="__span-311-1"><a id="__codelineno-311-1" name="__codelineno-311-1" href="#__codelineno-311-1"></a>warning: Clearing channel "stable-4.16"; cluster will no longer request available update recommendations.
</span></code></pre></div> <div class="admonition success"> <p class="admonition-title">Congratulations!</p> <p>You have successfully installed an airgapped OpenShift 4.16 cluster. Well done!</p> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type="button" class="md-top md-icon" data-md-component="top" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> Copyright © 2025 IBM Client Engineering </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> <div class="md-footer-column"> <a href="https://techzone.ibm.com"><img src="https://ibm.biz/PoweredByITZ" style="height:55px;"></a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script> <script src="../../assets/javascripts/custom.054acff4.min.js"></script>  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>